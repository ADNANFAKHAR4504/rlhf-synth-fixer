"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
const environmentSuffix = process.env.ENVIRONMENT_SUFFIX || 'dev';
describe('TapStack CloudFormation Template', () => {
    let template;
    beforeAll(() => {
        // If youre testing a yaml template. run `pipenv run cfn-flip-to-json > lib/TapStack.json`
        // Otherwise, ensure the template is in JSON format.
        const templatePath = path_1.default.join(__dirname, '../lib/TapStack.json');
        const templateContent = fs_1.default.readFileSync(templatePath, 'utf8');
        template = JSON.parse(templateContent);
    });
    describe('Template Structure', () => {
        test('should have valid CloudFormation format version', () => {
            expect(template.AWSTemplateFormatVersion).toBe('2010-09-09');
        });
        test('should have a description', () => {
            expect(template.Description).toBeDefined();
            expect(template.Description).toBe('Comprehensive AWS Security Infrastructure - TAP Stack with Enhanced Security Features');
        });
        test('should have metadata section', () => {
            expect(template.Metadata).toBeDefined();
            expect(template.Metadata['AWS::CloudFormation::Interface']).toBeDefined();
        });
    });
    describe('Parameters', () => {
        test('should have all required parameters', () => {
            const requiredParams = ['EnvironmentSuffix', 'AllowedSSHCIDR', 'NotificationEmail', 'EnableGuardDuty', 'EnableDetailedMonitoring'];
            requiredParams.forEach(param => {
                expect(template.Parameters[param]).toBeDefined();
            });
        });
        test('EnvironmentSuffix parameter should have correct properties', () => {
            const envSuffixParam = template.Parameters.EnvironmentSuffix;
            expect(envSuffixParam.Type).toBe('String');
            expect(envSuffixParam.Default).toBe('dev');
            expect(envSuffixParam.Description).toBe('Environment suffix for resource naming (e.g., dev, staging, prod)');
            expect(envSuffixParam.AllowedPattern).toBe('^[a-zA-Z0-9]+$');
            expect(envSuffixParam.ConstraintDescription).toBe('Must contain only alphanumeric characters');
        });
        test('NotificationEmail parameter should validate email format', () => {
            const emailParam = template.Parameters.NotificationEmail;
            expect(emailParam.Type).toBe('String');
            expect(emailParam.AllowedPattern).toBeDefined();
            expect(emailParam.ConstraintDescription).toBe('Must be a valid email address');
        });
    });
    describe('Security Resources', () => {
        test('should have VPC with proper configuration', () => {
            expect(template.Resources.SecureVPC).toBeDefined();
            const vpc = template.Resources.SecureVPC;
            expect(vpc.Type).toBe('AWS::EC2::VPC');
            expect(vpc.Properties.CidrBlock).toBe('10.0.0.0/16');
            expect(vpc.Properties.EnableDnsHostnames).toBe(true);
            expect(vpc.Properties.EnableDnsSupport).toBe(true);
        });
        test('should have public and private subnets', () => {
            expect(template.Resources.PublicSubnet).toBeDefined();
            expect(template.Resources.PrivateSubnet).toBeDefined();
            expect(template.Resources.PublicSubnet.Type).toBe('AWS::EC2::Subnet');
            expect(template.Resources.PrivateSubnet.Type).toBe('AWS::EC2::Subnet');
        });
        test('should have security group with restrictive rules', () => {
            expect(template.Resources.WebSecurityGroup).toBeDefined();
            const sg = template.Resources.WebSecurityGroup;
            expect(sg.Type).toBe('AWS::EC2::SecurityGroup');
            expect(sg.Properties.SecurityGroupIngress).toHaveLength(3); // SSH, HTTP, HTTPS
        });
        test('should have IAM role with least privilege', () => {
            expect(template.Resources.EC2SecurityRole).toBeDefined();
            const role = template.Resources.EC2SecurityRole;
            expect(role.Type).toBe('AWS::IAM::Role');
            expect(role.Properties.Policies).toBeDefined();
            expect(role.Properties.Policies[0].PolicyName).toBe('S3ReadOnlyAccess');
        });
        test('should have S3 buckets with encryption', () => {
            expect(template.Resources.SecureDataBucket).toBeDefined();
            const bucket = template.Resources.SecureDataBucket;
            expect(bucket.Type).toBe('AWS::S3::Bucket');
            expect(bucket.Properties.BucketEncryption).toBeDefined();
            expect(bucket.Properties.PublicAccessBlockConfiguration.BlockPublicAcls).toBe(true);
            expect(bucket.Properties.VersioningConfiguration.Status).toBe('Enabled');
        });
        test('should have S3 bucket policy enforcing HTTPS', () => {
            expect(template.Resources.SecureDataBucketPolicy).toBeDefined();
            const policy = template.Resources.SecureDataBucketPolicy;
            expect(policy.Type).toBe('AWS::S3::BucketPolicy');
            const statement = policy.Properties.PolicyDocument.Statement[0];
            expect(statement.Effect).toBe('Deny');
            expect(statement.Condition.Bool['aws:SecureTransport']).toBe('false');
        });
    });
    describe('Monitoring and Alerting', () => {
        test('should have SNS topic for security alerts', () => {
            expect(template.Resources.SecurityAlertsTopic).toBeDefined();
            const topic = template.Resources.SecurityAlertsTopic;
            expect(topic.Type).toBe('AWS::SNS::Topic');
            expect(topic.Properties.KmsMasterKeyId).toBe('alias/aws/sns');
        });
        test('should have CloudWatch alarms', () => {
            const alarms = ['UnauthorizedAPICallsAlarm', 'HighCPUAlarm', 'UnusualS3ActivityAlarm'];
            alarms.forEach(alarm => {
                expect(template.Resources[alarm]).toBeDefined();
                expect(template.Resources[alarm].Type).toBe('AWS::CloudWatch::Alarm');
            });
        });
        test('should have CloudWatch log groups', () => {
            expect(template.Resources.S3AccessLogGroup).toBeDefined();
            expect(template.Resources.SecurityLogGroup).toBeDefined();
            expect(template.Resources.S3AccessLogGroup.Properties.RetentionInDays).toBe(30);
            expect(template.Resources.SecurityLogGroup.Properties.RetentionInDays).toBe(90);
        });
    });
    describe('GuardDuty Configuration', () => {
        test('should have GuardDuty detector with conditional creation', () => {
            expect(template.Resources.GuardDutyDetector).toBeDefined();
            const detector = template.Resources.GuardDutyDetector;
            expect(detector.Type).toBe('AWS::GuardDuty::Detector');
            expect(detector.Condition).toBe('EnableGuardDutyCondition');
            expect(detector.Properties.Enable).toBe(true);
        });
        test('should have GuardDuty condition defined', () => {
            expect(template.Conditions.EnableGuardDutyCondition).toBeDefined();
        });
    });
    describe('DynamoDB Resources', () => {
        test('should have TurnAroundPromptTable resource', () => {
            expect(template.Resources.TurnAroundPromptTable).toBeDefined();
        });
        test('TurnAroundPromptTable should be a DynamoDB table', () => {
            const table = template.Resources.TurnAroundPromptTable;
            expect(table.Type).toBe('AWS::DynamoDB::Table');
        });
        test('TurnAroundPromptTable should have correct deletion policies', () => {
            const table = template.Resources.TurnAroundPromptTable;
            expect(table.DeletionPolicy).toBe('Delete');
            expect(table.UpdateReplacePolicy).toBe('Delete');
        });
        test('TurnAroundPromptTable should have correct properties', () => {
            const table = template.Resources.TurnAroundPromptTable;
            const properties = table.Properties;
            expect(properties.TableName).toEqual({
                'Fn::Sub': 'TurnAroundPromptTable${EnvironmentSuffix}',
            });
            expect(properties.BillingMode).toBe('PAY_PER_REQUEST');
            expect(properties.DeletionProtectionEnabled).toBe(false);
            expect(properties.PointInTimeRecoverySpecification.PointInTimeRecoveryEnabled).toBe(true);
            expect(properties.SSESpecification.SSEEnabled).toBe(true);
            expect(properties.SSESpecification.SSEType).toBe('KMS');
        });
        test('TurnAroundPromptTable should have correct attribute definitions', () => {
            const table = template.Resources.TurnAroundPromptTable;
            const attributeDefinitions = table.Properties.AttributeDefinitions;
            expect(attributeDefinitions).toHaveLength(1);
            expect(attributeDefinitions[0].AttributeName).toBe('id');
            expect(attributeDefinitions[0].AttributeType).toBe('S');
        });
        test('TurnAroundPromptTable should have correct key schema', () => {
            const table = template.Resources.TurnAroundPromptTable;
            const keySchema = table.Properties.KeySchema;
            expect(keySchema).toHaveLength(1);
            expect(keySchema[0].AttributeName).toBe('id');
            expect(keySchema[0].KeyType).toBe('HASH');
        });
    });
    describe('Outputs', () => {
        test('should have all required outputs', () => {
            const expectedOutputs = [
                'TurnAroundPromptTableName',
                'TurnAroundPromptTableArn',
                'StackName',
                'EnvironmentSuffix',
                'VPCId',
                'PublicSubnetId',
                'PrivateSubnetId',
                'SecureDataBucketName',
                'SecurityAlertsTopicArn',
                'EC2InstanceId'
            ];
            expectedOutputs.forEach(outputName => {
                expect(template.Outputs[outputName]).toBeDefined();
            });
        });
        test('TurnAroundPromptTableName output should be correct', () => {
            const output = template.Outputs.TurnAroundPromptTableName;
            expect(output.Description).toBe('Name of the DynamoDB table');
            expect(output.Value).toEqual({ Ref: 'TurnAroundPromptTable' });
            expect(output.Export.Name).toEqual({
                'Fn::Sub': '${AWS::StackName}-TurnAroundPromptTableName',
            });
        });
        test('TurnAroundPromptTableArn output should be correct', () => {
            const output = template.Outputs.TurnAroundPromptTableArn;
            expect(output.Description).toBe('ARN of the DynamoDB table');
            expect(output.Value).toEqual({
                'Fn::GetAtt': ['TurnAroundPromptTable', 'Arn'],
            });
            expect(output.Export.Name).toEqual({
                'Fn::Sub': '${AWS::StackName}-TurnAroundPromptTableArn',
            });
        });
        test('VPC and networking outputs should be correct', () => {
            expect(template.Outputs.VPCId.Value).toEqual({ Ref: 'SecureVPC' });
            expect(template.Outputs.PublicSubnetId.Value).toEqual({ Ref: 'PublicSubnet' });
            expect(template.Outputs.PrivateSubnetId.Value).toEqual({ Ref: 'PrivateSubnet' });
        });
    });
    describe('Template Validation', () => {
        test('should have valid JSON structure', () => {
            expect(template).toBeDefined();
            expect(typeof template).toBe('object');
        });
        test('should not have any undefined or null required sections', () => {
            expect(template.AWSTemplateFormatVersion).not.toBeNull();
            expect(template.Description).not.toBeNull();
            expect(template.Parameters).not.toBeNull();
            expect(template.Resources).not.toBeNull();
            expect(template.Outputs).not.toBeNull();
        });
        test('should have proper resource count', () => {
            const resourceCount = Object.keys(template.Resources).length;
            expect(resourceCount).toBeGreaterThan(15); // We have many security resources
        });
        test('should have proper parameter count', () => {
            const parameterCount = Object.keys(template.Parameters).length;
            expect(parameterCount).toBe(5); // EnvironmentSuffix, AllowedSSHCIDR, NotificationEmail, EnableGuardDuty, EnableDetailedMonitoring
        });
    });
    describe('Resource Naming Convention', () => {
        test('table name should follow naming convention with environment suffix', () => {
            const table = template.Resources.TurnAroundPromptTable;
            const tableName = table.Properties.TableName;
            expect(tableName).toEqual({
                'Fn::Sub': 'TurnAroundPromptTable${EnvironmentSuffix}',
            });
        });
        test('export names should follow naming convention', () => {
            Object.keys(template.Outputs).forEach(outputKey => {
                const output = template.Outputs[outputKey];
                expect(output.Export.Name).toEqual({
                    'Fn::Sub': `\${AWS::StackName}-${outputKey}`,
                });
            });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFwLXN0YWNrLnVuaXQudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRhcC1zdGFjay51bml0LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw0Q0FBb0I7QUFDcEIsZ0RBQXdCO0FBRXhCLE1BQU0saUJBQWlCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsSUFBSSxLQUFLLENBQUM7QUFFbEUsUUFBUSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtJQUNoRCxJQUFJLFFBQWEsQ0FBQztJQUVsQixTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsMEZBQTBGO1FBQzFGLG9EQUFvRDtRQUNwRCxNQUFNLFlBQVksR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO1FBQ2xFLE1BQU0sZUFBZSxHQUFHLFlBQUUsQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQzlELFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ3pDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtRQUNsQyxJQUFJLENBQUMsaURBQWlELEVBQUUsR0FBRyxFQUFFO1lBQzNELE1BQU0sQ0FBQyxRQUFRLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDL0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO1lBQ3JDLE1BQU0sQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDM0MsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQy9CLHVGQUF1RixDQUN4RixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsOEJBQThC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ZW50IjpbImltcG9ydCBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5cclxuY29uc3QgZW52aXJvbm1lbnRTdWZmaXggPSBwcm9jZXNzLmVudi5FTlZJUk9OTUVOVF9TVUZGSVggfHwgJ2Rldic7XHJcblxyXG5kZXNjcmliZSgnVGFwU3RhY2sgQ2xvdWRGb3JtYXRpb24gVGVtcGxhdGUnLCAoKSA9PiB7XHJcbiAgbGV0IHRlbXBsYXRlOiBhbnk7XHJcblxyXG4gIGJlZm9yZUFsbCgoKSA9PiB7XHJcbiAgICAvLyBJZiB5b3VyZSB0ZXN0aW5nIGEgeWFtbCB0ZW1wbGF0ZS4gcnVuIGBwaXBlbnYgcnVuIGNmbi1mbGlwLXRvLWpzb24gPiBsaWIvVGFwU3RhY2suanNvbmBcclxuICAgIC8vIE90aGVyd2lzZSwgZW5zdXJlIHRoZSB0ZW1wbGF0ZSBpcyBpbiBKU09OIGZvcm1hdC5cclxuICAgIGNvbnN0IHRlbXBsYXRlUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9saWIvVGFwU3RhY2suanNvbicpO1xyXG4gICAgY29uc3QgdGVtcGxhdGVDb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKHRlbXBsYXRlUGF0aCwgJ3V0ZjgnKTtcclxuICAgIHRlbXBsYXRlID0gSlNPTi5wYXJzZSh0ZW1wbGF0ZUNvbnRlbnQpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnVGVtcGxhdGUgU3RydWN0dXJlJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgdmFsaWQgQ2xvdWRGb3JtYXRpb24gZm9ybWF0IHZlcnNpb24nLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5BV1NUZW1wbGF0ZUZvcm1hdFZlcnNpb24pLnRvQmUoJzIwMTAtMDktMDknKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGEgZGVzY3JpcHRpb24nLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5EZXNjcmlwdGlvbikudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHRlbXBsYXRlLkRlc2NyaXB0aW9uKS50b0JlKFxyXG4gICAgICAgICdDb21wcmVoZW5zaXZlIEFXUyBTZWN1cml0eSBJbmZyYXN0cnVjdHVyZSAtIFRBUCBTdGFjayB3aXRoIEVuaGFuY2VkIFNlY3VyaXR5IEZlYXR1cmVzJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgbWV0YWRhdGEgc2VjdGlvbicsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRlbXBsYXRlLk1ldGFkYXRhKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QodGVtcGxhdGUuTWV0YWRhdGFbJ0FXUzo6Q2xvdWRGb3JtYXRpb246OkludGVyZmFjZSddKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdQYXJhbWV0ZXJzJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgYWxsIHJlcXVpcmVkIHBhcmFtZXRlcnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlcXVpcmVkUGFyYW1zID0gWydFbnZpcm9ubWVudFN1ZmZpeCcsICdBbGxvd2VkU1NIQ0lEUicsICdOb3RpZmljYXRpb25FbWFpbCcsICdFbmFibGVHdWFyZER1dHknLCAnRW5hYmxlRGV0YWlsZWRNb25pdG9yaW5nJ107XHJcbiAgICAgIHJlcXVpcmVkUGFyYW1zLmZvckVhY2gocGFyYW0gPT4ge1xyXG4gICAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5QYXJhbWV0ZXJzW3BhcmFtXSkudG9CZURlZmluZWQoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdFbnZpcm9ubWVudFN1ZmZpeCBwYXJhbWV0ZXIgc2hvdWxkIGhhdmUgY29ycmVjdCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBlbnZTdWZmaXhQYXJhbSA9IHRlbXBsYXRlLlBhcmFtZXRlcnMuRW52aXJvbm1lbnRTdWZmaXg7XHJcbiAgICAgIGV4cGVjdChlbnZTdWZmaXhQYXJhbS5UeXBlKS50b0JlKCdTdHJpbmcnKTtcclxuICAgICAgZXhwZWN0KGVudlN1ZmZpeFBhcmFtLkRlZmF1bHQpLnRvQmUoJ2RldicpO1xyXG4gICAgICBleHBlY3QoZW52U3VmZml4UGFyYW0uRGVzY3JpcHRpb24pLnRvQmUoXHJcbiAgICAgICAgJ0Vudmlyb25tZW50IHN1ZmZpeCBmb3IgcmVzb3VyY2UgbmFtaW5nIChlLmcuLCBkZXYsIHN0YWdpbmcsIHByb2QpJ1xyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QoZW52U3VmZml4UGFyYW0uQWxsb3dlZFBhdHRlcm4pLnRvQmUoJ15bYS16QS1aMC05XSskJyk7XHJcbiAgICAgIGV4cGVjdChlbnZTdWZmaXhQYXJhbS5Db25zdHJhaW50RGVzY3JpcHRpb24pLnRvQmUoXHJcbiAgICAgICAgJ011c3QgY29udGFpbiBvbmx5IGFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnTm90aWZpY2F0aW9uRW1haWwgcGFyYW1ldGVyIHNob3VsZCB2YWxpZGF0ZSBlbWFpbCBmb3JtYXQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVtYWlsUGFyYW0gPSB0ZW1wbGF0ZS5QYXJhbWV0ZXJzLk5vdGlmaWNhdGlvbkVtYWlsO1xyXG4gICAgICBleHBlY3QoZW1haWxQYXJhbS5UeXBlKS50b0JlKCdTdHJpbmcnKTtcclxuICAgICAgZXhwZWN0KGVtYWlsUGFyYW0uQWxsb3dlZFBhdHRlcm4pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChlbWFpbFBhcmFtLkNvbnN0cmFpbnREZXNjcmlwdGlvbikudG9CZSgnTXVzdCBiZSBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnU2VjdXJpdHkgUmVzb3VyY2VzJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgVlBDIHdpdGggcHJvcGVyIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuU2VjdXJlVlBDKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBjb25zdCB2cGMgPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuU2VjdXJlVlBDO1xyXG4gICAgICBleHBlY3QodnBjLlR5cGUpLnRvQmUoJ0FXUzo6RUMyOjpWUEMnKTtcclxuICAgICAgZXhwZWN0KHZwYy5Qcm9wZXJ0aWVzLkNpZHJCbG9jaykudG9CZSgnMTAuMC4wLjAvMTYnKTtcclxuICAgICAgZXhwZWN0KHZwYy5Qcm9wZXJ0aWVzLkVuYWJsZURuc0hvc3RuYW1lcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHZwYy5Qcm9wZXJ0aWVzLkVuYWJsZURuc1N1cHBvcnQpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBwdWJsaWMgYW5kIHByaXZhdGUgc3VibmV0cycsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5QdWJsaWNTdWJuZXQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHJpdmF0ZVN1Ym5ldCkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5QdWJsaWNTdWJuZXQuVHlwZSkudG9CZSgnQVdTOjpFQzI6OlN1Ym5ldCcpO1xyXG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlByaXZhdGVTdWJuZXQuVHlwZSkudG9CZSgnQVdTOjpFQzI6OlN1Ym5ldCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgc2VjdXJpdHkgZ3JvdXAgd2l0aCByZXN0cmljdGl2ZSBydWxlcycsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5XZWJTZWN1cml0eUdyb3VwKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBjb25zdCBzZyA9IHRlbXBsYXRlLlJlc291cmNlcy5XZWJTZWN1cml0eUdyb3VwO1xyXG4gICAgICBleHBlY3Qoc2cuVHlwZSkudG9CZSgnQVdTOjpFQzI6OlNlY3VyaXR5R3JvdXAnKTtcclxuICAgICAgZXhwZWN0KHNnLlByb3BlcnRpZXMuU2VjdXJpdHlHcm91cEluZ3Jlc3MpLnRvSGF2ZUxlbmd0aCgzKTsgLy8gU1NILCBIVFRQLCBIVFRQU1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgSUFNIHJvbGUgd2l0aCBsZWFzdCBwcml2aWxlZ2UnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuRUMyU2VjdXJpdHlSb2xlKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBjb25zdCByb2xlID0gdGVtcGxhdGUuUmVzb3VyY2VzLkVDMlNlY3VyaXR5Um9sZTtcclxuICAgICAgZXhwZWN0KHJvbGUuVHlwZSkudG9CZSgnQVdTOjpJQU06OlJvbGUnKTtcclxuICAgICAgZXhwZWN0KHJvbGUuUHJvcGVydGllcy5Qb2xpY2llcykudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHJvbGUuUHJvcGVydGllcy5Qb2xpY2llc1swXS5Qb2xpY3lOYW1lKS50b0JlKCdTM1JlYWRPbmx5QWNjZXNzJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBTMyBidWNrZXRzIHdpdGggZW5jcnlwdGlvbicsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5TZWN1cmVEYXRhQnVja2V0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBjb25zdCBidWNrZXQgPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuU2VjdXJlRGF0YUJ1Y2tldDtcclxuICAgICAgZXhwZWN0KGJ1Y2tldC5UeXBlKS50b0JlKCdBV1M6OlMzOjpCdWNrZXQnKTtcclxuICAgICAgZXhwZWN0KGJ1Y2tldC5Qcm9wZXJ0aWVzLkJ1Y2tldEVuY3J5cHRpb24pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChidWNrZXQuUHJvcGVydGllcy5QdWJsaWNBY2Nlc3NCbG9ja0NvbmZpZ3VyYXRpb24uQmxvY2tQdWJsaWNBY2xzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QoYnVja2V0LlByb3BlcnRpZXMuVmVyc2lvbmluZ0NvbmZpZ3VyYXRpb24uU3RhdHVzKS50b0JlKCdFbmFibGVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBTMyBidWNrZXQgcG9saWN5IGVuZm9yY2luZyBIVFRQUycsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5TZWN1cmVEYXRhQnVja2V0UG9saWN5KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBjb25zdCBwb2xpY3kgPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuU2VjdXJlRGF0YUJ1Y2tldFBvbGljeTtcclxuICAgICAgZXhwZWN0KHBvbGljeS5UeXBlKS50b0JlKCdBV1M6OlMzOjpCdWNrZXRQb2xpY3knKTtcclxuICAgICAgY29uc3Qgc3RhdGVtZW50ID0gcG9saWN5LlByb3BlcnRpZXMuUG9saWN5RG9jdW1lbnQuU3RhdGVtZW50WzBdO1xyXG4gICAgICBleHBlY3Qoc3RhdGVtZW50LkVmZmVjdCkudG9CZSgnRGVueScpO1xyXG4gICAgICBleHBlY3Qoc3RhdGVtZW50LkNvbmRpdGlvbi5Cb29sWydhd3M6U2VjdXJlVHJhbnNwb3J0J10pLnRvQmUoJ2ZhbHNlJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ01vbml0b3JpbmcgYW5kIEFsZXJ0aW5nJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgU05TIHRvcGljIGZvciBzZWN1cml0eSBhbGVydHMnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuU2VjdXJpdHlBbGVydHNUb3BpYykudG9CZURlZmluZWQoKTtcclxuICAgICAgY29uc3QgdG9waWMgPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuU2VjdXJpdHlBbGVydHNUb3BpYztcclxuICAgICAgZXhwZWN0KHRvcGljLlR5cGUpLnRvQmUoJ0FXUzo6U05TOjpUb3BpYycpO1xyXG4gICAgICBleHBlY3QodG9waWMuUHJvcGVydGllcy5LbXNNYXN0ZXJLZXlJZCkudG9CZSgnYWxpYXMvYXdzL3NucycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgQ2xvdWRXYXRjaCBhbGFybXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGFsYXJtcyA9IFsnVW5hdXRob3JpemVkQVBJQ2FsbHNBbGFybScsICdIaWdoQ1BVQWxhcm0nLCAnVW51c3VhbFMzQWN0aXZpdHlBbGFybSddO1xyXG4gICAgICBhbGFybXMuZm9yRWFjaChhbGFybSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlc1thbGFybV0pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlc1thbGFybV0uVHlwZSkudG9CZSgnQVdTOjpDbG91ZFdhdGNoOjpBbGFybScpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIENsb3VkV2F0Y2ggbG9nIGdyb3VwcycsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5TM0FjY2Vzc0xvZ0dyb3VwKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlNlY3VyaXR5TG9nR3JvdXApLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUzNBY2Nlc3NMb2dHcm91cC5Qcm9wZXJ0aWVzLlJldGVudGlvbkluRGF5cykudG9CZSgzMCk7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuU2VjdXJpdHlMb2dHcm91cC5Qcm9wZXJ0aWVzLlJldGVudGlvbkluRGF5cykudG9CZSg5MCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0d1YXJkRHV0eSBDb25maWd1cmF0aW9uJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgR3VhcmREdXR5IGRldGVjdG9yIHdpdGggY29uZGl0aW9uYWwgY3JlYXRpb24nLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuR3VhcmREdXR5RGV0ZWN0b3IpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGNvbnN0IGRldGVjdG9yID0gdGVtcGxhdGUuUmVzb3VyY2VzLkd1YXJkRHV0eURldGVjdG9yO1xyXG4gICAgICBleHBlY3QoZGV0ZWN0b3IuVHlwZSkudG9CZSgnQVdTOjpHdWFyZER1dHk6OkRldGVjdG9yJyk7XHJcbiAgICAgIGV4cGVjdChkZXRlY3Rvci5Db25kaXRpb24pLnRvQmUoJ0VuYWJsZUd1YXJkRHV0eUNvbmRpdGlvbicpO1xyXG4gICAgICBleHBlY3QoZGV0ZWN0b3IuUHJvcGVydGllcy5FbmFibGUpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBHdWFyZER1dHkgY29uZGl0aW9uIGRlZmluZWQnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5Db25kaXRpb25zLkVuYWJsZUd1YXJkRHV0eUNvbmRpdGlvbikudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRHluYW1vREIgUmVzb3VyY2VzJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgVHVybkFyb3VuZFByb21wdFRhYmxlIHJlc291cmNlJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlR1cm5Bcm91bmRQcm9tcHRUYWJsZSkudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ1R1cm5Bcm91bmRQcm9tcHRUYWJsZSBzaG91bGQgYmUgYSBEeW5hbW9EQiB0YWJsZScsICgpID0+IHtcclxuICAgICAgY29uc3QgdGFibGUgPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuVHVybkFyb3VuZFByb21wdFRhYmxlO1xyXG4gICAgICBleHBlY3QodGFibGUuVHlwZSkudG9CZSgnQVdTOjpEeW5hbW9EQjo6VGFibGUnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ1R1cm5Bcm91bmRQcm9tcHRUYWJsZSBzaG91bGQgaGF2ZSBjb3JyZWN0IGRlbGV0aW9uIHBvbGljaWVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0YWJsZSA9IHRlbXBsYXRlLlJlc291cmNlcy5UdXJuQXJvdW5kUHJvbXB0VGFibGU7XHJcbiAgICAgIGV4cGVjdCh0YWJsZS5EZWxldGlvblBvbGljeSkudG9CZSgnRGVsZXRlJyk7XHJcbiAgICAgIGV4cGVjdCh0YWJsZS5VcGRhdGVSZXBsYWNlUG9saWN5KS50b0JlKCdEZWxldGUnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ1R1cm5Bcm91bmRQcm9tcHRUYWJsZSBzaG91bGQgaGF2ZSBjb3JyZWN0IHByb3BlcnRpZXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRhYmxlID0gdGVtcGxhdGUuUmVzb3VyY2VzLlR1cm5Bcm91bmRQcm9tcHRUYWJsZTtcclxuICAgICAgY29uc3QgcHJvcGVydGllcyA9IHRhYmxlLlByb3BlcnRpZXM7XHJcblxyXG4gICAgICBleHBlY3QocHJvcGVydGllcy5UYWJsZU5hbWUpLnRvRXF1YWwoe1xyXG4gICAgICAgICdGbjo6U3ViJzogJ1R1cm5Bcm91bmRQcm9tcHRUYWJsZSR7RW52aXJvbm1lbnRTdWZmaXh9JyxcclxuICAgICAgfSk7XHJcbiAgICAgIGV4cGVjdChwcm9wZXJ0aWVzLkJpbGxpbmdNb2RlKS50b0JlKCdQQVlfUEVSX1JFUVVFU1QnKTtcclxuICAgICAgZXhwZWN0KHByb3BlcnRpZXMuRGVsZXRpb25Qcm90ZWN0aW9uRW5hYmxlZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChwcm9wZXJ0aWVzLlBvaW50SW5UaW1lUmVjb3ZlcnlTcGVjaWZpY2F0aW9uLlBvaW50SW5UaW1lUmVjb3ZlcnlFbmFibGVkKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocHJvcGVydGllcy5TU0VTcGVjaWZpY2F0aW9uLlNTRUVuYWJsZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChwcm9wZXJ0aWVzLlNTRVNwZWNpZmljYXRpb24uU1NFVHlwZSkudG9CZSgnS01TJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdUdXJuQXJvdW5kUHJvbXB0VGFibGUgc2hvdWxkIGhhdmUgY29ycmVjdCBhdHRyaWJ1dGUgZGVmaW5pdGlvbnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRhYmxlID0gdGVtcGxhdGUuUmVzb3VyY2VzLlR1cm5Bcm91bmRQcm9tcHRUYWJsZTtcclxuICAgICAgY29uc3QgYXR0cmlidXRlRGVmaW5pdGlvbnMgPSB0YWJsZS5Qcm9wZXJ0aWVzLkF0dHJpYnV0ZURlZmluaXRpb25zO1xyXG5cclxuICAgICAgZXhwZWN0KGF0dHJpYnV0ZURlZmluaXRpb25zKS50b0hhdmVMZW5ndGgoMSk7XHJcbiAgICAgIGV4cGVjdChhdHRyaWJ1dGVEZWZpbml0aW9uc1swXS5BdHRyaWJ1dGVOYW1lKS50b0JlKCdpZCcpO1xyXG4gICAgICBleHBlY3QoYXR0cmlidXRlRGVmaW5pdGlvbnNbMF0uQXR0cmlidXRlVHlwZSkudG9CZSgnUycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnVHVybkFyb3VuZFByb21wdFRhYmxlIHNob3VsZCBoYXZlIGNvcnJlY3Qga2V5IHNjaGVtYScsICgpID0+IHtcclxuICAgICAgY29uc3QgdGFibGUgPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuVHVybkFyb3VuZFByb21wdFRhYmxlO1xyXG4gICAgICBjb25zdCBrZXlTY2hlbWEgPSB0YWJsZS5Qcm9wZXJ0aWVzLktleVNjaGVtYTtcclxuXHJcbiAgICAgIGV4cGVjdChrZXlTY2hlbWEpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgICAgZXhwZWN0KGtleVNjaGVtYVswXS5BdHRyaWJ1dGVOYW1lKS50b0JlKCdpZCcpO1xyXG4gICAgICBleHBlY3Qoa2V5U2NoZW1hWzBdLktleVR5cGUpLnRvQmUoJ0hBU0gnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnT3V0cHV0cycsICgpID0+IHtcclxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGFsbCByZXF1aXJlZCBvdXRwdXRzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleHBlY3RlZE91dHB1dHMgPSBbXHJcbiAgICAgICAgJ1R1cm5Bcm91bmRQcm9tcHRUYWJsZU5hbWUnLFxyXG4gICAgICAgICdUdXJuQXJvdW5kUHJvbXB0VGFibGVBcm4nLFxyXG4gICAgICAgICdTdGFja05hbWUnLFxyXG4gICAgICAgICdFbnZpcm9ubWVudFN1ZmZpeCcsXHJcbiAgICAgICAgJ1ZQQ0lkJyxcclxuICAgICAgICAnUHVibGljU3VibmV0SWQnLFxyXG4gICAgICAgICdQcml2YXRlU3VibmV0SWQnLFxyXG4gICAgICAgICdTZWN1cmVEYXRhQnVja2V0TmFtZScsXHJcbiAgICAgICAgJ1NlY3VyaXR5QWxlcnRzVG9waWNBcm4nLFxyXG4gICAgICAgICdFQzJJbnN0YW5jZUlkJ1xyXG4gICAgICBdO1xyXG5cclxuICAgICAgZXhwZWN0ZWRPdXRwdXRzLmZvckVhY2gob3V0cHV0TmFtZSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHRlbXBsYXRlLk91dHB1dHNbb3V0cHV0TmFtZV0pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnVHVybkFyb3VuZFByb21wdFRhYmxlTmFtZSBvdXRwdXQgc2hvdWxkIGJlIGNvcnJlY3QnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG91dHB1dCA9IHRlbXBsYXRlLk91dHB1dHMuVHVybkFyb3VuZFByb21wdFRhYmxlTmFtZTtcclxuICAgICAgZXhwZWN0KG91dHB1dC5EZXNjcmlwdGlvbikudG9CZSgnTmFtZSBvZiB0aGUgRHluYW1vREIgdGFibGUnKTtcclxuICAgICAgZXhwZWN0KG91dHB1dC5WYWx1ZSkudG9FcXVhbCh7IFJlZjogJ1R1cm5Bcm91bmRQcm9tcHRUYWJsZScgfSk7XHJcbiAgICAgIGV4cGVjdChvdXRwdXQuRXhwb3J0Lk5hbWUpLnRvRXF1YWwoe1xyXG4gICAgICAgICdGbjo6U3ViJzogJyR7QVdTOjpTdGFja05hbWV9LVR1cm5Bcm91bmRQcm9tcHRUYWJsZU5hbWUnLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ1R1cm5Bcm91bmRQcm9tcHRUYWJsZUFybiBvdXRwdXQgc2hvdWxkIGJlIGNvcnJlY3QnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG91dHB1dCA9IHRlbXBsYXRlLk91dHB1dHMuVHVybkFyb3VuZFByb21wdFRhYmxlQXJuO1xyXG4gICAgICBleHBlY3Qob3V0cHV0LkRlc2NyaXB0aW9uKS50b0JlKCdBUk4gb2YgdGhlIER5bmFtb0RCIHRhYmxlJyk7XHJcbiAgICAgIGV4cGVjdChvdXRwdXQuVmFsdWUpLnRvRXF1YWwoe1xyXG4gICAgICAgICdGbjo6R2V0QXR0JzogWydUdXJuQXJvdW5kUHJvbXB0VGFibGUnLCAnQXJuJ10sXHJcbiAgICAgIH0pO1xyXG4gICAgICBleHBlY3Qob3V0cHV0LkV4cG9ydC5OYW1lKS50b0VxdWFsKHtcclxuICAgICAgICAnRm46OlN1Yic6ICcke0FXUzo6U3RhY2tOYW1lfS1UdXJuQXJvdW5kUHJvbXB0VGFibGVBcm4nLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ1ZQQyBhbmQgbmV0d29ya2luZyBvdXRwdXRzIHNob3VsZCBiZSBjb3JyZWN0JywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QodGVtcGxhdGUuT3V0cHV0cy5WUENJZC5WYWx1ZSkudG9FcXVhbCh7IFJlZjogJ1NlY3VyZVZQQycgfSk7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5PdXRwdXRzLlB1YmxpY1N1Ym5ldElkLlZhbHVlKS50b0VxdWFsKHsgUmVmOiAnUHVibGljU3VibmV0JyB9KTtcclxuICAgICAgZXhwZWN0KHRlbXBsYXRlLk91dHB1dHMuUHJpdmF0ZVN1Ym5ldElkLlZhbHVlKS50b0VxdWFsKHsgUmVmOiAnUHJpdmF0ZVN1Ym5ldCcgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1RlbXBsYXRlIFZhbGlkYXRpb24nLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSB2YWxpZCBKU09OIHN0cnVjdHVyZScsICgpID0+IHtcclxuICAgICAgZXhwZWN0KHRlbXBsYXRlKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QodHlwZW9mIHRlbXBsYXRlKS50b0JlKCdvYmplY3QnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBub3QgaGF2ZSBhbnkgdW5kZWZpbmVkIG9yIG51bGwgcmVxdWlyZWQgc2VjdGlvbnMnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5BV1NUZW1wbGF0ZUZvcm1hdFZlcnNpb24pLm5vdC50b0JlTnVsbCgpO1xyXG4gICAgICBleHBlY3QodGVtcGxhdGUuRGVzY3JpcHRpb24pLm5vdC50b0JlTnVsbCgpO1xyXG4gICAgICBleHBlY3QodGVtcGxhdGUuUGFyYW1ldGVycykubm90LnRvQmVOdWxsKCk7XHJcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMpLm5vdC50b0JlTnVsbCgpO1xyXG4gICAgICBleHBlY3QodGVtcGxhdGUuT3V0cHV0cykubm90LnRvQmVOdWxsKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBwcm9wZXIgcmVzb3VyY2UgY291bnQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc291cmNlQ291bnQgPSBPYmplY3Qua2V5cyh0ZW1wbGF0ZS5SZXNvdXJjZXMpLmxlbmd0aDtcclxuICAgICAgZXhwZWN0KHJlc291cmNlQ291bnQpLnRvQmVHcmVhdGVyVGhhbigxNSk7IC8vIFdlIGhhdmUgbWFueSBzZWN1cml0eSByZXNvdXJjZXNcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIHByb3BlciBwYXJhbWV0ZXIgY291bnQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhcmFtZXRlckNvdW50ID0gT2JqZWN0LmtleXModGVtcGxhdGUuUGFyYW1ldGVycykubGVuZ3RoO1xyXG4gICAgICBleHBlY3QocGFyYW1ldGVyQ291bnQpLnRvQmUoNSk7IC8vIEVudmlyb25tZW50U3VmZml4LCBBbGxvd2VkU1NIQ0lEUiwgTm90aWZpY2F0aW9uRW1haWwsIEVuYWJsZUd1YXJkRHV0eSwgRW5hYmxlRGV0YWlsZWRNb25pdG9yaW5nXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1Jlc291cmNlIE5hbWluZyBDb252ZW50aW9uJywgKCkgPT4ge1xyXG4gICAgdGVzdCgndGFibGUgbmFtZSBzaG91bGQgZm9sbG93IG5hbWluZyBjb252ZW50aW9uIHdpdGggZW52aXJvbm1lbnQgc3VmZml4JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0YWJsZSA9IHRlbXBsYXRlLlJlc291cmNlcy5UdXJuQXJvdW5kUHJvbXB0VGFibGU7XHJcbiAgICAgIGNvbnN0IHRhYmxlTmFtZSA9IHRhYmxlLlByb3BlcnRpZXMuVGFibGVOYW1lO1xyXG5cclxuICAgICAgZXhwZWN0KHRhYmxlTmFtZSkudG9FcXVhbCh7XHJcbiAgICAgICAgJ0ZuOjpTdWInOiAnVHVybkFyb3VuZFByb21wdFRhYmxlJHtFbnZpcm9ubWVudFN1ZmZpeH0nLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ2V4cG9ydCBuYW1lcyBzaG91bGQgZm9sbG93IG5hbWluZyBjb252ZW50aW9uJywgKCkgPT4ge1xyXG4gICAgICBPYmplY3Qua2V5cyh0ZW1wbGF0ZS5PdXRwdXRzKS5mb3JFYWNoKG91dHB1dEtleSA9PiB7XHJcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gdGVtcGxhdGUuT3V0cHV0c1tvdXRwdXRLZXldO1xyXG4gICAgICAgIGV4cGVjdChvdXRwdXQuRXhwb3J0Lk5hbWUpLnRvRXF1YWwoe1xyXG4gICAgICAgICAgJ0ZuOjpTdWInOiBgXFwke0FXUzo6U3RhY2tOYW1lfS0ke291dHB1dEtleX1gLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXX0=