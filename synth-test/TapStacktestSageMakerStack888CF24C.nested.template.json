{
 "Resources": {
  "SageMakerSecurityGroup1DE5B336": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Security group for SageMaker resources",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "Tags": [
     {
      "Key": "Author",
      "Value": "unknown"
     },
     {
      "Key": "Environment",
      "Value": "test"
     },
     {
      "Key": "Repository",
      "Value": "unknown"
     }
    ],
    "VpcId": {
     "Ref": "referencetoTapStacktestNetworkingStackNestedStackNetworkingStackNestedStackResource30904E1EOutputsTapStacktestNetworkingStackTrainingVPC6C86E502Ref"
    }
   },
   "Metadata": {
    "aws:cdk:path": "TapStacktest/SageMakerStack/SageMakerSecurityGroup/Resource"
   }
  },
  "NotebookExecutionRoleB14E75C1": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "sagemaker.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/AmazonSageMakerFullAccess"
       ]
      ]
     }
    ],
    "Tags": [
     {
      "Key": "Author",
      "Value": "unknown"
     },
     {
      "Key": "Environment",
      "Value": "test"
     },
     {
      "Key": "Repository",
      "Value": "unknown"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "TapStacktest/SageMakerStack/NotebookExecutionRole/Resource"
   }
  },
  "NotebookExecutionRoleDefaultPolicyFEDAB001": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:Abort*",
        "s3:DeleteObject*",
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           {
            "Ref": "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackDatasetBucketAF78C072Arn"
           },
           "/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Ref": "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackModelBucket5B9CD771Arn"
           },
           "/*"
          ]
         ]
        },
        {
         "Ref": "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackDatasetBucketAF78C072Arn"
        },
        {
         "Ref": "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackModelBucket5B9CD771Arn"
        }
       ]
      },
      {
       "Action": [
        "ecr:BatchCheckLayerAvailability",
        "ecr:BatchGetImage",
        "ecr:CompleteLayerUpload",
        "ecr:GetDownloadUrlForLayer",
        "ecr:InitiateLayerUpload",
        "ecr:PutImage",
        "ecr:UploadLayerPart"
       ],
       "Effect": "Allow",
       "Resource": {
        "Ref": "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackTrainingRepository701D07DEArn"
       }
      },
      {
       "Action": "ecr:GetAuthorizationToken",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "NotebookExecutionRoleDefaultPolicyFEDAB001",
    "Roles": [
     {
      "Ref": "NotebookExecutionRoleB14E75C1"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "TapStacktest/SageMakerStack/NotebookExecutionRole/DefaultPolicy/Resource"
   }
  },
  "TrainingJobRoleFCAC7131": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "sagemaker.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Policies": [
     {
      "PolicyDocument": {
       "Statement": [
        {
         "Action": [
          "cloudwatch:PutMetricData",
          "ecr:BatchCheckLayerAvailability",
          "ecr:BatchGetImage",
          "ecr:GetAuthorizationToken",
          "ecr:GetDownloadUrlForLayer",
          "logs:CreateLogGroup",
          "logs:CreateLogStream",
          "logs:PutLogEvents",
          "sagemaker:*"
         ],
         "Effect": "Allow",
         "Resource": "*"
        }
       ],
       "Version": "2012-10-17"
      },
      "PolicyName": "TrainingPolicy"
     }
    ],
    "Tags": [
     {
      "Key": "Author",
      "Value": "unknown"
     },
     {
      "Key": "Environment",
      "Value": "test"
     },
     {
      "Key": "Repository",
      "Value": "unknown"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "TapStacktest/SageMakerStack/TrainingJobRole/Resource"
   }
  },
  "TrainingJobRoleDefaultPolicyA979CC57": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           {
            "Ref": "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackDatasetBucketAF78C072Arn"
           },
           "/*"
          ]
         ]
        },
        {
         "Ref": "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackDatasetBucketAF78C072Arn"
        }
       ]
      },
      {
       "Action": [
        "s3:Abort*",
        "s3:DeleteObject*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           {
            "Ref": "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackModelBucket5B9CD771Arn"
           },
           "/*"
          ]
         ]
        },
        {
         "Ref": "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackModelBucket5B9CD771Arn"
        }
       ]
      },
      {
       "Action": [
        "ecr:BatchCheckLayerAvailability",
        "ecr:BatchGetImage",
        "ecr:GetDownloadUrlForLayer"
       ],
       "Effect": "Allow",
       "Resource": {
        "Ref": "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackTrainingRepository701D07DEArn"
       }
      },
      {
       "Action": "ecr:GetAuthorizationToken",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "TrainingJobRoleDefaultPolicyA979CC57",
    "Roles": [
     {
      "Ref": "TrainingJobRoleFCAC7131"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "TapStacktest/SageMakerStack/TrainingJobRole/DefaultPolicy/Resource"
   }
  },
  "NotebookInstance": {
   "Type": "AWS::SageMaker::NotebookInstance",
   "Properties": {
    "DefaultCodeRepository": "https://github.com/aws/amazon-sagemaker-examples.git",
    "InstanceType": "ml.t3.medium",
    "NotebookInstanceName": "training-notebook-test",
    "RoleArn": {
     "Fn::GetAtt": [
      "NotebookExecutionRoleB14E75C1",
      "Arn"
     ]
    },
    "SecurityGroupIds": [
     {
      "Fn::GetAtt": [
       "SageMakerSecurityGroup1DE5B336",
       "GroupId"
      ]
     }
    ],
    "SubnetId": {
     "Ref": "referencetoTapStacktestNetworkingStackNestedStackNetworkingStackNestedStackResource30904E1EOutputsTapStacktestNetworkingStackTrainingVPCPublicSubnet1SubnetBDA21483Ref"
    },
    "Tags": [
     {
      "Key": "Author",
      "Value": "unknown"
     },
     {
      "Key": "Environment",
      "Value": "test"
     },
     {
      "Key": "Repository",
      "Value": "unknown"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "TapStacktest/SageMakerStack/NotebookInstance"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/9VSwWoCMRT8FnOUmNqlUNjb1kPxoqLeREpMnjZuNlmSF0XC/nvJrlpEKAUv7SkwM+/NZHgZy4YvbNjjRz8QshxotWFxAh5BLpCLkvKj/4ggMhYXIIJTeHp3NtSrSA61IDnpE0okeOFUjcqaM8K1tsdC62nAjQ1GkhxdgGZNR1tzs6ehilcszq2GVSTc+1CBfDuRPJLaKSNUzXUhhA0GL6tbTRooxNWxoaTihu9AzqxWQoEn+SreYKfCnbXrhkbCpVza2cWiU6SZM4vIxefYaGXgypE++QX5895H2AfKUd9h225a9N+V0J5P+hzt4OR3jbK0iblLeA/LdNkIFRj0N7aPwn8qTdtVV1NDPd9BxUtwbLQ1E4uwsbYcG4/cCGjoHLwNTkDbZ0qWZqcB64ANNVYC2/unQ5ax51c27O29UgMXDKoK2Lx7vwA6GQqjRwQAAA=="
   },
   "Metadata": {
    "aws:cdk:path": "TapStacktest/SageMakerStack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "NotebookInstanceName": {
   "Description": "SageMaker notebook instance name",
   "Value": {
    "Fn::GetAtt": [
     "NotebookInstance",
     "NotebookInstanceName"
    ]
   }
  },
  "TrainingRoleArn": {
   "Description": "ARN of the IAM role for SageMaker training jobs",
   "Value": {
    "Fn::GetAtt": [
     "TrainingJobRoleFCAC7131",
     "Arn"
    ]
   }
  },
  "TrainingJobConfig": {
   "Description": "Configuration for SageMaker training jobs with spot instances",
   "Value": {
    "Fn::Join": [
     "",
     [
      "{\"RoleArn\":\"",
      {
       "Fn::GetAtt": [
        "TrainingJobRoleFCAC7131",
        "Arn"
       ]
      },
      "\",\"EnableManagedSpotTraining\":true,\"MaxRuntimeInSeconds\":86400,\"MaxWaitTimeInSeconds\":172800,\"VpcConfig\":{\"SecurityGroupIds\":[\"",
      {
       "Fn::GetAtt": [
        "SageMakerSecurityGroup1DE5B336",
        "GroupId"
       ]
      },
      "\"],\"Subnets\":[]}}"
     ]
    ]
   }
  }
 },
 "Parameters": {
  "referencetoTapStacktestNetworkingStackNestedStackNetworkingStackNestedStackResource30904E1EOutputsTapStacktestNetworkingStackTrainingVPC6C86E502Ref": {
   "Type": "String"
  },
  "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackDatasetBucketAF78C072Arn": {
   "Type": "String"
  },
  "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackModelBucket5B9CD771Arn": {
   "Type": "String"
  },
  "referencetoTapStacktestStorageStackNestedStackStorageStackNestedStackResource6D3E7340OutputsTapStacktestStorageStackTrainingRepository701D07DEArn": {
   "Type": "String"
  },
  "referencetoTapStacktestNetworkingStackNestedStackNetworkingStackNestedStackResource30904E1EOutputsTapStacktestNetworkingStackTrainingVPCPublicSubnet1SubnetBDA21483Ref": {
   "Type": "String"
  }
 }
}