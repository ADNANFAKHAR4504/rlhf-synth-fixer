# LocalStack Migration Configuration
# Central configuration for localstack-migrate command and related agents
# Version: 1.0.0

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ITERATION SETTINGS
# Optimized for faster fixing with local pre-validation
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
iteration:
  max_fix_iterations: 10 # Maximum fix iterations (increased to ensure production ready)
  max_cicd_iterations: 10 # Maximum CI/CD monitoring iterations after PR push
  max_deployment_attempts: 3 # Maximum deployment attempts per iteration
  use_batch_fix: true # Enable batch fix approach (apply ALL fixes before re-deploy)
  continue_until_production_ready: true # MUST iterate until all CI/CD jobs pass
  run_local_prevalidation: true # NEW: Run local validation before pushing to CI/CD
  prevalidation_script: '.claude/scripts/localstack-prevalidate.sh' # Path to pre-validation script

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TIMEOUT SETTINGS (in seconds)
# Optimized for faster execution - LocalStack deployments should be quick
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
timeouts:
  localstack_health_check: 5 # Timeout for LocalStack health check
  deployment_timeout: 180 # Reduced from 300 â†’ 180 (3 min - LocalStack is fast)
  test_timeout: 60 # Reduced from 120 â†’ 60 (1 min - tests should be quick)
  bootstrap_timeout: 60 # Reduced from 120 â†’ 60 (1 min - bootstrap is fast)
  npm_install_timeout: 120 # Reduced from 180 â†’ 120 (2 min with cache)
  pip_install_timeout: 60 # Reduced from 120 â†’ 60 (1 min with cache)
  synth_timeout: 60 # NEW: CDK/Terraform synthesis timeout
  lint_timeout: 30 # NEW: Linting timeout
  compile_timeout: 60 # NEW: TypeScript/Python compilation timeout
  cicd_poll_interval: 20 # NEW: Reduced from 30 â†’ 20 (faster status checks)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LOCALSTACK SETTINGS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
localstack:
  endpoint: 'http://localhost:4566'
  region: 'us-east-1'
  account_id: '000000000000'
  access_key: 'test'
  secret_key: 'test'
  reset_state_before_deploy: false # Set to false for parallel execution
  unique_stack_names: true # Use tap-stack-{PR_ID} for parallel safety

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# BATCH FIX STRATEGY SETTINGS
# Aggressive preventive fixes to minimize CI/CD iterations
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
batch_fix:
  enabled: true # Enable batch fix approach
  apply_preventive_fixes: true # Apply fixes even without specific errors
  single_comprehensive_push: true # NEW: Apply ALL fixes in single commit before push

  # Fix priority order (applied in this sequence)
  # IMPORTANT: metadata_fix MUST be first - CI/CD validates metadata.json before anything else
  fix_priority:
    - metadata_fix # ðŸ”´ CRITICAL - MUST BE FIRST - Schema compliance for CI/CD
    - typescript_fix # ðŸ”´ CRITICAL - Run tsc and fix type errors
    - lint_fix # ðŸ”´ CRITICAL - Run lint:fix before push
    - endpoint_config # ðŸ”´ Critical - LocalStack endpoint detection
    - s3_path_style # ðŸ”´ Critical - S3 path-style access
    - removal_policy # ðŸŸ¡ High - RemovalPolicy.DESTROY
    - test_config # ðŸŸ¡ High - Test endpoint configuration
    - jest_config # ðŸŸ¡ High - Jest configuration (test vs tests folder)
    - iam_simplify # ðŸŸ¡ Medium - IAM policy simplification
    - resource_naming # ðŸŸ¡ Medium - Resource naming simplification
    - unsupported_service # ðŸŸ¡ Medium - Unsupported service conditionals
    - default_parameters # ðŸŸ¢ Low - Default parameter values

  # Preventive fixes (apply even if no error detected)
  # EXPANDED: Apply more fixes upfront to reduce iterations
  preventive_fixes:
    - metadata_fix # ALWAYS - Required for CI/CD to pass
    - typescript_fix # ALWAYS - Compile check before push
    - lint_fix # ALWAYS - Auto-fix lint issues
    - endpoint_config # Almost always needed
    - s3_path_style # If using S3/buckets
    - removal_policy # Always for LocalStack
    - test_config # If test/ directory exists
    - jest_config # If jest.config.js exists

  # Conditional fixes (only apply if specific error detected)
  conditional_fixes:
    iam_simplify:
      error_patterns:
        - 'policy'
        - 'iam'
        - 'principal'
        - 'malformed'
    resource_naming:
      error_patterns:
        - 'name'
        - 'invalid.*bucket'
        - 'too long'
        - 'character'
    unsupported_service:
      error_patterns:
        - 'not supported'
        - 'unsupported'
        - 'not available'
        - 'appsync'
        - 'amplify'
        - 'sagemaker'
    default_parameters:
      error_patterns:
        - 'parameter'
        - 'missing.*required'
        - 'undefined'

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SERVICE COMPATIBILITY (LocalStack Community Edition)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
service_compatibility:
  # High compatibility - full support in Community
  high:
    - s3
    - dynamodb
    - sqs
    - sns
    - iam
    - kms
    - cloudwatch
    - logs
    - secretsmanager
    - ssm
    - eventbridge
    - events

  # Medium compatibility - mostly supported
  medium:
    - lambda
    - apigateway
    - stepfunctions
    - kinesis
    - cloudformation

  # Low compatibility - limited or Pro-only
  low:
    - ecs
    - rds
    - ec2
    - elasticache
    - elasticsearch

  # Not supported in Community (Pro only)
  pro_only:
    - eks
    - appsync
    - amplify
    - sagemaker
    - cognito-idp # Limited in Community

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SMART SELECTION SCORING
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
smart_selection:
  enabled: true
  base_score: 100

  # Score adjustments based on services used
  service_penalties:
    low_compatibility: -25 # Penalty for each low-compat service
    medium_compatibility: -10 # Penalty for each medium-compat service
    pro_only: -50 # Penalty for pro-only services (likely to fail)

  # Score bonuses based on platform
  platform_bonuses:
    cfn: 10 # CloudFormation is most compatible
    cdk: 5 # CDK has good compatibility
    tf: 0 # Terraform is neutral
    pulumi: -5 # Pulumi has some quirks

  # Score bonuses based on complexity
  complexity_bonuses:
    easy: 10
    medium: 0
    hard: -10
    expert: -20

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PARALLEL EXECUTION SETTINGS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
parallel:
  enabled: true
  max_concurrent_agents: 10 # Maximum parallel agents
  use_git_worktrees: true # Use git worktrees for isolation
  use_file_locking: true # Lock migration log for concurrent writes
  lock_timeout_seconds: 30 # Timeout for acquiring file lock
  lock_retry_attempts: 10 # Number of retry attempts for lock
  stale_lock_timeout: 60 # Consider lock stale after this many seconds

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WORKING DIRECTORY SETTINGS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
worktree:
  base_path: 'worktree'
  localstack_pattern: 'localstack-{pr_id}' # Working directory for deployment
  git_pattern: 'git-{pr_id}' # Git worktree for branch operations
  github_pattern: 'github-{pr_id}' # Temp directory for GitHub fetches
  auto_cleanup: true # Clean up after completion
  prune_orphaned: true # Prune orphaned git worktrees

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PR CREATION SETTINGS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
pr_creation:
  branch_pattern: 'ls-synth-{pr_id}' # Branch naming pattern
  pr_id_prefix: 'ls-' # Prefix for new PR IDs (ls-Pr1234)
  title_pattern: '[LocalStack] {ls_pr_id} - {platform}/{language}'
  force_push: true # Force push to handle existing branches
  auto_create_pr: true # Automatically create GitHub PR

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# MIGRATION LOG SETTINGS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
migration_log:
  path: '.claude/reports/localstack-migrations.json'
  lock_file: '.claude/reports/.migration-log.lock'
  track_iterations: true
  track_fixes_applied: true
  include_timestamps: true

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LOGGING CONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
logging:
  level: INFO # DEBUG, INFO, WARN, ERROR
  verbose_deployment: false # Show full deployment output
  verbose_test_output: false # Show full test output
  log_to_file: false # Log to file (in addition to console)
  log_directory: '/tmp/localstack-migrate-logs'

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# EXIT CODES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
exit_codes:
  success: 0 # Migration successful, PR created
  fix_failed: 1 # Unable to fix within max iterations
  unsupported_services: 2 # Uses Pro-only services
  localstack_not_running: 3 # LocalStack is not available
  github_error: 4 # GitHub CLI error
  git_error: 5 # Git operation failed

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PLATFORM-SPECIFIC SETTINGS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
platforms:
  cdk:
    bootstrap_required: true
    bootstrap_command: 'cdklocal bootstrap aws://{account_id}/{region}'
    deploy_command: 'cdklocal deploy --all --require-approval never'
    destroy_command: 'cdklocal destroy --all --force'
    output_directory: 'cdk.out'

  cfn:
    bootstrap_required: false
    deploy_command: 'awslocal cloudformation create-stack --stack-name {stack_name} --template-body file://lib/TapStack.yml --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM'
    wait_command: 'awslocal cloudformation wait stack-create-complete --stack-name {stack_name}'
    destroy_command: 'awslocal cloudformation delete-stack --stack-name {stack_name}'

  tf:
    bootstrap_required: false
    init_command: 'tflocal init'
    deploy_command: 'tflocal apply -auto-approve'
    destroy_command: 'tflocal destroy -auto-approve'

  pulumi:
    bootstrap_required: true
    backend: 'file://~/.pulumi-localstack'
    deploy_command: 'pulumi up --yes --stack {stack_name}'
    destroy_command: 'pulumi destroy --yes --stack {stack_name}'

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# GITHUB SETTINGS
# These settings are used by the modular scripts in .claude/scripts/:
#   - localstack-common.sh (loads GITHUB_REPO from here)
#   - localstack-fetch-github.sh (fetches PRs from this repo)
#   - localstack-create-pr.sh (creates PRs in this repo)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
github:
  repo: 'TuringGpt/iac-test-automations' # Central config - used by all scripts
  fetch_method: 'api' # api, clone, or checkout
  api_timeout: 30 # GitHub API timeout
  clone_depth: 1 # Shallow clone depth

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# METADATA SCHEMA COMPLIANCE
# The schema at config/schemas/metadata.schema.json has
# additionalProperties: false, so we MUST sanitize metadata.json
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
metadata:
  schema_path: 'config/schemas/metadata.schema.json'
  sanitize_on_migrate: true # Remove fields not in schema
  validate_before_commit: true # Validate against schema before creating PR

  # Fields that MUST be removed (not allowed by schema)
  fields_to_remove:
    - task_id # Use po_id instead
    - training_quality
    - coverage
    - author
    - dockerS3Location
    - pr_id
    - original_pr_id
    - localstack_migration

  # Valid subtask values (from schema enum)
  valid_subtasks:
    - 'Provisioning of Infrastructure Environments'
    - 'Application Deployment'
    - 'CI/CD Pipeline Integration'
    - 'Failure Recovery and High Availability'
    - 'Security, Compliance, and Governance'
    - 'IaC Program Optimization'
    - 'Infrastructure QA and Management'

  # Subtask mapping (old invalid values to valid values)
  subtask_mapping:
    'Security and Compliance Implementation': 'Security, Compliance, and Governance'
    'Security Configuration': 'Security, Compliance, and Governance'
    'Database Management': 'Provisioning of Infrastructure Environments'
    'Network Configuration': 'Provisioning of Infrastructure Environments'
    'Monitoring Setup': 'Infrastructure QA and Management'
    'Performance Optimization': 'IaC Program Optimization'
    'Access Control': 'Security, Compliance, and Governance'

  # Valid subject_labels (from schema enum)
  valid_subject_labels:
    - 'Environment Migration'
    - 'Cloud Environment Setup'
    - 'Multi-Environment Consistency'
    - 'Web Application Deployment'
    - 'Serverless Infrastructure (Functions as Code)'
    - 'CI/CD Pipeline'
    - 'Failure Recovery Automation'
    - 'Security Configuration as Code'
    - 'IaC Diagnosis/Edits'
    - 'IaC Optimization'
    - 'Infrastructure Analysis/Monitoring'
    - 'General Infrastructure Tooling QA'

  # Subject label mapping (old invalid values to valid values)
  subject_label_mapping:
    'Security Configuration': 'Security Configuration as Code'
    'Database Management': 'General Infrastructure Tooling QA'
    'Network Configuration': 'Cloud Environment Setup'
    'Access Control': 'Security Configuration as Code'
    'Monitoring Setup': 'Infrastructure Analysis/Monitoring'
    'Performance Optimization': 'IaC Optimization'

  # Default values if mapping fails
  default_subtask: 'Infrastructure QA and Management'
  default_subject_label: 'General Infrastructure Tooling QA'

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TRAINING QUALITY SETTINGS
# Configuration for achieving training quality scores of 9+
# See: .claude/docs/guides/localstack-training-quality-guide.md
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
training_quality:
  # Minimum required score for PR approval
  min_score: 8
  target_score: 9 # Aim for this score when applying fixes

  # Enable training quality enhancement during fixes
  enhance_training_quality: true

  # Category A fixes - LocalStack compatible (HIGH priority for score boost)
  # Each provides +1 to MODEL_FAILURES adjustment (max +2)
  category_a_fixes:
    kms_encryption:
      enabled: true
      description: 'Add KMS encryption to data stores'
      applicable_services:
        - s3
        - dynamodb
        - sqs
        - sns
        - secretsmanager
        - ssm
      patterns_to_check:
        - 'encryption.*KMS'
        - 'encryptionKey'
        - 'kms.Key'
      fix_if_missing: true

    iam_least_privilege:
      enabled: true
      description: 'Replace overly permissive IAM with least-privilege'
      applicable_services:
        - iam
        - lambda
        - s3
        - dynamodb
      patterns_indicating_issue:
        - 'actions.*\*'
        - 'resources.*\*'
        - 'Effect.*Allow.*Action.*\*'
      fix_if_detected: true

    cloudwatch_monitoring:
      enabled: true
      description: 'Add CloudWatch alarms and monitoring'
      applicable_services:
        - cloudwatch
        - logs
        - lambda
        - dynamodb
        - sqs
      patterns_to_check:
        - 'Alarm'
        - 'metricErrors'
        - 'Dashboard'
      fix_if_missing: true

    error_handling_dlq:
      enabled: true
      description: 'Add dead-letter queues for error handling'
      applicable_services:
        - sqs
        - lambda
        - sns
        - eventbridge
      patterns_to_check:
        - 'deadLetterQueue'
        - 'DeadLetterQueue'
        - 'dlq'
        - 'retryAttempts'
      fix_if_missing: true

    secretsmanager_integration:
      enabled: true
      description: 'Replace hardcoded credentials with SecretsManager'
      applicable_services:
        - secretsmanager
        - lambda
      patterns_indicating_issue:
        - 'password.*=.*["\x27]'
        - 'secret.*=.*["\x27]'
        - 'apiKey.*=.*["\x27]'
      fix_if_detected: true

  # Complexity factors - each provides +1 (max +2 total)
  complexity_factors:
    multiple_services:
      min_count: 3 # Need 3+ services for +1 bonus
      high_value_services: # Count these for the factor
        - s3
        - dynamodb
        - lambda
        - sqs
        - sns
        - apigateway
        - eventbridge
        - stepfunctions

    security_practices:
      required_count: 2 # Need 2+ of these for +1 bonus
      practices:
        - kms_encryption
        - iam_least_privilege
        - encryption_at_rest
        - encryption_in_transit
        - resource_policies

    event_driven:
      required_patterns: # Need any of these for +1 bonus
        - eventbridge_rules
        - sqs_triggers
        - sns_subscriptions
        - lambda_event_sources

    serverless_architecture:
      required_services: # Need Lambda + at least one of these
        primary: lambda
        secondary:
          - apigateway
          - stepfunctions
          - eventbridge

  # Services to prioritize for training quality
  # These are HIGH compatibility and support Category A fixes
  priority_services:
    tier_1: # Best for training quality (HIGH compatibility + Category A opportunities)
      - s3 # KMS, policies, lifecycle
      - dynamodb # KMS, IAM, streams
      - lambda # IAM, DLQ, monitoring
      - kms # Core security service
      - iam # Policies, roles

    tier_2: # Good for training quality (HIGH compatibility)
      - sqs # Encryption, DLQ
      - sns # Encryption, policies
      - cloudwatch # Monitoring, alarms
      - eventbridge # Event patterns
      - secretsmanager # Credential management

    tier_3: # Usable (MEDIUM compatibility)
      - apigateway # API patterns
      - stepfunctions # Workflows

  # Patterns to detect and suggest fixes
  enhancement_patterns:
    # Pattern: Unencrypted S3 bucket
    s3_unencrypted:
      detect: 'new.*Bucket\s*\([^)]*\)\s*(?!.*encryption)'
      suggest: 'Add encryption: s3.BucketEncryption.KMS with custom KMS key'
      category: 'A'
      boost: 1

    # Pattern: Unencrypted DynamoDB
    dynamodb_unencrypted:
      detect: 'new.*Table\s*\([^)]*\)\s*(?!.*encryption)'
      suggest: 'Add encryption: dynamodb.TableEncryption.CUSTOMER_MANAGED'
      category: 'A'
      boost: 1

    # Pattern: Lambda without DLQ
    lambda_no_dlq:
      detect: 'new.*Function\s*\([^)]*\)\s*(?!.*deadLetterQueue)'
      suggest: 'Add deadLetterQueue with SQS DLQ'
      category: 'A'
      boost: 1

    # Pattern: Overly permissive IAM
    iam_star_permissions:
      detect: 'actions.*\[.*\*.*\]|resources.*\[.*\*.*\]'
      suggest: 'Replace with specific actions and resource ARNs'
      category: 'A'
      boost: 1

    # Pattern: Missing CloudWatch alarms
    no_cloudwatch_alarms:
      detect: '(?!.*new.*Alarm)'
      suggest: 'Add CloudWatch alarms for key metrics (errors, throttles)'
      category: 'A'
      boost: 1

    # Pattern: Hardcoded credentials
    hardcoded_credentials:
      detect: '(password|secret|apiKey|token)\s*[:=]\s*["\x27][^"\x27]+'
      suggest: 'Use SecretsManager for credential storage'
      category: 'A'
      boost: 1

  # Assessment output format
  assessment_template: |
    ## Training Quality Assessment (LocalStack)

    **Target Score**: {target}/10
    **Current Score**: {score}/10

    ### Scoring Breakdown
    - Base Score: 8
    - MODEL_FAILURES Adjustment: {model_failures_adj} ({category_a_count} Category A fixes)
    - Complexity Adjustment: {complexity_adj} ({complexity_factors})

    ### Category A Fixes Applied
    {category_a_fixes_list}

    ### Complexity Factors Present
    - Multiple Services (3+): {multiple_services}
    - Security Practices: {security_practices}
    - Event-Driven: {event_driven}
    - Serverless: {serverless}

    ### LocalStack Compatibility
    - Services Used: {services_list}
    - Compatibility Level: {compatibility_level}

    ### Status: {status}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# INTELLIGENT FIX ORDERING (Enhancement #2)
# Dynamic fix ordering based on error analysis and task context
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
intelligent_fixes:
  enabled: true
  analyze_error_patterns: true # Analyze errors to prioritize fixes
  prioritize_by_frequency: true # Most common fixes first
  skip_inapplicable_fixes: true # Don't run S3 fixes if no S3 used
  learn_from_history: true # Track which fixes worked for similar tasks
  
  # Error pattern to fix mapping (for intelligent ordering)
  error_fix_mapping:
    endpoint_errors:
      patterns:
        - 'ECONNREFUSED'
        - 'endpoint'
        - '4566'
        - 'localhost'
        - 'connection refused'
      fix: 'endpoint_config'
      priority: 1
      
    s3_errors:
      patterns:
        - 'S3'
        - 'bucket'
        - 'NoSuchBucket'
        - 'path.style'
        - 'virtual.hosted'
      fix: 's3_path_style'
      priority: 2
      
    iam_errors:
      patterns:
        - 'AccessDenied'
        - 'unauthorized'
        - 'policy'
        - 'principal'
        - 'malformed'
      fix: 'iam_simplify'
      priority: 3
      
    type_errors:
      patterns:
        - 'TypeError'
        - 'type.*error'
        - 'TS[0-9]+'
        - 'cannot find'
      fix: 'typescript_fix'
      priority: 1
      
    lint_errors:
      patterns:
        - 'eslint'
        - 'prettier'
        - 'lint'
        - 'formatting'
      fix: 'lint_fix'
      priority: 2
      
    test_errors:
      patterns:
        - 'jest'
        - 'test.*failed'
        - 'assertion'
        - 'expect'
      fix: 'test_config'
      priority: 4
      
    metadata_errors:
      patterns:
        - 'metadata'
        - 'schema'
        - 'validation'
        - 'additionalProperties'
      fix: 'metadata_fix'
      priority: 0 # Highest priority
      
  # Service detection patterns (for skip_inapplicable_fixes)
  service_detection:
    s3:
      patterns:
        - 'new.*Bucket'
        - 's3\.Bucket'
        - 'aws_s3'
        - 'S3Bucket'
    dynamodb:
      patterns:
        - 'new.*Table'
        - 'dynamodb\.Table'
        - 'aws_dynamodb'
        - 'DynamoDBTable'
    lambda:
      patterns:
        - 'new.*Function'
        - 'lambda\.Function'
        - 'aws_lambda'
        - 'LambdaFunction'
    sqs:
      patterns:
        - 'new.*Queue'
        - 'sqs\.Queue'
        - 'aws_sqs'
        - 'SQSQueue'
    sns:
      patterns:
        - 'new.*Topic'
        - 'sns\.Topic'
        - 'aws_sns'
        - 'SNSTopic'
    apigateway:
      patterns:
        - 'RestApi'
        - 'HttpApi'
        - 'apigateway'
        - 'aws_api_gateway'

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PRE-MIGRATION COMPATIBILITY CHECK (Enhancement #3)
# Assess migration feasibility before starting
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
compatibility_check:
  enabled: true
  script_path: '.claude/scripts/localstack-compatibility-check.sh'
  
  # Scoring weights
  scoring:
    base_score: 100
    high_compat_service: 0 # No penalty
    medium_compat_service: -10
    low_compat_service: -25
    pro_only_service: -50
    
    # Platform adjustments
    platform_scores:
      cfn-yaml: 10
      cfn-json: 10
      cdk-ts: 5
      cdk-py: 5
      cdk-go: 0
      cdk-java: 0
      tf-hcl: 0
      pulumi-ts: -5
      pulumi-py: -5
      pulumi-go: -10
      
    # Complexity adjustments
    complexity_scores:
      medium: 0
      hard: -10
      expert: -20
      
  # Success probability thresholds
  thresholds:
    high_probability: 80 # >= 80% = high success chance
    medium_probability: 60 # >= 60% = medium success chance
    low_probability: 40 # >= 40% = low success chance
    # < 40% = likely to fail
    
  # Time estimation (minutes)
  time_estimates:
    base_time: 5
    per_fix_time: 2
    per_low_compat_service: 3
    per_medium_compat_service: 1
    
  # Output format
  output_template: |
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ðŸ“Š MIGRATION COMPATIBILITY CHECK
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Task: {task_id} ({platform})
    Compatibility Score: {score}/100
    
    {services_section}
    
    ðŸ“‹ Predicted Fixes Needed:
    {predicted_fixes}
    
    â±ï¸ Estimated Time: {estimated_time}
    ðŸŽ¯ Success Probability: {probability}%
    
    Recommendation: {recommendation}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# FIX CACHING & TEMPLATES (Enhancement #4)
# Cache successful fix patterns for reuse
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
fix_templates:
  enabled: true
  template_directory: '.claude/templates/localstack-fixes/'
  cache_directory: '.claude/cache/fix-patterns/'
  
  # Save successful fix patterns
  save_successful_fixes: true
  max_cached_patterns: 100
  
  # Template matching
  match_by:
    - platform
    - language
    - services_used
    
  # Platform-specific templates
  templates:
    cdk-ts-basic:
      description: 'CDK TypeScript basic setup'
      applies_to:
        platform: cdk
        language: ts
      fixes:
        - endpoint_config
        - s3_path_style
        - removal_policy
      code_snippets:
        localstack_config: |
          // LocalStack configuration
          const isLocalStack = process.env.LOCALSTACK_HOSTNAME || process.env.AWS_ENDPOINT_URL;
          const localstackEndpoint = isLocalStack ? 'http://localhost:4566' : undefined;
          
    cdk-ts-s3-lambda:
      description: 'CDK TypeScript with S3 + Lambda'
      applies_to:
        platform: cdk
        language: ts
        services:
          - s3
          - lambda
      fixes:
        - endpoint_config
        - s3_path_style
        - removal_policy
        - lambda_dlq
      code_snippets:
        s3_config: |
          const bucket = new s3.Bucket(this, 'Bucket', {
            removalPolicy: cdk.RemovalPolicy.DESTROY,
            autoDeleteObjects: true,
            // LocalStack: Use path-style access
            ...(process.env.LOCALSTACK_HOSTNAME && {
              bucketName: 'my-bucket-' + this.account,
            }),
          });
          
    cfn-yaml-basic:
      description: 'CloudFormation YAML basic setup'
      applies_to:
        platform: cfn
        language: yaml
      fixes:
        - metadata_fix
        - removal_policy
      code_snippets:
        deletion_policy: |
          # Add DeletionPolicy for LocalStack
          DeletionPolicy: Delete
          
    tf-hcl-basic:
      description: 'Terraform HCL basic setup'
      applies_to:
        platform: tf
        language: hcl
      fixes:
        - endpoint_config
        - s3_path_style
      code_snippets:
        provider_config: |
          # LocalStack provider configuration
          provider "aws" {
            region                      = "us-east-1"
            access_key                  = "test"
            secret_key                  = "test"
            skip_credentials_validation = true
            skip_metadata_api_check     = true
            skip_requesting_account_id  = true
            
            endpoints {
              s3       = "http://localhost:4566"
              dynamodb = "http://localhost:4566"
              lambda   = "http://localhost:4566"
              sqs      = "http://localhost:4566"
              sns      = "http://localhost:4566"
              iam      = "http://localhost:4566"
            }
            
            s3_use_path_style = true
          }
          
    pulumi-ts-basic:
      description: 'Pulumi TypeScript basic setup'
      applies_to:
        platform: pulumi
        language: ts
      fixes:
        - endpoint_config
        - s3_path_style
      code_snippets:
        provider_config: |
          // LocalStack provider configuration
          const awsProvider = new aws.Provider("localstack", {
            region: "us-east-1",
            accessKey: "test",
            secretKey: "test",
            skipCredentialsValidation: true,
            skipMetadataApiCheck: true,
            s3UsePathStyle: true,
            endpoints: [{
              s3: "http://localhost:4566",
              dynamodb: "http://localhost:4566",
              lambda: "http://localhost:4566",
              sqs: "http://localhost:4566",
              sns: "http://localhost:4566",
              iam: "http://localhost:4566",
            }],
          });

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PARALLEL MIGRATION DASHBOARD (Enhancement #6)
# Real-time monitoring of parallel migrations
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
dashboard:
  enabled: true
  script_path: '.claude/scripts/localstack-dashboard.sh'
  refresh_interval: 5 # seconds
  
  # Status file locations
  status_directory: '.claude/reports/dashboard/'
  active_migrations_file: '.claude/reports/dashboard/active.json'
  history_file: '.claude/reports/dashboard/history.json'
  
  # Display settings
  display:
    show_progress_bar: true
    show_elapsed_time: true
    show_estimated_remaining: true
    max_visible_migrations: 10
    
  # Status indicators
  status_icons:
    pending: 'â³'
    initializing: 'ðŸ”„'
    deploying: 'ðŸš€'
    testing: 'ðŸ§ª'
    fixing: 'ðŸ”§'
    pushing: 'ðŸ“¤'
    completed: 'âœ…'
    failed: 'âŒ'
    blocked: 'ðŸš«'
    
  # Metrics tracking
  metrics:
    track_daily_stats: true
    track_weekly_stats: true
    track_success_rate: true
    track_avg_duration: true
    track_common_failures: true

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ROLLBACK CAPABILITY (Enhancement #7)
# Ability to rollback failed migrations
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
rollback:
  enabled: true
  script_path: '.claude/scripts/localstack-rollback.sh'
  
  # Snapshot settings
  snapshots:
    enabled: true
    directory: '.claude/snapshots/'
    max_snapshots_per_pr: 3
    auto_snapshot_before_fix: true
    
  # Rollback triggers
  auto_rollback:
    enabled: false # Manual rollback only by default
    on_consecutive_failures: 3 # Auto-rollback after N failures
    on_test_regression: true # Auto-rollback if tests that passed now fail
    
  # Rollback scope options
  scope:
    full: 'Rollback all changes to original state'
    last_fix: 'Rollback only the last fix applied'
    to_snapshot: 'Rollback to a specific snapshot'
    selective: 'Rollback specific files only'

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SERVICE SUBSTITUTION SUGGESTIONS (Enhancement #8)
# Suggest alternatives for unsupported services
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
service_substitutions:
  enabled: true
  
  # Pro-only services â†’ Community alternatives
  substitutions:
    appsync:
      alternative: 'apigateway + lambda'
      description: 'Replace AppSync with API Gateway + Lambda resolvers'
      difficulty: 'medium'
      migration_steps:
        - 'Create API Gateway REST API'
        - 'Create Lambda functions for resolvers'
        - 'Map GraphQL operations to REST endpoints'
        - 'Update client code to use REST API'
      code_example: |
        // Instead of AppSync GraphQL API:
        // const api = new appsync.GraphqlApi(...)
        
        // Use API Gateway + Lambda:
        const api = new apigateway.RestApi(this, 'Api');
        const handler = new lambda.Function(this, 'Handler', {
          runtime: lambda.Runtime.NODEJS_18_X,
          handler: 'index.handler',
          code: lambda.Code.fromAsset('lambda'),
        });
        api.root.addMethod('POST', new apigateway.LambdaIntegration(handler));
        
    eks:
      alternative: 'ecs'
      description: 'Replace EKS with ECS (limited LocalStack support)'
      difficulty: 'hard'
      migration_steps:
        - 'Convert Kubernetes manifests to ECS task definitions'
        - 'Replace kubectl commands with ECS CLI'
        - 'Update service discovery configuration'
      note: 'ECS has limited LocalStack support - consider mocking'
      
    cognito-idp:
      alternative: 'iam + lambda-authorizer'
      description: 'Replace Cognito with IAM + Lambda authorizer'
      difficulty: 'medium'
      migration_steps:
        - 'Create Lambda authorizer function'
        - 'Configure API Gateway with Lambda authorizer'
        - 'Implement token validation in Lambda'
      code_example: |
        // Lambda authorizer instead of Cognito
        const authorizer = new lambda.Function(this, 'Authorizer', {
          runtime: lambda.Runtime.NODEJS_18_X,
          handler: 'authorizer.handler',
          code: lambda.Code.fromAsset('lambda'),
        });
        
        const auth = new apigateway.TokenAuthorizer(this, 'TokenAuth', {
          handler: authorizer,
        });
        
    amplify:
      alternative: 's3 + cloudfront (static hosting)'
      description: 'Replace Amplify with S3 static hosting'
      difficulty: 'easy'
      migration_steps:
        - 'Create S3 bucket with static website hosting'
        - 'Configure bucket policy for public access'
        - 'Update build scripts to deploy to S3'
      code_example: |
        // S3 static website instead of Amplify
        const websiteBucket = new s3.Bucket(this, 'WebsiteBucket', {
          websiteIndexDocument: 'index.html',
          websiteErrorDocument: 'error.html',
          publicReadAccess: true,
          removalPolicy: cdk.RemovalPolicy.DESTROY,
        });
        
    sagemaker:
      alternative: 'lambda (for inference)'
      description: 'Replace SageMaker with Lambda for simple inference'
      difficulty: 'hard'
      migration_steps:
        - 'Package model in Lambda layer'
        - 'Create Lambda function for inference'
        - 'Update client code to call Lambda'
      note: 'Only suitable for small models - consider mocking for tests'
      
    rds:
      alternative: 'dynamodb or mock'
      description: 'Replace RDS with DynamoDB or mock database'
      difficulty: 'medium'
      migration_steps:
        - 'Evaluate if DynamoDB can replace RDS'
        - 'If not, use mock database for testing'
        - 'Update connection strings for LocalStack'
        
    elasticache:
      alternative: 'dynamodb (for caching)'
      description: 'Replace ElastiCache with DynamoDB TTL'
      difficulty: 'medium'
      migration_steps:
        - 'Create DynamoDB table with TTL'
        - 'Update cache client code'
        - 'Implement TTL-based expiration'

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# INTEGRATION TEST ENHANCEMENT (Enhancement #9)
# Auto-generate or enhance integration tests for LocalStack
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
test_enhancement:
  enabled: true
  script_path: '.claude/scripts/localstack-enhance-tests.sh'
  
  # Auto-add LocalStack endpoint configuration to tests
  add_endpoint_config: true
  
  # Add cleanup after tests
  add_cleanup_hooks: true
  
  # Timeout settings for LocalStack (slower than AWS)
  timeouts:
    default: 30000 # 30 seconds
    deployment: 60000 # 60 seconds
    api_call: 10000 # 10 seconds
    
  # Retry logic for flaky LocalStack operations
  retry_config:
    enabled: true
    max_retries: 3
    retry_delay: 1000 # ms
    exponential_backoff: true
    retryable_errors:
      - 'ECONNREFUSED'
      - 'socket hang up'
      - 'ResourceNotFoundException'
      - 'ServiceUnavailable'
      
  # Test file patterns
  test_patterns:
    integration_tests:
      - '**/*.int.test.ts'
      - '**/*.int.test.js'
      - '**/test_*.py'
      - '**/*_test.go'
    unit_tests:
      - '**/*.unit.test.ts'
      - '**/*.unit.test.js'
      - '**/*.test.ts'
      - '**/*.test.js'
      
  # Code snippets for test enhancement
  snippets:
    jest_setup: |
      // LocalStack test setup
      beforeAll(async () => {
        // Wait for LocalStack to be ready
        const maxRetries = 10;
        for (let i = 0; i < maxRetries; i++) {
          try {
            const response = await fetch('http://localhost:4566/_localstack/health');
            if (response.ok) break;
          } catch (e) {
            if (i === maxRetries - 1) throw new Error('LocalStack not ready');
            await new Promise(r => setTimeout(r, 1000));
          }
        }
      });
      
    jest_cleanup: |
      // LocalStack test cleanup
      afterAll(async () => {
        // Clean up resources
        try {
          // Add cleanup code here
        } catch (e) {
          console.warn('Cleanup warning:', e.message);
        }
      });
      
    aws_client_config: |
      // LocalStack AWS client configuration
      const getLocalStackConfig = () => ({
        endpoint: 'http://localhost:4566',
        region: 'us-east-1',
        credentials: {
          accessKeyId: 'test',
          secretAccessKey: 'test',
        },
        forcePathStyle: true, // Required for S3
      });
      
    retry_helper: |
      // Retry helper for flaky operations
      async function withRetry<T>(
        fn: () => Promise<T>,
        maxRetries = 3,
        delay = 1000
      ): Promise<T> {
        for (let i = 0; i < maxRetries; i++) {
          try {
            return await fn();
          } catch (error) {
            if (i === maxRetries - 1) throw error;
            await new Promise(r => setTimeout(r, delay * Math.pow(2, i)));
          }
        }
        throw new Error('Max retries exceeded');
      }
