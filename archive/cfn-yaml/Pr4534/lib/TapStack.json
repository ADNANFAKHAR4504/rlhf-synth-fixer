{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Serverless Fitness Workout Logging API - A cost-effective, scalable solution for handling 2,000 daily workout logs with comprehensive monitoring and security",
  "Parameters": {
    "EnvironmentSuffix": {
      "Type": "String",
      "Description": "Environment identifier to append to resource names (e.g., dev, staging, prod)",
      "Default": "prod"
    },
    "ApiStageName": {
      "Type": "String",
      "Description": "API Gateway deployment stage name",
      "Default": "v1",
      "AllowedValues": [
        "v1",
        "v2",
        "prod",
        "dev"
      ]
    }
  },
  "Resources": {
    "WorkoutLogsTable": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "TableName": {
          "Fn::Sub": "workoutlogs-${AWS::Region}-${EnvironmentSuffix}"
        },
        "BillingMode": "PAY_PER_REQUEST",
        "AttributeDefinitions": [
          {
            "AttributeName": "userId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "workoutTimestamp",
            "AttributeType": "N"
          },
          {
            "AttributeName": "workoutType",
            "AttributeType": "S"
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "userId",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "workoutTimestamp",
            "KeyType": "RANGE"
          }
        ],
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "WorkoutTypeIndex",
            "KeySchema": [
              {
                "AttributeName": "workoutType",
                "KeyType": "HASH"
              },
              {
                "AttributeName": "workoutTimestamp",
                "KeyType": "RANGE"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          }
        ],
        "StreamSpecification": {
          "StreamViewType": "NEW_AND_OLD_IMAGES"
        },
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true
        },
        "SSESpecification": {
          "SSEEnabled": true
        },
        "Tags": [
          {
            "Key": "Environment",
            "Value": {
              "Ref": "EnvironmentSuffix"
            }
          },
          {
            "Key": "Application",
            "Value": "FitnessWorkoutAPI"
          }
        ]
      }
    },
    "WorkoutApiLambdaRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              },
              "Action": "sts:AssumeRole"
            }
          ]
        },
        "ManagedPolicyArns": [
          "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
        ],
        "Policies": [
          {
            "PolicyName": {
              "Fn::Sub": "workoutapi-dynamodb-policy-${AWS::Region}-${EnvironmentSuffix}"
            },
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": [
                    "dynamodb:PutItem",
                    "dynamodb:GetItem",
                    "dynamodb:Query",
                    "dynamodb:Scan",
                    "dynamodb:UpdateItem",
                    "dynamodb:DeleteItem"
                  ],
                  "Resource": [
                    {
                      "Fn::GetAtt": [
                        "WorkoutLogsTable",
                        "Arn"
                      ]
                    },
                    {
                      "Fn::Sub": "${WorkoutLogsTable.Arn}/index/*"
                    }
                  ]
                },
                {
                  "Effect": "Allow",
                  "Action": [
                    "ssm:GetParameter",
                    "ssm:GetParameters"
                  ],
                  "Resource": {
                    "Fn::Sub": "arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:parameter/fitness-app/${EnvironmentSuffix}/*"
                  }
                },
                {
                  "Effect": "Allow",
                  "Action": [
                    "cloudwatch:PutMetricData"
                  ],
                  "Resource": "*"
                }
              ]
            }
          }
        ],
        "Tags": [
          {
            "Key": "Environment",
            "Value": {
              "Ref": "EnvironmentSuffix"
            }
          }
        ]
      }
    },
    "CreateWorkoutLogFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "FunctionName": {
          "Fn::Sub": "create-workout-log-${AWS::Region}-${EnvironmentSuffix}"
        },
        "Runtime": "python3.9",
        "Handler": "index.lambda_handler",
        "Role": {
          "Fn::GetAtt": [
            "WorkoutApiLambdaRole",
            "Arn"
          ]
        },
        "Timeout": 30,
        "MemorySize": 256,
        "Environment": {
          "Variables": {
            "TABLE_NAME": {
              "Ref": "WorkoutLogsTable"
            },
            "ENVIRONMENT": {
              "Ref": "EnvironmentSuffix"
            }
          }
        },
        "Code": {
          "ZipFile": "import json\nimport boto3\nimport os\nfrom datetime import datetime\nfrom decimal import Decimal\n\ndynamodb = boto3.resource('dynamodb')\ncloudwatch = boto3.client('cloudwatch')\ntable = dynamodb.Table(os.environ['TABLE_NAME'])\n\ndef lambda_handler(event, context):\n    try:\n        body = json.loads(event['body'])\n        \n        # Validate required fields\n        required_fields = ['userId', 'workoutType', 'duration', 'calories']\n        for field in required_fields:\n            if field not in body:\n                return {\n                    'statusCode': 400,\n                    'headers': {'Content-Type': 'application/json'},\n                    'body': json.dumps({'error': f'Missing required field: {field}'})\n                }\n        \n        # Prepare workout log item\n        workout_log = {\n            'userId': body['userId'],\n            'workoutTimestamp': int(datetime.now().timestamp()),\n            'workoutType': body['workoutType'],\n            'duration': Decimal(str(body['duration'])),\n            'calories': Decimal(str(body['calories'])),\n            'distance': Decimal(str(body.get('distance', 0))),\n            'heartRate': body.get('heartRate', 0),\n            'notes': body.get('notes', ''),\n            'createdAt': datetime.now().isoformat()\n        }\n        \n        # Store in DynamoDB\n        table.put_item(Item=workout_log)\n        \n        # Send custom metric to CloudWatch\n        cloudwatch.put_metric_data(\n            Namespace='FitnessApp/Workouts',\n            MetricData=[\n                {\n                    'MetricName': 'WorkoutLogsCreated',\n                    'Value': 1,\n                    'Unit': 'Count',\n                    'Dimensions': [\n                        {'Name': 'WorkoutType', 'Value': body['workoutType']},\n                        {'Name': 'Environment', 'Value': os.environ['ENVIRONMENT']}\n                    ]\n                }\n            ]\n        )\n        \n        return {\n            'statusCode': 201,\n            'headers': {'Content-Type': 'application/json'},\n            'body': json.dumps({\n                'message': 'Workout log created successfully',\n                'workoutId': f\"{body['userId']}#{workout_log['workoutTimestamp']}\"\n            })\n        }\n    \n    except Exception as e:\n        print(f\"Error: {str(e)}\")\n        return {\n            'statusCode': 500,\n            'headers': {'Content-Type': 'application/json'},\n            'body': json.dumps({'error': 'Internal server error'})\n        }\n"
        },
        "Tags": [
          {
            "Key": "Environment",
            "Value": {
              "Ref": "EnvironmentSuffix"
            }
          }
        ]
      }
    },
    "GetWorkoutLogsFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "FunctionName": {
          "Fn::Sub": "get-workoutlogs-${AWS::Region}-${EnvironmentSuffix}"
        },
        "Runtime": "python3.9",
        "Handler": "index.lambda_handler",
        "Role": {
          "Fn::GetAtt": [
            "WorkoutApiLambdaRole",
            "Arn"
          ]
        },
        "Timeout": 30,
        "MemorySize": 256,
        "Environment": {
          "Variables": {
            "TABLE_NAME": {
              "Ref": "WorkoutLogsTable"
            },
            "ENVIRONMENT": {
              "Ref": "EnvironmentSuffix"
            }
          }
        },
        "Code": {
          "ZipFile": "import json\nimport boto3\nimport os\nfrom boto3.dynamodb.conditions import Key\nfrom decimal import Decimal\n\ndynamodb = boto3.resource('dynamodb')\ntable = dynamodb.Table(os.environ['TABLE_NAME'])\n\nclass DecimalEncoder(json.JSONEncoder):\n    def default(self, obj):\n        if isinstance(obj, Decimal):\n            return float(obj)\n        return super(DecimalEncoder, self).default(obj)\n\ndef lambda_handler(event, context):\n    try:\n        user_id = event['queryStringParameters'].get('userId')\n        workout_type = event['queryStringParameters'].get('workoutType')\n        \n        if not user_id:\n            return {\n                'statusCode': 400,\n                'headers': {'Content-Type': 'application/json'},\n                'body': json.dumps({'error': 'userId parameter is required'})\n            }\n        \n        # Query workouts by userId\n        response = table.query(\n            KeyConditionExpression=Key('userId').eq(user_id),\n            ScanIndexForward=False,\n            Limit=50\n        )\n        \n        workouts = response.get('Items', [])\n        \n        # Filter by workout type if provided\n        if workout_type:\n            workouts = [w for w in workouts if w.get('workoutType') == workout_type]\n        \n        return {\n            'statusCode': 200,\n            'headers': {'Content-Type': 'application/json'},\n            'body': json.dumps({\n                'count': len(workouts),\n                'workouts': workouts\n            }, cls=DecimalEncoder)\n        }\n    \n    except Exception as e:\n        print(f\"Error: {str(e)}\")\n        return {\n            'statusCode': 500,\n            'headers': {'Content-Type': 'application/json'},\n            'body': json.dumps({'error': 'Internal server error'})\n        }\n"
        },
        "Tags": [
          {
            "Key": "Environment",
            "Value": {
              "Ref": "EnvironmentSuffix"
            }
          }
        ]
      }
    },
    "GetWorkoutStatsFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "FunctionName": {
          "Fn::Sub": "get-workout-stats-${AWS::Region}-${EnvironmentSuffix}"
        },
        "Runtime": "python3.9",
        "Handler": "index.lambda_handler",
        "Role": {
          "Fn::GetAtt": [
            "WorkoutApiLambdaRole",
            "Arn"
          ]
        },
        "Timeout": 30,
        "MemorySize": 256,
        "Environment": {
          "Variables": {
            "TABLE_NAME": {
              "Ref": "WorkoutLogsTable"
            },
            "ENVIRONMENT": {
              "Ref": "EnvironmentSuffix"
            }
          }
        },
        "Code": {
          "ZipFile": "import json\nimport boto3\nimport os\nfrom boto3.dynamodb.conditions import Key\nfrom decimal import Decimal\nfrom datetime import datetime, timedelta\n\ndynamodb = boto3.resource('dynamodb')\ntable = dynamodb.Table(os.environ['TABLE_NAME'])\n\nclass DecimalEncoder(json.JSONEncoder):\n    def default(self, obj):\n        if isinstance(obj, Decimal):\n            return float(obj)\n        return super(DecimalEncoder, self).default(obj)\n\ndef lambda_handler(event, context):\n    try:\n        user_id = event['queryStringParameters'].get('userId')\n        days = int(event['queryStringParameters'].get('days', 30))\n        \n        if not user_id:\n            return {\n                'statusCode': 400,\n                'headers': {'Content-Type': 'application/json'},\n                'body': json.dumps({'error': 'userId parameter is required'})\n            }\n        \n        # Calculate timestamp for the start of the period\n        start_timestamp = int((datetime.now() - timedelta(days=days)).timestamp())\n        \n        # Query workouts within the time period\n        response = table.query(\n            KeyConditionExpression=Key('userId').eq(user_id) & Key('workoutTimestamp').gte(start_timestamp)\n        )\n        \n        workouts = response.get('Items', [])\n        \n        # Calculate statistics\n        total_workouts = len(workouts)\n        total_duration = sum(float(w.get('duration', 0)) for w in workouts)\n        total_calories = sum(float(w.get('calories', 0)) for w in workouts)\n        total_distance = sum(float(w.get('distance', 0)) for w in workouts)\n        \n        workout_types = {}\n        for workout in workouts:\n            wtype = workout.get('workoutType', 'Unknown')\n            workout_types[wtype] = workout_types.get(wtype, 0) + 1\n        \n        stats = {\n            'userId': user_id,\n            'period': f'Last {days} days',\n            'totalWorkouts': total_workouts,\n            'totalDuration': round(total_duration, 2),\n            'totalCalories': round(total_calories, 2),\n            'totalDistance': round(total_distance, 2),\n            'averageCaloriesPerWorkout': round(total_calories / total_workouts, 2) if total_workouts > 0 else 0,\n            'workoutTypeBreakdown': workout_types\n        }\n        \n        return {\n            'statusCode': 200,\n            'headers': {'Content-Type': 'application/json'},\n            'body': json.dumps(stats, cls=DecimalEncoder)\n        }\n    \n    except Exception as e:\n        print(f\"Error: {str(e)}\")\n        return {\n            'statusCode': 500,\n            'headers': {'Content-Type': 'application/json'},\n            'body': json.dumps({'error': 'Internal server error'})\n        }\n"
        },
        "Tags": [
          {
            "Key": "Environment",
            "Value": {
              "Ref": "EnvironmentSuffix"
            }
          }
        ]
      }
    },
    "WorkoutApi": {
      "Type": "AWS::ApiGateway::RestApi",
      "Properties": {
        "Name": {
          "Fn::Sub": "workoutapi-${AWS::Region}-${EnvironmentSuffix}"
        },
        "Description": "Serverless API for fitness workout logging with comprehensive metrics",
        "EndpointConfiguration": {
          "Types": [
            "REGIONAL"
          ]
        },
        "Tags": [
          {
            "Key": "Environment",
            "Value": {
              "Ref": "EnvironmentSuffix"
            }
          }
        ]
      }
    },
    "WorkoutLogsResource": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "RestApiId": {
          "Ref": "WorkoutApi"
        },
        "ParentId": {
          "Fn::GetAtt": [
            "WorkoutApi",
            "RootResourceId"
          ]
        },
        "PathPart": "workouts"
      }
    },
    "StatsResource": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "RestApiId": {
          "Ref": "WorkoutApi"
        },
        "ParentId": {
          "Fn::GetAtt": [
            "WorkoutApi",
            "RootResourceId"
          ]
        },
        "PathPart": "stats"
      }
    },
    "CreateWorkoutMethod": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "RestApiId": {
          "Ref": "WorkoutApi"
        },
        "ResourceId": {
          "Ref": "WorkoutLogsResource"
        },
        "HttpMethod": "POST",
        "AuthorizationType": "AWS_IAM",
        "Integration": {
          "Type": "AWS_PROXY",
          "IntegrationHttpMethod": "POST",
          "Uri": {
            "Fn::Sub": "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CreateWorkoutLogFunction.Arn}/invocations"
          }
        }
      }
    },
    "GetWorkoutsMethod": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "RestApiId": {
          "Ref": "WorkoutApi"
        },
        "ResourceId": {
          "Ref": "WorkoutLogsResource"
        },
        "HttpMethod": "GET",
        "AuthorizationType": "AWS_IAM",
        "Integration": {
          "Type": "AWS_PROXY",
          "IntegrationHttpMethod": "POST",
          "Uri": {
            "Fn::Sub": "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetWorkoutLogsFunction.Arn}/invocations"
          }
        }
      }
    },
    "GetStatsMethod": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "RestApiId": {
          "Ref": "WorkoutApi"
        },
        "ResourceId": {
          "Ref": "StatsResource"
        },
        "HttpMethod": "GET",
        "AuthorizationType": "AWS_IAM",
        "Integration": {
          "Type": "AWS_PROXY",
          "IntegrationHttpMethod": "POST",
          "Uri": {
            "Fn::Sub": "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetWorkoutStatsFunction.Arn}/invocations"
          }
        }
      }
    },
    "CreateWorkoutLambdaPermission": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Ref": "CreateWorkoutLogFunction"
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Sub": "arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${WorkoutApi}/*/*/*"
        }
      }
    },
    "GetWorkoutsLambdaPermission": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Ref": "GetWorkoutLogsFunction"
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Sub": "arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${WorkoutApi}/*/*/*"
        }
      }
    },
    "GetStatsLambdaPermission": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Ref": "GetWorkoutStatsFunction"
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Sub": "arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${WorkoutApi}/*/*/*"
        }
      }
    },
    "ApiDeployment": {
      "Type": "AWS::ApiGateway::Deployment",
      "DependsOn": [
        "CreateWorkoutMethod",
        "GetWorkoutsMethod",
        "GetStatsMethod"
      ],
      "Properties": {
        "RestApiId": {
          "Ref": "WorkoutApi"
        },
        "StageName": {
          "Ref": "ApiStageName"
        },
        "StageDescription": {
          "MetricsEnabled": true,
          "LoggingLevel": "INFO",
          "DataTraceEnabled": true,
          "ThrottlingBurstLimit": 100,
          "ThrottlingRateLimit": 50
        }
      }
    },
    "ApiGatewayLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": {
          "Fn::Sub": "/aws/apigateway/workoutapi-${AWS::Region}-${EnvironmentSuffix}"
        },
        "RetentionInDays": 30
      }
    },
    "WorkoutApiDashboard": {
      "Type": "AWS::CloudWatch::Dashboard",
      "Properties": {
        "DashboardName": {
          "Fn::Sub": "workoutapi-metrics-${AWS::Region}-${EnvironmentSuffix}"
        },
        "DashboardBody": {
          "Fn::Sub": "{\n  \"widgets\": [\n    {\n      \"type\": \"metric\",\n      \"properties\": {\n        \"metrics\": [\n          [\"AWS/Lambda\", \"Invocations\", {\"stat\": \"Sum\", \"label\": \"Total Invocations\"}],\n          [\".\", \"Errors\", {\"stat\": \"Sum\", \"label\": \"Errors\"}],\n          [\".\", \"Duration\", {\"stat\": \"Average\", \"label\": \"Avg Duration\"}]\n        ],\n        \"period\": 300,\n        \"stat\": \"Average\",\n        \"region\": \"${AWS::Region}\",\n        \"title\": \"Lambda Performance Metrics\",\n        \"yAxis\": {\"left\": {\"min\": 0}}\n      }\n    },\n    {\n      \"type\": \"metric\",\n      \"properties\": {\n        \"metrics\": [\n          [\"AWS/DynamoDB\", \"ConsumedReadCapacityUnits\", {\"stat\": \"Sum\"}],\n          [\".\", \"ConsumedWriteCapacityUnits\", {\"stat\": \"Sum\"}]\n        ],\n        \"period\": 300,\n        \"stat\": \"Average\",\n        \"region\": \"${AWS::Region}\",\n        \"title\": \"DynamoDB Capacity Usage\",\n        \"yAxis\": {\"left\": {\"min\": 0}}\n      }\n    },\n    {\n      \"type\": \"metric\",\n      \"properties\": {\n        \"metrics\": [\n          [\"FitnessApp/Workouts\", \"WorkoutLogsCreated\", {\"stat\": \"Sum\"}]\n        ],\n        \"period\": 300,\n        \"stat\": \"Sum\",\n        \"region\": \"${AWS::Region}\",\n        \"title\": \"Workout Logs Created\",\n        \"yAxis\": {\"left\": {\"min\": 0}}\n      }\n    },\n    {\n      \"type\": \"metric\",\n      \"properties\": {\n        \"metrics\": [\n          [\"AWS/ApiGateway\", \"Count\", {\"stat\": \"Sum\", \"label\": \"API Requests\"}],\n          [\".\", \"4XXError\", {\"stat\": \"Sum\", \"label\": \"Client Errors\"}],\n          [\".\", \"5XXError\", {\"stat\": \"Sum\", \"label\": \"Server Errors\"}]\n        ],\n        \"period\": 300,\n        \"stat\": \"Sum\",\n        \"region\": \"${AWS::Region}\",\n        \"title\": \"API Gateway Metrics\",\n        \"yAxis\": {\"left\": {\"min\": 0}}\n      }\n    }\n  ]\n}\n"
        }
      }
    },
    "ApiEndpointParameter": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": {
          "Fn::Sub": "/fitness-app/${EnvironmentSuffix}/api-endpoint"
        },
        "Type": "String",
        "Value": {
          "Fn::Sub": "https://${WorkoutApi}.execute-api.${AWS::Region}.amazonaws.com/${ApiStageName}"
        },
        "Description": "API Gateway endpoint URL for the workout logging API"
      }
    },
    "TableNameParameter": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": {
          "Fn::Sub": "/fitness-app/${EnvironmentSuffix}/table-name"
        },
        "Type": "String",
        "Value": {
          "Ref": "WorkoutLogsTable"
        },
        "Description": "DynamoDB table name for workout logs"
      }
    },
    "ApiErrorAlarm": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": {
          "Fn::Sub": "workoutapi-errors-${AWS::Region}-${EnvironmentSuffix}"
        },
        "AlarmDescription": "Alert when API error rate exceeds threshold",
        "MetricName": "5XXError",
        "Namespace": "AWS/ApiGateway",
        "Statistic": "Sum",
        "Period": 300,
        "EvaluationPeriods": 2,
        "Threshold": 10,
        "ComparisonOperator": "GreaterThanThreshold",
        "Dimensions": [
          {
            "Name": "ApiName",
            "Value": {
              "Fn::Sub": "workoutapi-${AWS::Region}-${EnvironmentSuffix}"
            }
          }
        ]
      }
    },
    "DynamoDBThrottleAlarm": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": {
          "Fn::Sub": "workout-dynamodb-throttle-${AWS::Region}-${EnvironmentSuffix}"
        },
        "AlarmDescription": "Alert when DynamoDB requests are throttled",
        "MetricName": "UserErrors",
        "Namespace": "AWS/DynamoDB",
        "Statistic": "Sum",
        "Period": 300,
        "EvaluationPeriods": 1,
        "Threshold": 5,
        "ComparisonOperator": "GreaterThanThreshold",
        "Dimensions": [
          {
            "Name": "TableName",
            "Value": {
              "Ref": "WorkoutLogsTable"
            }
          }
        ]
      }
    }
  },
  "Outputs": {
    "ApiEndpoint": {
      "Description": "API Gateway endpoint URL for the workout logging API",
      "Value": {
        "Fn::Sub": "https://${WorkoutApi}.execute-api.${AWS::Region}.amazonaws.com/${ApiStageName}"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "workoutapi-endpoint-${AWS::Region}-${EnvironmentSuffix}"
        }
      }
    },
    "DynamoDBTableName": {
      "Description": "Name of the DynamoDB table storing workout logs",
      "Value": {
        "Ref": "WorkoutLogsTable"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "workout-table-name-${AWS::Region}-${EnvironmentSuffix}"
        }
      }
    },
    "DashboardURL": {
      "Description": "CloudWatch Dashboard URL for monitoring API metrics",
      "Value": {
        "Fn::Sub": "https://console.aws.amazon.com/cloudwatch/home?region=${AWS::Region}#dashboards:name=workoutapi-metrics-${AWS::Region}-${EnvironmentSuffix}"
      }
    },
    "CreateWorkoutEndpoint": {
      "Description": "Endpoint to create new workout logs",
      "Value": {
        "Fn::Sub": "https://${WorkoutApi}.execute-api.${AWS::Region}.amazonaws.com/${ApiStageName}/workouts"
      }
    },
    "GetWorkoutsEndpoint": {
      "Description": "Endpoint to retrieve workout logs",
      "Value": {
        "Fn::Sub": "https://${WorkoutApi}.execute-api.${AWS::Region}.amazonaws.com/${ApiStageName}/workouts?userId=USER_ID"
      }
    },
    "GetStatsEndpoint": {
      "Description": "Endpoint to retrieve workout statistics",
      "Value": {
        "Fn::Sub": "https://${WorkoutApi}.execute-api.${AWS::Region}.amazonaws.com/${ApiStageName}/stats?userId=USER_ID&days=30"
      }
    },
    "LambdaFunctionNames": {
      "Description": "Names of the Lambda functions created",
      "Value": {
        "Fn::Sub": "create-workout-log-${AWS::Region}-${EnvironmentSuffix}, get-workoutlogs-${AWS::Region}-${EnvironmentSuffix}, get-workout-stats-${AWS::Region}-${EnvironmentSuffix}"
      }
    }
  }
}
