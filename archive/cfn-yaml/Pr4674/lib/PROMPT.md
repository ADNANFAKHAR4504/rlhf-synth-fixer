We need a CloudFormation template in YAML to build the secure foundation for our new Clinical Trial Data Platform in the us-west-2 region. This platform will handle highly sensitive patient data, so the infrastructure must be compliant and secure by default. All resources should follow the nova-prod-* naming convention.
The platform's core function is to allow researchers to upload trial data via an API, which is then processed by an EC2 instance. The structured metadata is stored in RDS, and the raw data files are stored in S3.
Here's the infrastructure we need to define in the template:
First, create a customer-managed KMS key. This key is central to our security and will be used to encrypt our S3 data, RDS database, and EBS volumes.
The S3 bucket for storing patient data (nova-prod-clinical-data) must be completely private. For maximum security, configure it with dual-layer server-side encryption (DSSE-KMS), using the KMS key you created.
The EC2 instances that process the data need to run in a private subnet. For security, we need to harden them against metadata vulnerabilities by configuring their Launch Template to require IMDSv2. Their security group should also restrict outbound internet traffic, only allowing connections to a specific partner API at 203.0.113.0/24.
For the database, the RDS instance must be in a private subnet and not be publicly accessible. It should also be encrypted with our master KMS key.
Researchers will submit data through an API Gateway. Please enable detailed access logging for the API Gateway stage, sending the logs to CloudWatch. We'll put a CloudFront distribution in front of this API, which will be protected by AWS Shield Standard against DDoS attacks.
For compliance and monitoring, we need to set up AWS Config with at least two rules: one to ensure S3 buckets always have server-side encryption enabled (s3-bucket-server-side-encryption-enabled) and another to ensure IAM users have MFA (iam-user-mfa-enabled). We also need to define an IAM group for our researchers with a policy that denies all actions unless the user has authenticated with MFA.
Finally, to keep an eye on costs for this research project, set up an AWS Budget for $100 per month that sends an alert to an SNS topic if we're projected to go over.
Please provide the final infrastructure code in a single, well-commented YAML code block for the secure_infrastructure.yaml file.