{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "SecureApp - Secure AWS Infrastructure with S3, RDS MySQL, EC2, and CloudWatch monitoring",
  "Parameters": {
    "EnvironmentSuffix": {
      "Type": "String",
      "Default": "dev",
      "Description": "Suffix for resource names to ensure uniqueness"
    },
    "Environment": {
      "Type": "String",
      "Default": "production",
      "Description": "Environment name for resource tagging",
      "AllowedValues": [
        "development",
        "staging",
        "production"
      ]
    },
    "DBUsername": {
      "Type": "String",
      "Default": "admin",
      "Description": "Database administrator username",
      "MinLength": 4,
      "MaxLength": 16,
      "AllowedPattern": "[a-zA-Z][a-zA-Z0-9]*"
    },
    "DBPassword": {
      "Type": "String",
      "Default": "SecurePassword123!",
      "NoEcho": true,
      "Description": "Database password (minimum 8 characters)",
      "MinLength": 8
    },
    "InstanceType": {
      "Type": "String",
      "Default": "t3.micro",
      "Description": "EC2 instance type for application servers",
      "AllowedValues": [
        "t3.micro",
        "t3.small",
        "t3.medium"
      ]
    },
    "NotificationEmail": {
      "Type": "String",
      "Default": "admin@example.com",
      "Description": "Email address for CloudWatch alarm notifications",
      "AllowedPattern": "[^@]+@[^@]+\\.[^@]+"
    },
    "KeyPairName": {
      "Type": "String",
      "Default": "",
      "Description": "EC2 Key Pair for SSH access (leave empty to skip attaching a key)"
    },
    "DBEngineVersion": {
      "Type": "String",
      "Default": "8.0.43",
      "Description": "Optional MySQL engine version (e.g., 8.0.43). Leave empty to let AWS choose a supported version."
    },
    "VpcId": {
      "Type": "String",
      "Default": "",
      "Description": "Existing VPC ID to deploy into (leave empty to create a new VPC)"
    },
    "PublicSubnet1Id": {
      "Type": "String",
      "Default": "",
      "Description": "Existing public subnet ID 1 (leave empty to create subnets)"
    },
    "PublicSubnet2Id": {
      "Type": "String",
      "Default": "",
      "Description": "Existing public subnet ID 2 (leave empty to create subnets)"
    }
  },
  "Mappings": {
    "RegionMap": {
      "us-east-1": {
        "AMI": "ami-0c02fb55956c7d316"
      },
      "us-west-2": {
        "AMI": "ami-0d70546e43a941d70"
      }
    }
  },
  "Conditions": {
    "CreateVPC": {
      "Fn::Equals": [
        {
          "Ref": "VpcId"
        },
        ""
      ]
    },
    "CreateSubnets": {
      "Fn::And": [
        {
          "Fn::Equals": [
            {
              "Ref": "PublicSubnet1Id"
            },
            ""
          ]
        },
        {
          "Fn::Equals": [
            {
              "Ref": "PublicSubnet2Id"
            },
            ""
          ]
        }
      ]
    },
    "CreateVPCAndSubnets": {
      "Fn::And": [
        {
          "Condition": "CreateVPC"
        },
        {
          "Condition": "CreateSubnets"
        }
      ]
    },
    "UseExplicitEngineVersion": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "DBEngineVersion"
            },
            ""
          ]
        }
      ]
    },
    "UseKeyPair": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "KeyPairName"
            },
            ""
          ]
        }
      ]
    }
  },
  "Resources": {
    "SecureAppVPC": {
      "Type": "AWS::EC2::VPC",
      "Condition": "CreateVPC",
      "Properties": {
        "CidrBlock": "10.0.0.0/16",
        "EnableDnsHostnames": true,
        "EnableDnsSupport": true,
        "Tags": [
          {
            "Key": "Name",
            "Value": {
              "Fn::Sub": "${AWS::StackName}-VPC"
            }
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "PublicSubnet1": {
      "Type": "AWS::EC2::Subnet",
      "Condition": "CreateSubnets",
      "Properties": {
        "VpcId": {
          "Fn::If": [
            "CreateVPC",
            {
              "Ref": "SecureAppVPC"
            },
            {
              "Ref": "VpcId"
            }
          ]
        },
        "CidrBlock": "10.0.1.0/24",
        "AvailabilityZone": {
          "Fn::Select": [
            0,
            {
              "Fn::GetAZs": ""
            }
          ]
        },
        "MapPublicIpOnLaunch": true,
        "Tags": [
          {
            "Key": "Name",
            "Value": {
              "Fn::Sub": "${AWS::StackName}-PublicSubnet1"
            }
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "PublicSubnet2": {
      "Type": "AWS::EC2::Subnet",
      "Condition": "CreateSubnets",
      "Properties": {
        "VpcId": {
          "Fn::If": [
            "CreateVPC",
            {
              "Ref": "SecureAppVPC"
            },
            {
              "Ref": "VpcId"
            }
          ]
        },
        "CidrBlock": "10.0.2.0/24",
        "AvailabilityZone": {
          "Fn::Select": [
            1,
            {
              "Fn::GetAZs": ""
            }
          ]
        },
        "MapPublicIpOnLaunch": true,
        "Tags": [
          {
            "Key": "Name",
            "Value": {
              "Fn::Sub": "${AWS::StackName}-PublicSubnet2"
            }
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "InternetGateway": {
      "Type": "AWS::EC2::InternetGateway",
      "Condition": "CreateVPC",
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": {
              "Fn::Sub": "${AWS::StackName}-IGW"
            }
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "AttachGateway": {
      "Type": "AWS::EC2::VPCGatewayAttachment",
      "Condition": "CreateVPC",
      "Properties": {
        "VpcId": {
          "Ref": "SecureAppVPC"
        },
        "InternetGatewayId": {
          "Ref": "InternetGateway"
        }
      }
    },
    "PublicRouteTable": {
      "Type": "AWS::EC2::RouteTable",
      "Condition": "CreateVPCAndSubnets",
      "Properties": {
        "VpcId": {
          "Ref": "SecureAppVPC"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": {
              "Fn::Sub": "${AWS::StackName}-PublicRouteTable"
            }
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "PublicRoute": {
      "Type": "AWS::EC2::Route",
      "Condition": "CreateVPCAndSubnets",
      "DependsOn": "AttachGateway",
      "Properties": {
        "RouteTableId": {
          "Ref": "PublicRouteTable"
        },
        "DestinationCidrBlock": "0.0.0.0/0",
        "GatewayId": {
          "Ref": "InternetGateway"
        }
      }
    },
    "PublicSubnet1RouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Condition": "CreateVPCAndSubnets",
      "Properties": {
        "SubnetId": {
          "Ref": "PublicSubnet1"
        },
        "RouteTableId": {
          "Ref": "PublicRouteTable"
        }
      }
    },
    "PublicSubnet2RouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Condition": "CreateVPCAndSubnets",
      "Properties": {
        "SubnetId": {
          "Ref": "PublicSubnet2"
        },
        "RouteTableId": {
          "Ref": "PublicRouteTable"
        }
      }
    },
    "SecureAppDataBucket": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketName": {
          "Fn::Sub": "secureapp-appdatabucket-${EnvironmentSuffix}-${AWS::AccountId}-${AWS::Region}"
        },
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256"
              },
              "BucketKeyEnabled": true
            }
          ]
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true
        },
        "VersioningConfiguration": {
          "Status": "Enabled"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecureApp-AppDataBucket"
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "EC2InstanceRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "RoleName": {
          "Fn::Sub": "${AWS::StackName}-EC2InstanceRole-${EnvironmentSuffix}"
        },
        "AssumeRolePolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Principal": {
                "Service": "ec2.amazonaws.com"
              },
              "Action": "sts:AssumeRole"
            }
          ]
        },
        "ManagedPolicyArns": [
          "arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy"
        ],
        "Policies": [
          {
            "PolicyName": "S3BucketAccess",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": [
                    "s3:GetObject",
                    "s3:PutObject",
                    "s3:DeleteObject",
                    "s3:ListBucket"
                  ],
                  "Resource": [
                    {
                      "Fn::Sub": "arn:aws:s3:::${SecureAppDataBucket}/*"
                    },
                    {
                      "Fn::Sub": "arn:aws:s3:::${SecureAppDataBucket}"
                    }
                  ]
                }
              ]
            }
          },
          {
            "PolicyName": "RDSConnectAccess",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": [
                    "rds:DescribeDBInstances",
                    "rds:DescribeDBClusters"
                  ],
                  "Resource": "*"
                },
                {
                  "Effect": "Allow",
                  "Action": [
                    "secretsmanager:GetSecretValue"
                  ],
                  "Resource": {
                    "Ref": "DBPasswordSecret"
                  }
                }
              ]
            }
          }
        ],
        "Tags": [
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "EC2InstanceProfile": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
        "InstanceProfileName": {
          "Fn::Sub": "${AWS::StackName}-EC2InstanceProfile-${EnvironmentSuffix}"
        },
        "Roles": [
          {
            "Ref": "EC2InstanceRole"
          }
        ]
      }
    },
    "EC2SecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupName": {
          "Fn::Sub": "${AWS::StackName}-EC2SecurityGroup-${EnvironmentSuffix}"
        },
        "GroupDescription": "Security group for SecureApp EC2 instances",
        "VpcId": {
          "Fn::If": [
            "CreateVPC",
            {
              "Ref": "SecureAppVPC"
            },
            {
              "Ref": "VpcId"
            }
          ]
        },
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": 22,
            "ToPort": 22,
            "CidrIp": {
              "Fn::If": [
                "CreateVPC",
                {
                  "Fn::GetAtt": [
                    "SecureAppVPC",
                    "CidrBlock"
                  ]
                },
                "10.0.0.0/16"
              ]
            },
            "Description": "SSH access from VPC only"
          },
          {
            "IpProtocol": "tcp",
            "FromPort": 80,
            "ToPort": 80,
            "CidrIp": "0.0.0.0/0",
            "Description": "HTTP access"
          },
          {
            "IpProtocol": "tcp",
            "FromPort": 443,
            "ToPort": 443,
            "CidrIp": "0.0.0.0/0",
            "Description": "HTTPS access"
          }
        ],
        "SecurityGroupEgress": [
          {
            "IpProtocol": -1,
            "CidrIp": "0.0.0.0/0",
            "Description": "All outbound traffic"
          }
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": {
              "Fn::Sub": "${AWS::StackName}-EC2SecurityGroup"
            }
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "RDSSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupName": {
          "Fn::Sub": "${AWS::StackName}-RDSSecurityGroup-${EnvironmentSuffix}"
        },
        "GroupDescription": "Security group for SecureApp RDS instance",
        "VpcId": {
          "Fn::If": [
            "CreateVPC",
            {
              "Ref": "SecureAppVPC"
            },
            {
              "Ref": "VpcId"
            }
          ]
        },
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": 3306,
            "ToPort": 3306,
            "SourceSecurityGroupId": {
              "Ref": "EC2SecurityGroup"
            },
            "Description": "MySQL access from EC2 instances only"
          }
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": {
              "Fn::Sub": "${AWS::StackName}-RDSSecurityGroup"
            }
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "RDSSubnetGroup": {
      "Type": "AWS::RDS::DBSubnetGroup",
      "Properties": {
        "DBSubnetGroupName": {
          "Fn::Sub": "${AWS::StackName}-rds-subnet-group-${EnvironmentSuffix}"
        },
        "DBSubnetGroupDescription": "Subnet group for SecureApp RDS instance",
        "SubnetIds": {
          "Fn::If": [
            "CreateSubnets",
            [
              {
                "Ref": "PublicSubnet1"
              },
              {
                "Ref": "PublicSubnet2"
              }
            ],
            [
              {
                "Ref": "PublicSubnet1Id"
              },
              {
                "Ref": "PublicSubnet2Id"
              }
            ]
          ]
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": {
              "Fn::Sub": "${AWS::StackName}-RDSSubnetGroup"
            }
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "DBPasswordSecret": {
      "Type": "AWS::SecretsManager::Secret",
      "Properties": {
        "Name": {
          "Fn::Sub": "SecureApp/DBPassword-${EnvironmentSuffix}"
        },
        "Description": "Database password for SecureApp RDS instance",
        "SecretString": {
          "Fn::Sub": "{\n  \"password\": \"${DBPassword}\"\n}\n"
        }
      }
    },
    "SecureAppMySQLInstance": {
      "Type": "AWS::RDS::DBInstance",
      "DeletionPolicy": "Delete",
      "UpdateReplacePolicy": "Delete",
      "Properties": {
        "DBInstanceIdentifier": {
          "Fn::Sub": "secureapp-mysqlinstance-${EnvironmentSuffix}"
        },
        "DBInstanceClass": "db.t3.micro",
        "Engine": "mysql",
        "EngineVersion": {
          "Fn::If": [
            "UseExplicitEngineVersion",
            {
              "Ref": "DBEngineVersion"
            },
            {
              "Ref": "AWS::NoValue"
            }
          ]
        },
        "MasterUsername": {
          "Ref": "DBUsername"
        },
        "MasterUserPassword": {
          "Fn::Sub": "{{resolve:secretsmanager:${DBPasswordSecret}:SecretString:password}}"
        },
        "AllocatedStorage": 20,
        "StorageType": "gp2",
        "StorageEncrypted": true,
        "VPCSecurityGroups": [
          {
            "Ref": "RDSSecurityGroup"
          }
        ],
        "DBSubnetGroupName": {
          "Ref": "RDSSubnetGroup"
        },
        "PubliclyAccessible": true,
        "BackupRetentionPeriod": 7,
        "MultiAZ": false,
        "AutoMinorVersionUpgrade": true,
        "DeletionProtection": false,
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecureApp-MySQLInstance"
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "EC2LaunchTemplate": {
      "Type": "AWS::EC2::LaunchTemplate",
      "Properties": {
        "LaunchTemplateName": {
          "Fn::Sub": "${AWS::StackName}-LaunchTemplate-${EnvironmentSuffix}"
        },
        "LaunchTemplateData": {
          "ImageId": {
            "Fn::FindInMap": [
              "RegionMap",
              {
                "Ref": "AWS::Region"
              },
              "AMI"
            ]
          },
          "InstanceType": {
            "Ref": "InstanceType"
          },
          "KeyName": {
            "Fn::If": [
              "UseKeyPair",
              {
                "Ref": "KeyPairName"
              },
              {
                "Ref": "AWS::NoValue"
              }
            ]
          },
          "IamInstanceProfile": {
            "Arn": {
              "Fn::GetAtt": [
                "EC2InstanceProfile",
                "Arn"
              ]
            }
          },
          "SecurityGroupIds": [
            {
              "Ref": "EC2SecurityGroup"
            }
          ],
          "UserData": {
            "Fn::Base64": "#!/bin/bash\nyum update -y\nyum install -y amazon-cloudwatch-agent mysql\n\n# Configure CloudWatch agent\ncat > /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json << 'EOF'\n{\n  \"metrics\": {\n    \"namespace\": \"SecureApp/EC2\",\n    \"metrics_collected\": {\n      \"cpu\": {\n        \"measurement\": [\n          \"cpu_usage_idle\",\n          \"cpu_usage_iowait\",\n          \"cpu_usage_user\",\n          \"cpu_usage_system\"\n        ],\n        \"metrics_collection_interval\": 60\n      },\n      \"disk\": {\n        \"measurement\": [\n          \"used_percent\"\n        ],\n        \"metrics_collection_interval\": 60,\n        \"resources\": [\n          \"*\"\n        ]\n      },\n      \"mem\": {\n        \"measurement\": [\n          \"mem_used_percent\"\n        ],\n        \"metrics_collection_interval\": 60\n      }\n    }\n  }\n}\nEOF\n\n# Start CloudWatch agent\n/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl \\\n  -a fetch-config -m ec2 -s -c file:/opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json\n"
          },
          "TagSpecifications": [
            {
              "ResourceType": "instance",
              "Tags": [
                {
                  "Key": "Name",
                  "Value": {
                    "Fn::Sub": "${AWS::StackName}-AppServer"
                  }
                },
                {
                  "Key": "Environment",
                  "Value": {
                    "Ref": "Environment"
                  }
                },
                {
                  "Key": "Project",
                  "Value": "SecureApp"
                }
              ]
            }
          ]
        }
      }
    },
    "SecureAppServerGroup": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "AutoScalingGroupName": {
          "Fn::Sub": "SecureApp-AppServerGroup-${EnvironmentSuffix}"
        },
        "LaunchTemplate": {
          "LaunchTemplateId": {
            "Ref": "EC2LaunchTemplate"
          },
          "Version": {
            "Fn::GetAtt": [
              "EC2LaunchTemplate",
              "LatestVersionNumber"
            ]
          }
        },
        "MinSize": 1,
        "MaxSize": 3,
        "DesiredCapacity": 2,
        "VPCZoneIdentifier": {
          "Fn::If": [
            "CreateSubnets",
            [
              {
                "Ref": "PublicSubnet1"
              },
              {
                "Ref": "PublicSubnet2"
              }
            ],
            [
              {
                "Ref": "PublicSubnet1Id"
              },
              {
                "Ref": "PublicSubnet2Id"
              }
            ]
          ]
        },
        "HealthCheckType": "EC2",
        "HealthCheckGracePeriod": 300,
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecureApp-AppServerGroup",
            "PropagateAtLaunch": false
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            },
            "PropagateAtLaunch": true
          },
          {
            "Key": "Project",
            "Value": "SecureApp",
            "PropagateAtLaunch": true
          }
        ]
      }
    },
    "CloudWatchAlarmTopic": {
      "Type": "AWS::SNS::Topic",
      "Properties": {
        "TopicName": {
          "Fn::Sub": "${AWS::StackName}-CloudWatchAlarms-${EnvironmentSuffix}"
        },
        "DisplayName": "SecureApp CloudWatch Alarms",
        "Tags": [
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    },
    "CloudWatchAlarmSubscription": {
      "Type": "AWS::SNS::Subscription",
      "Properties": {
        "Protocol": "email",
        "TopicArn": {
          "Ref": "CloudWatchAlarmTopic"
        },
        "Endpoint": {
          "Ref": "NotificationEmail"
        }
      }
    },
    "SecureAppHighCPUAlarm": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": {
          "Fn::Sub": "SecureApp-HighCPUAlarm-${EnvironmentSuffix}"
        },
        "AlarmDescription": "Alarm when EC2 CPU exceeds 75%",
        "MetricName": "CPUUtilization",
        "Namespace": "AWS/EC2",
        "Statistic": "Average",
        "Period": 300,
        "EvaluationPeriods": 2,
        "Threshold": 75,
        "ComparisonOperator": "GreaterThanThreshold",
        "Dimensions": [
          {
            "Name": "AutoScalingGroupName",
            "Value": {
              "Ref": "SecureAppServerGroup"
            }
          }
        ],
        "AlarmActions": [
          {
            "Ref": "CloudWatchAlarmTopic"
          }
        ],
        "OKActions": [
          {
            "Ref": "CloudWatchAlarmTopic"
          }
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecureApp-HighCPUAlarm"
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "Project",
            "Value": "SecureApp"
          }
        ]
      }
    }
  },
  "Outputs": {
    "VPCId": {
      "Description": "VPC ID for SecureApp",
      "Value": {
        "Fn::If": [
          "CreateVPC",
          {
            "Ref": "SecureAppVPC"
          },
          {
            "Ref": "VpcId"
          }
        ]
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-VPC-ID"
        }
      }
    },
    "S3BucketName": {
      "Description": "S3 Bucket name for application data",
      "Value": {
        "Ref": "SecureAppDataBucket"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-S3-Bucket"
        }
      }
    },
    "RDSEndpoint": {
      "Description": "RDS MySQL instance endpoint",
      "Value": {
        "Fn::GetAtt": [
          "SecureAppMySQLInstance",
          "Endpoint.Address"
        ]
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-RDS-Endpoint"
        }
      }
    },
    "RDSPort": {
      "Description": "RDS MySQL instance port",
      "Value": {
        "Fn::GetAtt": [
          "SecureAppMySQLInstance",
          "Endpoint.Port"
        ]
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-RDS-Port"
        }
      }
    },
    "AutoScalingGroupName": {
      "Description": "Auto Scaling Group name",
      "Value": {
        "Ref": "SecureAppServerGroup"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-ASG-Name"
        }
      }
    },
    "CloudWatchAlarmName": {
      "Description": "CloudWatch CPU alarm name",
      "Value": {
        "Ref": "SecureAppHighCPUAlarm"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-CPU-Alarm"
        }
      }
    }
  }
}