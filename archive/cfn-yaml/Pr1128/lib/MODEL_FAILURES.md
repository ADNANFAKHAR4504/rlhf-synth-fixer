# Model Failures â€“ Security Configuration CloudFormation YAML

## 1. Failure: Hard-coded resource names and regions

**Problem Statement:**
The model output hardcodes resource names, regions, or IP ranges, which prevents dynamic multi-environment deployments.

**Failed Code Example:**

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: "Hard-coded security template"

Parameters:
  Environment:
    Type: String
    Default: "prod"

Resources:
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: "10.0.0.0/16"
      Tags:
        - Key: Name
          Value: "MyProject-prod-vpc"  # Hard-coded, not dynamic

  DatabaseSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: "Database SG"
      VpcId: "vpc-12345678"  # Hard-coded
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 3306
          ToPort: 3306
          CidrIp: "192.168.1.0/24"  # Hard-coded IP range
```

**Why It Fails:**

* Cannot be deployed in other environments without editing the template.
* IP ranges and resource IDs are not parameterized.
* Violates requirement for multi-region, multi-environment support.

---

## 2. Failure: Missing encryption and KMS integration

**Problem Statement:**
The model does not enforce KMS encryption for RDS, DynamoDB, or S3 buckets, leaving data unprotected.

**Failed Code Example:**

```yaml
RDSInstance:
  Type: AWS::RDS::DBInstance
  Properties:
    DBInstanceIdentifier: "myproject-prod-rds"
    DBInstanceClass: db.t3.micro
    Engine: mysql
    MasterUsername: admin
    MasterUserPassword: "password123"  # Hard-coded, no SecretsManager
    AllocatedStorage: 20
    VPCSecurityGroups: ["sg-12345678"]
    PubliclyAccessible: true  # Security risk
```

**Why It Fails:**

* No KMS encryption or use of secrets for credentials.
* Publicly accessible DB is a serious security risk.
* Violates security best practices (requirements 2, 5, 11).

---

## 3. Failure: IAM roles without MFA enforcement

**Problem Statement:**
IAM roles generated by the model do not enforce MFA for console access.

**Failed Code Example:**

```yaml
IAMRole:
  Type: AWS::IAM::Role
  Properties:
    RoleName: "myproject-prod-role"
    AssumeRolePolicyDocument:
      Version: "2012-10-17"
      Statement:
        - Effect: Allow
          Principal:
            Service: ec2.amazonaws.com
          Action: sts:AssumeRole
    ManagedPolicyArns:
      - arn:aws:iam::aws:policy/AdministratorAccess
```

**Why It Fails:**

* No `aws:MultiFactorAuthPresent` condition in the AssumeRolePolicy.
* Console access is not restricted by MFA.
* Violates requirement 4.

---

## 4. Failure: S3 buckets allow non-HTTPS access

**Problem Statement:**
S3 bucket policies do not enforce HTTPS, exposing data to unencrypted access.

**Failed Code Example:**

```yaml
S3Bucket:
  Type: AWS::S3::Bucket
  Properties:
    BucketName: "myproject-prod-data"
    PublicAccessBlockConfiguration:
      BlockPublicAcls: true
    VersioningConfiguration:
      Status: Enabled
```

**Why It Fails:**

* Missing explicit `aws:SecureTransport` condition in bucket policy.
* Data can still be accessed over HTTP.
* Violates requirement 2.

---

## 5. Failure: Missing centralized logging and monitoring

**Problem Statement:**
The model does not configure CloudWatch, CloudTrail, or GuardDuty integration properly.

**Failed Code Example:**

```yaml
CloudTrail:
  Type: AWS::CloudTrail::Trail
  Properties:
    TrailName: "cloudtrail"
    S3BucketName: "mybucket"
    IsMultiRegionTrail: false  # Not multi-region
```

**Why It Fails:**

* CloudTrail is not multi-region.
* No log validation or encryption.
* No GuardDuty or CloudWatch log integration.
* Violates requirements 6, 7, 8.

---

## Summary of Common Failures

| Failure Type                        | Impact                                                       |
| ----------------------------------- | ------------------------------------------------------------ |
| Hard-coded resource names & regions | Prevents dynamic multi-region deployments                    |
| Missing encryption (KMS)            | Sensitive data unprotected in RDS, DynamoDB, S3              |
| IAM roles without MFA               | Violates MFA compliance requirements                         |
| S3 buckets allow HTTP               | Exposes data to unencrypted access                           |
| Missing logging & monitoring        | Lack of centralized security monitoring and threat detection |
| Lambda overly permissive            | Public access or over-privileged execution (not shown above) |
| WAF missing                         | Web applications remain vulnerable to exploits               |

