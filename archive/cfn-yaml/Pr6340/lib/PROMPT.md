Create a CloudFormation YAML template that deploys an automated analysis framework to evaluate other CloudFormation stacks for security, compliance, and quality assurance. The system should include a Lambda-backed custom resource that inspects target stack templates to identify misconfigurations and noncompliant resources. The analysis must detect security group rules allowing 0.0.0.0/0 ingress, S3 buckets without encryption, versioning, or lifecycle policies, and EC2 instances using deprecated AMIs based on an allowlist parameter. It should also evaluate IAM roles and policies for overly permissive access, verify that RDS instances have automated backups and Multi-AZ deployment enabled, and identify Lambda functions containing potential secrets in their environment variables. The framework must validate that all resources include mandatory tags such as Environment, Owner, CostCenter, and DataClassification, and check for hard-coded values that should be parameters like instance types or CIDR blocks. The template should output a detailed compliance report showing pass or fail results for each analysis rule, provide remediation guidance, and calculate an overall infrastructure quality score from 0 to 100. The analysis must run in the us-east-1 region with CloudFormation native functions, Conditions, and Lambda functions written in Python 3.11, producing structured results both as CloudFormation outputs and optionally stored in S3 for historical tracking.
