Create a CloudFormation YAML template that provisions a secure and scalable AWS VPC infrastructure in the us-west-2 region. The VPC should have a CIDR block of 10.0.0.0/16 and include three public subnets and three private subnets distributed across three Availability Zones. Attach an Internet Gateway to enable internet access for the public subnets and deploy NAT Gateways in each public subnet to allow private subnets to access the internet securely. Configure route tables to ensure proper routing between the Internet Gateway, NAT Gateways, and subnets. Create an S3 bucket with versioning enabled and public access blocked for secure data storage. Define IAM roles that allow EC2 instances in private subnets to access the S3 bucket securely. Launch t2.micro EC2 instances in each private subnet with security groups that restrict SSH access to a specific IP address. Follow CloudFormation best practices by using parameters and outputs to make the stack reusable and ensure all configurations comply with AWS standards for scalability, security, and reusability. The final YAML file should be valid and deploy all resources successfully when executed in AWS CloudFormation.
