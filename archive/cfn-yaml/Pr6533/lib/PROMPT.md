Create a CloudFormation YAML template that configures a secure multi-region AWS environment following best practices for encryption, auditing, access control, and threat protection. The template should ensure that all S3 buckets have server-side encryption and versioning enabled and that access to EC2 instances is restricted through IAM policies based on approved IP ranges. Enforce MFA for all IAM users and apply a strong password policy. Configure CloudTrail in every region and enable VPC Flow Logs for all VPCs to support continuous auditing. Enable AWS Config to monitor compliance across all resources. Secure all EBS volumes with encryption, ensure that RDS instances are not publicly accessible, and require SSL connections to S3. Enforce IAM roles for EC2 applications and rotate IAM user access keys every 90 days. Enable logging for load balancers, encrypt Lambda environment variables, and activate GuardDuty for threat detection. Apply AWS Shield to provide DDoS protection across resources. The final output should be a CloudFormation YAML file named secure-infrastructure.yaml that passes CloudFormation validation and creates all required components successfully.
