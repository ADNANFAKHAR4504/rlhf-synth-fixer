{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Zero-Trust Security Baseline Infrastructure - Production Ready with Full KMS Integration",
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "Environment Configuration"
                    },
                    "Parameters": [
                        "EnvironmentSuffix"
                    ]
                },
                {
                    "Label": {
                        "default": "Security Configuration"
                    },
                    "Parameters": [
                        "SecurityAccountId"
                    ]
                },
                {
                    "Label": {
                        "default": "Tagging Configuration"
                    },
                    "Parameters": [
                        "OwnerTag",
                        "ClassificationTag"
                    ]
                }
            ],
            "ParameterLabels": {
                "EnvironmentSuffix": {
                    "default": "Environment Suffix"
                },
                "SecurityAccountId": {
                    "default": "Security Account ID"
                },
                "OwnerTag": {
                    "default": "Owner Tag"
                },
                "ClassificationTag": {
                    "default": "Classification Tag"
                }
            }
        }
    },
    "Parameters": {
        "EnvironmentSuffix": {
            "Type": "String",
            "Description": "Environment suffix for resource naming (dev, staging, prod)",
            "AllowedValues": [
                "dev",
                "staging",
                "prod"
            ],
            "Default": "dev"
        },
        "SecurityAccountId": {
            "Type": "String",
            "Description": "Central security account ID for cross-account access (leave empty to use current account)",
            "Default": "",
            "AllowedPattern": "^([0-9]{12})?$",
            "ConstraintDescription": "Must be a valid 12-digit AWS account ID or empty to use current account"
        },
        "OwnerTag": {
            "Type": "String",
            "Description": "Resource owner for tagging",
            "Default": "SecurityTeam",
            "MinLength": 1,
            "MaxLength": 50
        },
        "ClassificationTag": {
            "Type": "String",
            "Description": "Data classification level",
            "AllowedValues": [
                "confidential",
                "restricted",
                "public"
            ],
            "Default": "confidential"
        }
    },
    "Conditions": {
        "UseCurrentAccount": {
            "Fn::Equals": [
                {
                    "Ref": "SecurityAccountId"
                },
                ""
            ]
        },
        "HasSecurityAccount": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "SecurityAccountId"
                        },
                        ""
                    ]
                }
            ]
        }
    },
    "Resources": {
        "DeveloperPermissionsBoundary": {
            "Type": "AWS::IAM::ManagedPolicy",
            "Properties": {
                "ManagedPolicyName": {
                    "Fn::Sub": "DeveloperBoundary-${EnvironmentSuffix}"
                },
                "Description": {
                    "Fn::Sub": "Permissions boundary for developer role in ${EnvironmentSuffix} - Prevents privilege escalation"
                },
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Sid": "DenyPrivilegeEscalation",
                            "Effect": "Deny",
                            "Action": [
                                "iam:CreateAccessKey",
                                "iam:DeleteAccessKey",
                                "iam:UpdateAccessKey",
                                "iam:CreateUser",
                                "iam:DeleteUser",
                                "iam:AddUserToGroup",
                                "iam:RemoveUserFromGroup",
                                "iam:AttachUserPolicy",
                                "iam:DetachUserPolicy",
                                "iam:CreatePolicy",
                                "iam:DeletePolicy",
                                "iam:CreatePolicyVersion",
                                "iam:DeletePolicyVersion",
                                "iam:SetDefaultPolicyVersion",
                                "iam:AttachGroupPolicy",
                                "iam:DetachGroupPolicy",
                                "iam:AttachRolePolicy",
                                "iam:DetachRolePolicy",
                                "iam:PutUserPermissionsBoundary",
                                "iam:PutRolePermissionsBoundary",
                                "iam:DeleteUserPermissionsBoundary",
                                "iam:DeleteRolePermissionsBoundary"
                            ],
                            "Resource": "*"
                        },
                        {
                            "Sid": "DenySensitiveOperations",
                            "Effect": "Deny",
                            "Action": [
                                "kms:ScheduleKeyDeletion",
                                "kms:Delete*",
                                "s3:DeleteBucket",
                                "s3:DeleteBucketPolicy",
                                "rds:DeleteDBInstance",
                                "rds:DeleteDBCluster",
                                "ec2:DeleteVpc",
                                "cloudformation:DeleteStack",
                                "logs:DeleteLogGroup"
                            ],
                            "Resource": "*"
                        },
                        {
                            "Sid": "DenySecurityServicesModification",
                            "Effect": "Deny",
                            "Action": [
                                "guardduty:Delete*",
                                "guardduty:Disassociate*",
                                "securityhub:Delete*",
                                "securityhub:Disassociate*",
                                "config:Delete*",
                                "config:Stop*",
                                "cloudtrail:Delete*",
                                "cloudtrail:Stop*"
                            ],
                            "Resource": "*"
                        }
                    ]
                }
            }
        },
        "OperationsPermissionsBoundary": {
            "Type": "AWS::IAM::ManagedPolicy",
            "Properties": {
                "ManagedPolicyName": {
                    "Fn::Sub": "OperationsBoundary-${EnvironmentSuffix}"
                },
                "Description": {
                    "Fn::Sub": "Permissions boundary for operations role in ${EnvironmentSuffix}"
                },
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Sid": "DenyAccountModification",
                            "Effect": "Deny",
                            "Action": [
                                "iam:CreateAccountAlias",
                                "iam:DeleteAccountAlias",
                                "iam:UpdateAccountPasswordPolicy",
                                "iam:DeleteAccountPasswordPolicy",
                                "organizations:*"
                            ],
                            "Resource": "*"
                        },
                        {
                            "Sid": "DenyBillingAccess",
                            "Effect": "Deny",
                            "Action": [
                                "aws-portal:*",
                                "budgets:*",
                                "ce:*",
                                "cur:*"
                            ],
                            "Resource": "*"
                        }
                    ]
                }
            }
        },
        "DeveloperRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "RoleName": {
                    "Fn::Sub": "DeveloperRole-${EnvironmentSuffix}"
                },
                "Description": {
                    "Fn::Sub": "Developer role with read-only access and MFA requirement for ${EnvironmentSuffix}"
                },
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": {
                                    "Fn::If": [
                                        "UseCurrentAccount",
                                        {
                                            "Fn::Sub": "arn:aws:iam::${AWS::AccountId}:root"
                                        },
                                        {
                                            "Fn::Sub": "arn:aws:iam::${SecurityAccountId}:root"
                                        }
                                    ]
                                }
                            },
                            "Action": "sts:AssumeRole",
                            "Condition": {
                                "Bool": {
                                    "aws:MultiFactorAuthPresent": "true"
                                },
                                "NumericLessThan": {
                                    "aws:MultiFactorAuthAge": "3600"
                                }
                            }
                        }
                    ]
                },
                "PermissionsBoundary": {
                    "Ref": "DeveloperPermissionsBoundary"
                },
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/ReadOnlyAccess"
                ],
                "MaxSessionDuration": 14400,
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Owner",
                        "Value": {
                            "Ref": "OwnerTag"
                        }
                    },
                    {
                        "Key": "Classification",
                        "Value": {
                            "Ref": "ClassificationTag"
                        }
                    },
                    {
                        "Key": "MFARequired",
                        "Value": "true"
                    }
                ]
            }
        },
        "SecurityAdminRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "RoleName": {
                    "Fn::Sub": "SecurityAdminRole-${EnvironmentSuffix}"
                },
                "Description": {
                    "Fn::Sub": "Security administration role with audit capabilities for ${EnvironmentSuffix}"
                },
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": {
                                    "Fn::If": [
                                        "UseCurrentAccount",
                                        {
                                            "Fn::Sub": "arn:aws:iam::${AWS::AccountId}:root"
                                        },
                                        {
                                            "Fn::Sub": "arn:aws:iam::${SecurityAccountId}:root"
                                        }
                                    ]
                                }
                            },
                            "Action": "sts:AssumeRole",
                            "Condition": {
                                "Bool": {
                                    "aws:MultiFactorAuthPresent": "true"
                                },
                                "NumericLessThan": {
                                    "aws:MultiFactorAuthAge": "3600"
                                }
                            }
                        }
                    ]
                },
                "PermissionsBoundary": {
                    "Ref": "OperationsPermissionsBoundary"
                },
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/SecurityAudit"
                ],
                "MaxSessionDuration": 14400,
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Owner",
                        "Value": {
                            "Ref": "OwnerTag"
                        }
                    },
                    {
                        "Key": "Classification",
                        "Value": {
                            "Ref": "ClassificationTag"
                        }
                    },
                    {
                        "Key": "MFARequired",
                        "Value": "true"
                    }
                ]
            }
        },
        "SecurityOperationsRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "RoleName": {
                    "Fn::Sub": "SecurityOperationsRole-${EnvironmentSuffix}"
                },
                "Description": {
                    "Fn::Sub": "Security operations role for incident response in ${EnvironmentSuffix}"
                },
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": {
                                    "Fn::If": [
                                        "UseCurrentAccount",
                                        {
                                            "Fn::Sub": "arn:aws:iam::${AWS::AccountId}:root"
                                        },
                                        {
                                            "Fn::Sub": "arn:aws:iam::${SecurityAccountId}:root"
                                        }
                                    ]
                                }
                            },
                            "Action": "sts:AssumeRole",
                            "Condition": {
                                "Bool": {
                                    "aws:MultiFactorAuthPresent": "true"
                                },
                                "NumericLessThan": {
                                    "aws:MultiFactorAuthAge": "3600"
                                }
                            }
                        }
                    ]
                },
                "PermissionsBoundary": {
                    "Ref": "OperationsPermissionsBoundary"
                },
                "MaxSessionDuration": 14400,
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Owner",
                        "Value": {
                            "Ref": "OwnerTag"
                        }
                    },
                    {
                        "Key": "Classification",
                        "Value": {
                            "Ref": "ClassificationTag"
                        }
                    },
                    {
                        "Key": "MFARequired",
                        "Value": "true"
                    }
                ]
            }
        },
        "SecurityOperationsPolicy": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyName": {
                    "Fn::Sub": "SecurityOperationsPolicy-${EnvironmentSuffix}"
                },
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Sid": "AllowKMSOperations",
                            "Effect": "Allow",
                            "Action": [
                                "kms:Encrypt",
                                "kms:Decrypt",
                                "kms:ReEncrypt*",
                                "kms:GenerateDataKey*",
                                "kms:DescribeKey",
                                "kms:ListKeys",
                                "kms:ListAliases"
                            ],
                            "Resource": "*"
                        },
                        {
                            "Sid": "AllowLogsAccess",
                            "Effect": "Allow",
                            "Action": [
                                "logs:CreateLogStream",
                                "logs:PutLogEvents",
                                "logs:DescribeLogGroups",
                                "logs:DescribeLogStreams"
                            ],
                            "Resource": [
                                {
                                    "Fn::Sub": "arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/security/*"
                                },
                                {
                                    "Fn::Sub": "arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/compliance/*"
                                }
                            ]
                        },
                        {
                            "Sid": "AllowSSMParameterAccess",
                            "Effect": "Allow",
                            "Action": [
                                "ssm:GetParameter",
                                "ssm:GetParameters",
                                "ssm:GetParametersByPath"
                            ],
                            "Resource": {
                                "Fn::Sub": "arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:parameter/${EnvironmentSuffix}/*"
                            }
                        }
                    ]
                },
                "Roles": [
                    {
                        "Ref": "SecurityOperationsRole"
                    }
                ]
            }
        },
        "MFAEnforcementPolicy": {
            "Type": "AWS::IAM::ManagedPolicy",
            "Properties": {
                "ManagedPolicyName": {
                    "Fn::Sub": "MFAEnforcement-${EnvironmentSuffix}"
                },
                "Description": "Enforces MFA for delete operations on critical resources",
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Sid": "DenyCriticalActionsWithoutMFA",
                            "Effect": "Deny",
                            "Action": [
                                "s3:DeleteBucket",
                                "s3:DeleteBucketPolicy",
                                "s3:DeleteObject",
                                "s3:DeleteObjectVersion",
                                "rds:DeleteDBInstance",
                                "rds:DeleteDBSnapshot",
                                "rds:DeleteDBCluster",
                                "ec2:TerminateInstances",
                                "ec2:DeleteVolume",
                                "ec2:DeleteSnapshot",
                                "kms:ScheduleKeyDeletion",
                                "kms:DeleteAlias",
                                "cloudformation:DeleteStack",
                                "iam:DeleteUser",
                                "iam:DeleteRole",
                                "iam:DeletePolicy",
                                "logs:DeleteLogGroup"
                            ],
                            "Resource": "*",
                            "Condition": {
                                "BoolIfExists": {
                                    "aws:MultiFactorAuthPresent": "false"
                                }
                            }
                        }
                    ]
                },
                "Roles": [
                    {
                        "Ref": "DeveloperRole"
                    },
                    {
                        "Ref": "SecurityAdminRole"
                    },
                    {
                        "Ref": "SecurityOperationsRole"
                    }
                ]
            }
        },
        "SecurityKMSKey": {
            "Type": "AWS::KMS::Key",
            "Properties": {
                "Description": {
                    "Fn::Sub": "Security CMK for ${EnvironmentSuffix} environment - Encrypts logs, SNS, and sensitive data"
                },
                "Enabled": true,
                "EnableKeyRotation": true,
                "MultiRegion": false,
                "KeyPolicy": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Sid": "EnableIAMUserPermissions",
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": {
                                    "Fn::Sub": "arn:aws:iam::${AWS::AccountId}:root"
                                }
                            },
                            "Action": "kms:*",
                            "Resource": "*"
                        },
                        {
                            "Sid": "AllowKeyAdministration",
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": {
                                    "Fn::GetAtt": [
                                        "SecurityAdminRole",
                                        "Arn"
                                    ]
                                }
                            },
                            "Action": [
                                "kms:Create*",
                                "kms:Describe*",
                                "kms:Enable*",
                                "kms:List*",
                                "kms:Put*",
                                "kms:Update*",
                                "kms:Revoke*",
                                "kms:Disable*",
                                "kms:Get*",
                                "kms:Delete*",
                                "kms:TagResource",
                                "kms:UntagResource",
                                "kms:ScheduleKeyDeletion",
                                "kms:CancelKeyDeletion"
                            ],
                            "Resource": "*"
                        },
                        {
                            "Sid": "AllowKeyUsageForServices",
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": {
                                    "Fn::GetAtt": [
                                        "SecurityOperationsRole",
                                        "Arn"
                                    ]
                                }
                            },
                            "Action": [
                                "kms:Encrypt",
                                "kms:Decrypt",
                                "kms:ReEncrypt*",
                                "kms:GenerateDataKey*",
                                "kms:DescribeKey"
                            ],
                            "Resource": "*"
                        },
                        {
                            "Sid": "AllowCrossAccountSecurityAccess",
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": {
                                    "Fn::If": [
                                        "HasSecurityAccount",
                                        {
                                            "Fn::Sub": "arn:aws:iam::${SecurityAccountId}:root"
                                        },
                                        {
                                            "Fn::Sub": "arn:aws:iam::${AWS::AccountId}:root"
                                        }
                                    ]
                                }
                            },
                            "Action": [
                                "kms:Encrypt",
                                "kms:Decrypt",
                                "kms:ReEncrypt*",
                                "kms:GenerateDataKey*",
                                "kms:DescribeKey"
                            ],
                            "Resource": "*",
                            "Condition": {
                                "Fn::If": [
                                    "HasSecurityAccount",
                                    {
                                        "ArnLike": {
                                            "aws:PrincipalArn": {
                                                "Fn::Sub": "arn:aws:iam::${SecurityAccountId}:role/*"
                                            }
                                        }
                                    },
                                    {
                                        "ArnLike": {
                                            "aws:PrincipalArn": {
                                                "Fn::Sub": "arn:aws:iam::${AWS::AccountId}:role/*"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "Sid": "AllowCloudWatchLogs",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": {
                                    "Fn::Sub": "logs.${AWS::Region}.amazonaws.com"
                                }
                            },
                            "Action": [
                                "kms:Encrypt",
                                "kms:Decrypt",
                                "kms:ReEncrypt*",
                                "kms:GenerateDataKey*",
                                "kms:DescribeKey"
                            ],
                            "Resource": "*",
                            "Condition": {
                                "ArnLike": {
                                    "kms:EncryptionContext:aws:logs:arn": {
                                        "Fn::Sub": "arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:*"
                                    }
                                }
                            }
                        },
                        {
                            "Sid": "AllowSNS",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "sns.amazonaws.com"
                            },
                            "Action": [
                                "kms:Encrypt",
                                "kms:Decrypt",
                                "kms:ReEncrypt*",
                                "kms:GenerateDataKey*",
                                "kms:DescribeKey"
                            ],
                            "Resource": "*",
                            "Condition": {
                                "StringEquals": {
                                    "aws:SourceAccount": {
                                        "Ref": "AWS::AccountId"
                                    }
                                },
                                "ArnLike": {
                                    "aws:SourceArn": {
                                        "Fn::Sub": "arn:aws:sns:${AWS::Region}:${AWS::AccountId}:*"
                                    }
                                }
                            }
                        },
                        {
                            "Sid": "AllowEventBridge",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "events.amazonaws.com"
                            },
                            "Action": [
                                "kms:Decrypt",
                                "kms:GenerateDataKey",
                                "kms:DescribeKey"
                            ],
                            "Resource": "*",
                            "Condition": {
                                "StringEquals": {
                                    "aws:SourceAccount": {
                                        "Ref": "AWS::AccountId"
                                    }
                                },
                                "ArnLike": {
                                    "aws:SourceArn": {
                                        "Fn::Sub": "arn:aws:events:${AWS::Region}:${AWS::AccountId}:*"
                                    }
                                }
                            }
                        },
                        {
                            "Sid": "AllowLambda",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "lambda.amazonaws.com"
                            },
                            "Action": [
                                "kms:Decrypt",
                                "kms:GenerateDataKey*",
                                "kms:DescribeKey"
                            ],
                            "Resource": "*",
                            "Condition": {
                                "StringEquals": {
                                    "aws:SourceAccount": {
                                        "Ref": "AWS::AccountId"
                                    }
                                },
                                "ArnLike": {
                                    "aws:SourceArn": {
                                        "Fn::Sub": "arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:*"
                                    }
                                }
                            }
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Owner",
                        "Value": {
                            "Ref": "OwnerTag"
                        }
                    },
                    {
                        "Key": "Classification",
                        "Value": {
                            "Ref": "ClassificationTag"
                        }
                    },
                    {
                        "Key": "AutoRotation",
                        "Value": "Enabled"
                    },
                    {
                        "Key": "Purpose",
                        "Value": "SecurityBaseline"
                    }
                ]
            }
        },
        "SecurityKMSKeyAlias": {
            "Type": "AWS::KMS::Alias",
            "Properties": {
                "AliasName": {
                    "Fn::Sub": "alias/security-key-${EnvironmentSuffix}"
                },
                "TargetKeyId": {
                    "Ref": "SecurityKMSKey"
                }
            }
        },
        "DatabaseCredentialsParameter": {
            "Type": "AWS::SSM::Parameter",
            "Properties": {
                "Name": {
                    "Fn::Sub": "/${EnvironmentSuffix}/database/credentials"
                },
                "Description": "Encrypted database credentials - placeholder for actual secrets",
                "Type": "String",
                "Value": "placeholder-encrypted-credentials-replace-with-actual-secrets",
                "Tier": "Standard",
                "Tags": {
                    "Environment": {
                        "Ref": "EnvironmentSuffix"
                    },
                    "Owner": {
                        "Ref": "OwnerTag"
                    },
                    "Classification": {
                        "Ref": "ClassificationTag"
                    },
                    "Purpose": "DatabaseCredentials"
                }
            }
        },
        "APIKeysParameter": {
            "Type": "AWS::SSM::Parameter",
            "Properties": {
                "Name": {
                    "Fn::Sub": "/${EnvironmentSuffix}/api/keys"
                },
                "Description": "Encrypted API keys storage",
                "Type": "String",
                "Value": "placeholder-encrypted-api-keys",
                "Tier": "Standard",
                "Tags": {
                    "Environment": {
                        "Ref": "EnvironmentSuffix"
                    },
                    "Owner": {
                        "Ref": "OwnerTag"
                    },
                    "Classification": {
                        "Ref": "ClassificationTag"
                    },
                    "Purpose": "APIKeys"
                }
            }
        },
        "SecurityAuditLogGroup": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
                "LogGroupName": {
                    "Fn::Sub": "/aws/security/audit-${EnvironmentSuffix}"
                },
                "RetentionInDays": 90,
                "KmsKeyId": {
                    "Fn::GetAtt": [
                        "SecurityKMSKey",
                        "Arn"
                    ]
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Owner",
                        "Value": {
                            "Ref": "OwnerTag"
                        }
                    },
                    {
                        "Key": "Classification",
                        "Value": {
                            "Ref": "ClassificationTag"
                        }
                    },
                    {
                        "Key": "Purpose",
                        "Value": "SecurityAudit"
                    },
                    {
                        "Key": "RetentionDays",
                        "Value": "90"
                    }
                ]
            }
        },
        "ComplianceLogGroup": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
                "LogGroupName": {
                    "Fn::Sub": "/aws/compliance/events-${EnvironmentSuffix}"
                },
                "RetentionInDays": 90,
                "KmsKeyId": {
                    "Fn::GetAtt": [
                        "SecurityKMSKey",
                        "Arn"
                    ]
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Owner",
                        "Value": {
                            "Ref": "OwnerTag"
                        }
                    },
                    {
                        "Key": "Classification",
                        "Value": {
                            "Ref": "ClassificationTag"
                        }
                    },
                    {
                        "Key": "Purpose",
                        "Value": "ComplianceEvents"
                    },
                    {
                        "Key": "RetentionDays",
                        "Value": "90"
                    }
                ]
            }
        },
        "ApplicationLogGroup": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
                "LogGroupName": {
                    "Fn::Sub": "/aws/application/logs-${EnvironmentSuffix}"
                },
                "RetentionInDays": 30,
                "KmsKeyId": {
                    "Fn::GetAtt": [
                        "SecurityKMSKey",
                        "Arn"
                    ]
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Owner",
                        "Value": {
                            "Ref": "OwnerTag"
                        }
                    },
                    {
                        "Key": "Classification",
                        "Value": "restricted"
                    },
                    {
                        "Key": "Purpose",
                        "Value": "ApplicationLogs"
                    },
                    {
                        "Key": "RetentionDays",
                        "Value": "30"
                    }
                ]
            }
        },
        "ConfigServiceLinkedRole": {
            "Type": "AWS::IAM::ServiceLinkedRole",
            "Properties": {
                "AWSServiceName": "config.amazonaws.com",
                "Description": {
                    "Fn::Sub": "Service-linked role for AWS Config in ${EnvironmentSuffix} environment"
                }
            }
        },
        "PasswordPolicyUser": {
            "Type": "AWS::IAM::User",
            "Properties": {
                "UserName": {
                    "Fn::Sub": "password-policy-demo-${EnvironmentSuffix}"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Owner",
                        "Value": {
                            "Ref": "OwnerTag"
                        }
                    },
                    {
                        "Key": "Classification",
                        "Value": {
                            "Ref": "ClassificationTag"
                        }
                    },
                    {
                        "Key": "Purpose",
                        "Value": "PasswordPolicyDemo"
                    }
                ]
            }
        },
        "SecurityAlertsTopic": {
            "Type": "AWS::SNS::Topic",
            "Properties": {
                "TopicName": {
                    "Fn::Sub": "security-alerts-${EnvironmentSuffix}"
                },
                "DisplayName": {
                    "Fn::Sub": "Security Alerts for ${EnvironmentSuffix} Environment"
                },
                "KmsMasterKeyId": {
                    "Ref": "SecurityKMSKey"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Owner",
                        "Value": {
                            "Ref": "OwnerTag"
                        }
                    },
                    {
                        "Key": "Classification",
                        "Value": {
                            "Ref": "ClassificationTag"
                        }
                    },
                    {
                        "Key": "Purpose",
                        "Value": "SecurityAlerts"
                    }
                ]
            }
        },
        "ComplianceAlertsTopic": {
            "Type": "AWS::SNS::Topic",
            "Properties": {
                "TopicName": {
                    "Fn::Sub": "compliance-alerts-${EnvironmentSuffix}"
                },
                "DisplayName": {
                    "Fn::Sub": "Compliance Alerts for ${EnvironmentSuffix} Environment"
                },
                "KmsMasterKeyId": {
                    "Ref": "SecurityKMSKey"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Owner",
                        "Value": {
                            "Ref": "OwnerTag"
                        }
                    },
                    {
                        "Key": "Classification",
                        "Value": {
                            "Ref": "ClassificationTag"
                        }
                    },
                    {
                        "Key": "Purpose",
                        "Value": "ComplianceAlerts"
                    }
                ]
            }
        }
    },
    "Outputs": {
        "SecurityKMSKeyArn": {
            "Description": "ARN of the Security KMS Key",
            "Value": {
                "Fn::GetAtt": [
                    "SecurityKMSKey",
                    "Arn"
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-SecurityKMSKeyArn"
                }
            }
        },
        "SecurityKMSKeyId": {
            "Description": "ID of the Security KMS Key",
            "Value": {
                "Ref": "SecurityKMSKey"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-SecurityKMSKeyId"
                }
            }
        },
        "SecurityKMSKeyAlias": {
            "Description": "Alias of the Security KMS Key",
            "Value": {
                "Ref": "SecurityKMSKeyAlias"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-SecurityKMSKeyAlias"
                }
            }
        },
        "DeveloperRoleArn": {
            "Description": "ARN of the Developer IAM Role (MFA Required)",
            "Value": {
                "Fn::GetAtt": [
                    "DeveloperRole",
                    "Arn"
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-DeveloperRoleArn"
                }
            }
        },
        "SecurityAdminRoleArn": {
            "Description": "ARN of the Security Admin IAM Role (MFA Required)",
            "Value": {
                "Fn::GetAtt": [
                    "SecurityAdminRole",
                    "Arn"
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-SecurityAdminRoleArn"
                }
            }
        },
        "SecurityOperationsRoleArn": {
            "Description": "ARN of the Security Operations IAM Role (MFA Required)",
            "Value": {
                "Fn::GetAtt": [
                    "SecurityOperationsRole",
                    "Arn"
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-SecurityOperationsRoleArn"
                }
            }
        },
        "SecurityAlertsTopicArn": {
            "Description": "ARN of the Security Alerts SNS Topic",
            "Value": {
                "Ref": "SecurityAlertsTopic"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-SecurityAlertsTopicArn"
                }
            }
        },
        "ComplianceAlertsTopicArn": {
            "Description": "ARN of the Compliance Alerts SNS Topic",
            "Value": {
                "Ref": "ComplianceAlertsTopic"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-ComplianceAlertsTopicArn"
                }
            }
        },
        "SecurityAuditLogGroupName": {
            "Description": "Name of the Security Audit Log Group (90-day retention)",
            "Value": {
                "Ref": "SecurityAuditLogGroup"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-AuditLogGroupName"
                }
            }
        },
        "ComplianceLogGroupName": {
            "Description": "Name of the Compliance Log Group (90-day retention)",
            "Value": {
                "Ref": "ComplianceLogGroup"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-ComplianceLogGroupName"
                }
            }
        },
        "ApplicationLogGroupName": {
            "Description": "Name of the Application Log Group (30-day retention)",
            "Value": {
                "Ref": "ApplicationLogGroup"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-ApplicationLogGroupName"
                }
            }
        },
        "DatabaseCredentialsParameterName": {
            "Description": "Name of the encrypted database credentials parameter",
            "Value": {
                "Ref": "DatabaseCredentialsParameter"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-DatabaseCredentialsParameterName"
                }
            }
        },
        "APIKeysParameterName": {
            "Description": "Name of the encrypted API keys parameter",
            "Value": {
                "Ref": "APIKeysParameter"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${EnvironmentSuffix}-APIKeysParameterName"
                }
            }
        },
        "StackSummary": {
            "Description": "Summary of deployed resources",
            "Value": {
                "Fn::Sub": "Zero-Trust Security Baseline deployed for ${EnvironmentSuffix} environment\n- 3 IAM Roles with MFA enforcement\n- 1 KMS Key with automatic rotation\n- 3 CloudWatch Log Groups with encryption\n- 2 SNS Topics for alerts\n- 2 SSM Parameters for secrets\nAll resources are encrypted at rest with KMS"
            }
        }
    }
}