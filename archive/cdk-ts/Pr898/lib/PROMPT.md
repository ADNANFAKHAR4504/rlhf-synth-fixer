I need to create AWS infrastructure code for a secure and highly available environment that includes EC2, RDS, and S3 services. The infrastructure should follow best practices for security and high availability.

Requirements:
- Set up a VPC with public and private subnets across multiple availability zones
- Deploy EC2 instances with proper security groups
- Create an RDS database with backup and encryption
- Configure S3 buckets with encryption and access controls
- Implement proper IAM roles and policies
- Enable logging and monitoring

Please also include these newer AWS security features:
- AWS GuardDuty Extended Threat Detection for EKS (if using containers)
- AWS Certificate Manager with exportable certificates for secure communications

The infrastructure should be cost-effective and avoid resources that take too long to deploy. Please provide infrastructure code with one code block per file.