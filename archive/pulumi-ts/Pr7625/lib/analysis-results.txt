/home/runner/work/iac-test-automations/iac-test-automations/lib/analyse.py:69: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  'scanId': f"scan-{datetime.utcnow().strftime('%Y%m%d%H%M%S')}",
/home/runner/work/iac-test-automations/iac-test-automations/lib/analyse.py:70: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  'timestamp': datetime.utcnow().isoformat() + 'Z',

============================================================
  AWS Infrastructure Compliance Analyzer
============================================================

This script demonstrates the compliance analysis capabilities
deployed by this Pulumi infrastructure.


============================================================
  Environment Check
============================================================

  AWS_REGION: us-east-1
  AWS_ACCESS_KEY_ID: ***
  AWS_SECRET_ACCESS_KEY: ***
  ENVIRONMENT_SUFFIX: pr7625

‚úÖ Environment variables configured

============================================================
  Infrastructure Validation
============================================================

üèóÔ∏è Required Pulumi Resources:
  ‚úì S3 Bucket (compliance reports storage)
  ‚úì DynamoDB Table (violations tracking)
  ‚úì DynamoDB Streams (violation processing)
  ‚úì Lambda Function (compliance scanner)
  ‚úì Lambda Function (stream processor)
  ‚úì EventBridge Rule (scheduled scans)
  ‚úì CloudWatch Log Group (Lambda logging)
  ‚úì IAM Role (read-only compliance checks)

‚úÖ All required infrastructure components defined

============================================================
  Simulating Compliance Scan
============================================================

üìã Scanning AWS resources...
  ‚úì EC2 instances: Checking required tags
  ‚úì Security groups: Analyzing ingress rules
  ‚úì S3 buckets: Validating encryption settings
  ‚úì IAM users: Checking access key age
  ‚úì EBS volumes: Finding unattached volumes
  ‚úì VPC flow logs: Verifying CloudWatch logging

‚úÖ Compliance scan completed

============================================================
  Compliance Analysis Report
============================================================

Scan ID: scan-20251201232913
Timestamp: 2025-12-01T23:29:13.996047Z
Environment: pr7625

üìä Overall Compliance Score
  Score: 79.5%
  Total Resources: 44
  Compliant: 35
  Violations: 9

üìà Service-Level Scores
  ‚ö†Ô∏è EC2: 60.0%
  ‚ö†Ô∏è SECURITYGROUPS: 75.0%
  ‚úÖ S3: 83.3%
  ‚ö†Ô∏è IAM: 66.7%
  ‚úÖ EBS: 90.0%
  ‚úÖ VPC: 100.0%

üîç Violations by Service

  EC2: 2 violation(s)
    ‚Ä¢ EC2 instance i-0abc123 missing required tag: Environment
    ‚Ä¢ EC2 instance i-0def456 missing required tag: Owner

  SECURITYGROUPS: 2 violation(s)
    ‚Ä¢ Security group sg-0abc123 allows 0.0.0.0/0 on port 22
    ‚Ä¢ Security group sg-0def456 allows 0.0.0.0/0 on port 3389

  S3: 2 violation(s)
    ‚Ä¢ S3 bucket example-bucket-1 encryption not enabled
    ‚Ä¢ S3 bucket example-bucket-2 public access block not configured

  IAM: 2 violation(s)
    ‚Ä¢ IAM user john.doe has access key older than 90 days (created 120 days ago)
    ‚Ä¢ IAM user jane.smith has access key older than 90 days (created 95 days ago)

  EBS: 1 violation(s)
    ‚Ä¢ EBS volume vol-0abc123 is unattached (created 30 days ago)

üìÑ Report saved to: lib/analysis-results.txt

============================================================
  Analysis Complete
============================================================

‚ö†Ô∏è  WARNING: Some violations detected
   Overall compliance score: 79.5%
   Recommendation: Review and remediate violations
