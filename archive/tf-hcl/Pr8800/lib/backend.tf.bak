# backend.tf
# Terraform Backend Configuration for State Management
# This file configures remote state storage for the migration from us-west-1 to us-west-2

terraform {
  backend "s3" {
    # S3 Bucket Configuration
    # PLACEHOLDER - Replace with your actual S3 bucket name
    bucket = "PLACEHOLDER-terraform-state-bucket"

    # State file key/path in S3
    # Uses region-specific path to separate old and new region states
    key = "myapp/us-west-2/terraform.tfstate"

    # Region where the state bucket is located
    # Best practice: Use us-west-2 for new region state
    region = "us-west-2"

    # Enable encryption at rest for state file
    encrypt = true

    # DynamoDB table for state locking
    # PLACEHOLDER - Replace with your actual DynamoDB table name
    dynamodb_table = "PLACEHOLDER-terraform-locks"

    # Optional: Use KMS key for encryption
    # kms_key_id = "arn:aws:kms:us-west-2:ACCOUNT-ID:key/KEY-ID"

    # Optional: Use assume role for cross-account access
    # role_arn = "arn:aws:iam::ACCOUNT-ID:role/TerraformRole"

    # Optional: Workspace prefix for multi-environment support
    # workspace_key_prefix = "workspaces"
  }
}

# Alternative Backend Configurations (commented out)
# Uncomment and configure based on your infrastructure needs

# Option 2: Terraform Cloud/Enterprise Backend
# terraform {
#   backend "remote" {
#     hostname     = "app.terraform.io"
#     organization = "PLACEHOLDER-ORG-NAME"
#
#     workspaces {
#       name = "myapp-us-west-2"
#       # Or use prefix for multiple environments
#       # prefix = "myapp-"
#     }
#   }
# }

# Option 3: Local Backend (NOT recommended for production)
# Only use for testing or development
# terraform {
#   backend "local" {
#     path = "terraform.tfstate"
#   }
# }

# Backend Migration Notes:
# 1. Before migrating state, backup the old state file:
#    terraform state pull > backup-us-west-1.tfstate
#
# 2. To change backends, use:
#    terraform init -migrate-state
#
# 3. For workspace-based migration:
#    - Create workspace: terraform workspace new myapp-us-west-2
#    - Select workspace: terraform workspace select myapp-us-west-2
#    - Import resources: See state-migration.md
#
# 4. State file security:
#    - Enable versioning on S3 bucket
#    - Enable MFA Delete on S3 bucket
#    - Restrict access using IAM policies
#    - Use encryption (KMS or AES-256)
#
# 5. DynamoDB table requirements:
#    - Primary Key: LockID (String)
#    - Billing mode: PAY_PER_REQUEST or PROVISIONED with adequate capacity
