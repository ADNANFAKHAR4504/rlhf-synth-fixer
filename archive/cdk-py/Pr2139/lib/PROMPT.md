We’re building this in AWS CDK with Python, and keeping it to two files only: tap.py (the app/entrypoint that wires up regions and environments) and lib/tap_stack.py (the stack that defines everything). When the model responds, it should return only the code for those two files — no explanations, no comments, nothing extra.

The goal is a consistent multi-region setup that runs in both us-east-1 and us-west-2, and supports two environments: prod and dev. Each environment needs its own VPC per region. Create the VPCs with separate public and private subnets spread across multiple AZs. EC2 capacity should be managed by Auto Scaling Groups with health checks so unhealthy instances are replaced automatically (attach to an ALB if that makes health checks simpler). IAM roles and policies must follow least privilege — no broad wildcards — and should be scoped to the exact actions the services need.

S3 should be used for application data with versioning enabled; encryption at rest should be on everywhere (S3, RDS storage, EBS) using KMS, and traffic in transit should use TLS where applicable. Add CloudWatch Alarms for EC2 CPU utilization so we can see trouble in both environments and both regions. Stand up an RDS instance configuration that uses encryption at rest and automated backups; keep it inside private subnets and restrict access via security groups only. For content delivery, create a CloudFront distribution for the production environment only (use the default CloudFront domain so we don’t depend on external certs). Route 53 should be in place for DNS management across regions; model the records you need to point traffic at the right endpoints per environment.

Name things clearly so the environment shows up in the resource names (e.g., vpc-prod-use1, vpc-dev-usw2 or similar) and keep the implementation free of hard-coded secrets. Everything should deploy cleanly with cdk deploy in both regions.

Return only the code for tap.py and lib/tap_stack.py.