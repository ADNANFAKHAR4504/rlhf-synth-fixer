"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
const environmentSuffix = process.env.ENVIRONMENT_SUFFIX || 'dev';
describe('Startup Infrastructure CloudFormation Template', () => {
    let template;
    beforeAll(() => {
        // Run `pipenv run cfn-flip lib/TapStack.yml > lib/TapStack.json` to convert YAML to JSON
        const templatePath = path_1.default.join(__dirname, '../lib/TapStack.json');
        const templateContent = fs_1.default.readFileSync(templatePath, 'utf8');
        template = JSON.parse(templateContent);
    });
    describe('Template Structure', () => {
        test('should have valid CloudFormation format version', () => {
            expect(template.AWSTemplateFormatVersion).toBe('2010-09-09');
        });
        test('should have a description', () => {
            expect(template.Description).toBeDefined();
            expect(template.Description).toBe('Secure AWS environment with VPC, ALB, ASG, and EC2 instances running Nginx');
        });
    });
    describe('Parameters', () => {
        test('should have all required parameters', () => {
            expect(template.Parameters.InstanceType).toBeDefined();
            expect(template.Parameters.KeyPairName).toBeDefined();
        });
        test('InstanceType parameter should have correct properties', () => {
            const instanceTypeParam = template.Parameters.InstanceType;
            expect(instanceTypeParam.Type).toBe('String');
            expect(instanceTypeParam.Default).toBe('t3.micro');
            expect(instanceTypeParam.Description).toBe('EC2 instance type for the Auto Scaling Group');
            expect(instanceTypeParam.AllowedValues).toEqual(['t3.micro', 't3.small', 't3.medium']);
        });
        test('KeyPairName parameter should have correct properties', () => {
            const keyPairParam = template.Parameters.KeyPairName;
            expect(keyPairParam.Type).toBe('String');
            expect(keyPairParam.Default).toBe('');
            expect(keyPairParam.Description).toBe('Name of an existing EC2 KeyPair to enable SSH access (leave empty to skip)');
        });
    });
    describe('Conditions', () => {
        test('should have HasKeyPair condition', () => {
            expect(template.Conditions.HasKeyPair).toBeDefined();
            expect(template.Conditions.HasKeyPair).toEqual({
                'Fn::Not': [{ 'Fn::Equals': [{ 'Ref': 'KeyPairName' }, ''] }]
            });
        });
    });
    describe('VPC Resources', () => {
        test('should have VPC resource', () => {
            expect(template.Resources.VPC).toBeDefined();
            const vpc = template.Resources.VPC;
            expect(vpc.Type).toBe('AWS::EC2::VPC');
            expect(vpc.Properties.CidrBlock).toBe('10.0.0.0/16');
            expect(vpc.Properties.EnableDnsHostnames).toBe(true);
            expect(vpc.Properties.EnableDnsSupport).toBe(true);
        });
        test('should have Internet Gateway', () => {
            expect(template.Resources.InternetGateway).toBeDefined();
            expect(template.Resources.InternetGateway.Type).toBe('AWS::EC2::InternetGateway');
            expect(template.Resources.InternetGatewayAttachment).toBeDefined();
        });
        test('should have NAT Gateway and EIP', () => {
            expect(template.Resources.NatGateway).toBeDefined();
            expect(template.Resources.NatGateway.Type).toBe('AWS::EC2::NatGateway');
            expect(template.Resources.NatGatewayEIP).toBeDefined();
            expect(template.Resources.NatGatewayEIP.Type).toBe('AWS::EC2::EIP');
        });
    });
    describe('Subnet Resources', () => {
        test('should have exactly 2 public subnets', () => {
            expect(template.Resources.PublicSubnet1).toBeDefined();
            expect(template.Resources.PublicSubnet2).toBeDefined();
            expect(template.Resources.PublicSubnet1.Properties.CidrBlock).toBe('10.0.1.0/24');
            expect(template.Resources.PublicSubnet2.Properties.CidrBlock).toBe('10.0.2.0/24');
            expect(template.Resources.PublicSubnet1.Properties.MapPublicIpOnLaunch).toBe(true);
            expect(template.Resources.PublicSubnet2.Properties.MapPublicIpOnLaunch).toBe(true);
        });
        test('should have exactly 2 private subnets', () => {
            expect(template.Resources.PrivateSubnet1).toBeDefined();
            expect(template.Resources.PrivateSubnet2).toBeDefined();
            expect(template.Resources.PrivateSubnet1.Properties.CidrBlock).toBe('10.0.11.0/24');
            expect(template.Resources.PrivateSubnet2.Properties.CidrBlock).toBe('10.0.12.0/24');
        });
        test('subnets should be in different availability zones', () => {
            const publicSubnet1AZ = template.Resources.PublicSubnet1.Properties.AvailabilityZone;
            const publicSubnet2AZ = template.Resources.PublicSubnet2.Properties.AvailabilityZone;
            expect(publicSubnet1AZ).toEqual({ 'Fn::Select': [0, { 'Fn::GetAZs': '' }] });
            expect(publicSubnet2AZ).toEqual({ 'Fn::Select': [1, { 'Fn::GetAZs': '' }] });
        });
    });
    describe('Route Tables', () => {
        test('should have public and private route tables', () => {
            expect(template.Resources.PublicRouteTable).toBeDefined();
            expect(template.Resources.PrivateRouteTable).toBeDefined();
        });
        test('public route table should route to Internet Gateway', () => {
            const publicRoute = template.Resources.DefaultPublicRoute;
            expect(publicRoute.Properties.DestinationCidrBlock).toBe('0.0.0.0/0');
            expect(publicRoute.Properties.GatewayId).toEqual({ 'Ref': 'InternetGateway' });
        });
        test('private route table should route to NAT Gateway', () => {
            const privateRoute = template.Resources.DefaultPrivateRoute;
            expect(privateRoute.Properties.DestinationCidrBlock).toBe('0.0.0.0/0');
            expect(privateRoute.Properties.NatGatewayId).toEqual({ 'Ref': 'NatGateway' });
        });
        test('should have correct route table associations', () => {
            expect(template.Resources.PublicSubnet1RouteTableAssociation).toBeDefined();
            expect(template.Resources.PublicSubnet2RouteTableAssociation).toBeDefined();
            expect(template.Resources.PrivateSubnet1RouteTableAssociation).toBeDefined();
            expect(template.Resources.PrivateSubnet2RouteTableAssociation).toBeDefined();
        });
    });
    describe('Security Groups', () => {
        test('should have ALB security group', () => {
            const albSG = template.Resources.ALBSecurityGroup;
            expect(albSG).toBeDefined();
            expect(albSG.Type).toBe('AWS::EC2::SecurityGroup');
            const ingressRules = albSG.Properties.SecurityGroupIngress;
            expect(ingressRules).toHaveLength(2);
            expect(ingressRules[0].FromPort).toBe(80);
            expect(ingressRules[1].FromPort).toBe(443);
        });
        test('should have Web Server security group', () => {
            const webSG = template.Resources.WebServerSecurityGroup;
            expect(webSG).toBeDefined();
            expect(webSG.Type).toBe('AWS::EC2::SecurityGroup');
            const ingressRules = webSG.Properties.SecurityGroupIngress;
            expect(ingressRules).toHaveLength(2);
            expect(ingressRules[0].FromPort).toBe(80);
            expect(ingressRules[0].SourceSecurityGroupId).toEqual({ 'Ref': 'ALBSecurityGroup' });
            expect(ingressRules[1].FromPort).toBe(22);
            expect(ingressRules[1].CidrIp).toBe('10.0.0.0/16');
        });
    });
    describe('Application Load Balancer', () => {
        test('should have ALB resource', () => {
            const alb = template.Resources.ApplicationLoadBalancer;
            expect(alb).toBeDefined();
            expect(alb.Type).toBe('AWS::ElasticLoadBalancingV2::LoadBalancer');
            expect(alb.Properties.Scheme).toBe('internet-facing');
            expect(alb.Properties.Type).toBe('application');
        });
        test('should have target group with health checks', () => {
            const targetGroup = template.Resources.ALBTargetGroup;
            expect(targetGroup).toBeDefined();
            expect(targetGroup.Type).toBe('AWS::ElasticLoadBalancingV2::TargetGroup');
            expect(targetGroup.Properties.Port).toBe(80);
            expect(targetGroup.Properties.Protocol).toBe('HTTP');
            expect(targetGroup.Properties.HealthCheckPath).toBe('/');
            expect(targetGroup.Properties.HealthCheckIntervalSeconds).toBe(30);
            expect(targetGroup.Properties.HealthyThresholdCount).toBe(2);
            expect(targetGroup.Properties.UnhealthyThresholdCount).toBe(3);
        });
        test('should have ALB listener', () => {
            const listener = template.Resources.ALBListener;
            expect(listener).toBeDefined();
            expect(listener.Type).toBe('AWS::ElasticLoadBalancingV2::Listener');
            expect(listener.Properties.Port).toBe(80);
            expect(listener.Properties.Protocol).toBe('HTTP');
        });
    });
    describe('Auto Scaling Resources', () => {
        test('should have launch template', () => {
            const launchTemplate = template.Resources.LaunchTemplate;
            expect(launchTemplate).toBeDefined();
            expect(launchTemplate.Type).toBe('AWS::EC2::LaunchTemplate');
            const data = launchTemplate.Properties.LaunchTemplateData;
            expect(data.InstanceType).toEqual({ 'Ref': 'InstanceType' });
            expect(data.UserData).toBeDefined();
        });
        test('launch template should conditionally set KeyName', () => {
            const launchTemplate = template.Resources.LaunchTemplate;
            const keyName = launchTemplate.Properties.LaunchTemplateData.KeyName;
            expect(keyName).toEqual({
                'Fn::If': ['HasKeyPair', { 'Ref': 'KeyPairName' }, { 'Ref': 'AWS::NoValue' }]
            });
        });
        test('should have auto scaling group', () => {
            const asg = template.Resources.AutoScalingGroup;
            expect(asg).toBeDefined();
            expect(asg.Type).toBe('AWS::AutoScaling::AutoScalingGroup');
            expect(asg.Properties.MinSize).toBe(1);
            expect(asg.Properties.MaxSize).toBe(4);
            expect(asg.Properties.DesiredCapacity).toBe(2);
            expect(asg.Properties.HealthCheckType).toBe('ELB');
            expect(asg.Properties.HealthCheckGracePeriod).toBe(300);
        });
        test('ASG should be in private subnets', () => {
            const asg = template.Resources.AutoScalingGroup;
            const subnets = asg.Properties.VPCZoneIdentifier;
            expect(subnets).toEqual([
                { 'Ref': 'PrivateSubnet1' },
                { 'Ref': 'PrivateSubnet2' }
            ]);
        });
    });
    describe('Outputs', () => {
        test('should have all required outputs', () => {
            const expectedOutputs = [
                'VPCId',
                'PublicSubnet1Id',
                'PublicSubnet2Id',
                'PrivateSubnet1Id',
                'PrivateSubnet2Id',
                'ALBSecurityGroupId',
                'WebServerSecurityGroupId',
                'ApplicationLoadBalancerDNS',
                'ApplicationLoadBalancerURL'
            ];
            expectedOutputs.forEach(outputName => {
                expect(template.Outputs[outputName]).toBeDefined();
            });
        });
        test('should have correct ALB DNS output', () => {
            const albDnsOutput = template.Outputs.ApplicationLoadBalancerDNS;
            expect(albDnsOutput.Description).toBe('Application Load Balancer DNS Name');
            expect(albDnsOutput.Value).toEqual({
                'Fn::GetAtt': ['ApplicationLoadBalancer', 'DNSName']
            });
        });
        test('should have correct ALB URL output', () => {
            const albUrlOutput = template.Outputs.ApplicationLoadBalancerURL;
            expect(albUrlOutput.Description).toBe('Application Load Balancer URL');
            expect(albUrlOutput.Value).toEqual({
                'Fn::Sub': 'http://${ApplicationLoadBalancer.DNSName}'
            });
        });
    });
    describe('Resource Tags', () => {
        test('all taggable resources should have Environment tag', () => {
            const taggableResources = [
                'VPC',
                'InternetGateway',
                'PublicSubnet1',
                'PublicSubnet2',
                'PrivateSubnet1',
                'PrivateSubnet2',
                'NatGateway',
                'NatGatewayEIP',
                'PublicRouteTable',
                'PrivateRouteTable',
                'ALBSecurityGroup',
                'WebServerSecurityGroup',
                'ApplicationLoadBalancer',
                'ALBTargetGroup'
            ];
            taggableResources.forEach(resourceName => {
                const resource = template.Resources[resourceName];
                const tags = resource.Properties.Tags;
                const envTag = tags.find((tag) => tag.Key === 'Environment');
                expect(envTag).toBeDefined();
                expect(envTag.Value).toBe('Development');
            });
        });
    });
    describe('Template Validation', () => {
        test('should have valid JSON structure', () => {
            expect(template).toBeDefined();
            expect(typeof template).toBe('object');
        });
        test('should not have any undefined or null required sections', () => {
            expect(template.AWSTemplateFormatVersion).not.toBeNull();
            expect(template.Description).not.toBeNull();
            expect(template.Parameters).not.toBeNull();
            expect(template.Resources).not.toBeNull();
            expect(template.Outputs).not.toBeNull();
        });
        test('should have correct number of resources', () => {
            const expectedResourceCount = 24; // Count all resources in template
            const actualResourceCount = Object.keys(template.Resources).length;
            expect(actualResourceCount).toBe(expectedResourceCount);
        });
        test('should have correct number of parameters', () => {
            const parameterCount = Object.keys(template.Parameters).length;
            expect(parameterCount).toBe(2);
        });
        test('should have correct number of outputs', () => {
            const outputCount = Object.keys(template.Outputs).length;
            expect(outputCount).toBe(9);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFwLXN0YWNrLnVuaXQudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3N1YmNhdGVnb3J5LXJlZmVyZW5jZXMvY2xvdWQtZW52aXJvbm1lbnQtc2V0dXAvUHIzMTAwL3Rlc3QvdGFwLXN0YWNrLnVuaXQudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLDRDQUFvQjtBQUNwQixnREFBd0I7QUFFeEIsTUFBTSxpQkFBaUIsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixJQUFJLEtBQUssQ0FBQztBQUVsRSxRQUFRLENBQUMsZ0RBQWdELEVBQUUsR0FBRyxFQUFFO0lBQzlELElBQUksUUFBYSxDQUFDO0lBRWxCLFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYix5RkFBeUY7UUFDekYsTUFBTSxZQUFZLEdBQUcsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztRQUNsRSxNQUFNLGVBQWUsR0FBRyxZQUFFLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxNQUFNLENBQUMsQ0FBQztRQUM5RCxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUN6QyxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7UUFDbEMsSUFBSSxDQUFDLGlEQUFpRCxFQUFFLEdBQUcsRUFBRTtZQUMzRCxNQUFNLENBQUMsUUFBUSxDQUFDLHdCQUF3QixDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQy9ELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtZQUNyQyxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzNDLE1BQU0sQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUMv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QyxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUMxQyxNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7WUFDbkQsTUFBTSxxQkFBcUIsR0FBRyxFQUFFLENBQUMsQ0FBQyxrQ0FBa0M7WUFDcEUsTUFBTSxtQkFBbUIsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDbkUsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDMUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsMENBQTBDLEVBQUUsR0FBRyxFQUFFO1lBQ3BELE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUMvRCxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUNqRCxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDekQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmNvbnN0IGVudmlyb25tZW50U3VmZml4ID0gcHJvY2Vzcy5lbnYuRU5WSVJPTk1FTlRfU1VGRklYIHx8ICdkZXYnO1xuXG5kZXNjcmliZSgnU3RhcnR1cCBJbmZyYXN0cnVjdHVyZSBDbG91ZEZvcm1hdGlvbiBUZW1wbGF0ZScsICgpID0+IHtcbiAgbGV0IHRlbXBsYXRlOiBhbnk7XG5cbiAgYmVmb3JlQWxsKCgpID0+IHtcbiAgICAvLyBSdW4gYHBpcGVudiBydW4gY2ZuLWZsaXAgbGliL1RhcFN0YWNrLnltbCA+IGxpYi9UYXBTdGFjay5qc29uYCB0byBjb252ZXJ0IFlBTUwgdG8gSlNPTlxuICAgIGNvbnN0IHRlbXBsYXRlUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9saWIvVGFwU3RhY2suanNvbicpO1xuICAgIGNvbnN0IHRlbXBsYXRlQ29udGVudCA9IGZzLnJlYWRGaWxlU3luYyh0ZW1wbGF0ZVBhdGgsICd1dGY4Jyk7XG4gICAgdGVtcGxhdGUgPSBKU09OLnBhcnNlKHRlbXBsYXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdUZW1wbGF0ZSBTdHJ1Y3R1cmUnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgdmFsaWQgQ2xvdWRGb3JtYXRpb24gZm9ybWF0IHZlcnNpb24nLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUuQVdTVGVtcGxhdGVGb3JtYXRWZXJzaW9uKS50b0JlKCcyMDEwLTA5LTA5Jyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBhIGRlc2NyaXB0aW9uJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLkRlc2NyaXB0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLkRlc2NyaXB0aW9uKS50b0JlKFxuICAgICAgICAnU2VjdXJlIEFXUyBlbnZpcm9ubWVudCB3aXRoIFZQQywgQUxCLCBBU0csIGFuZCBFQzIgaW5zdGFuY2VzIHJ1bm5pbmcgTmdpbngnXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGFyYW1ldGVycycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBhbGwgcmVxdWlyZWQgcGFyYW1ldGVycycsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5QYXJhbWV0ZXJzLkluc3RhbmNlVHlwZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5QYXJhbWV0ZXJzLktleVBhaXJOYW1lKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnSW5zdGFuY2VUeXBlIHBhcmFtZXRlciBzaG91bGQgaGF2ZSBjb3JyZWN0IHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnN0YW5jZVR5cGVQYXJhbSA9IHRlbXBsYXRlLlBhcmFtZXRlcnMuSW5zdGFuY2VUeXBlO1xuICAgICAgZXhwZWN0KGluc3RhbmNlVHlwZVBhcmFtLlR5cGUpLnRvQmUoJ1N0cmluZycpO1xuICAgICAgZXhwZWN0KGluc3RhbmNlVHlwZVBhcmFtLkRlZmF1bHQpLnRvQmUoJ3QzLm1pY3JvJyk7XG4gICAgICBleHBlY3QoaW5zdGFuY2VUeXBlUGFyYW0uRGVzY3JpcHRpb24pLnRvQmUoJ0VDMiBpbnN0YW5jZSB0eXBlIGZvciB0aGUgQXV0byBTY2FsaW5nIEdyb3VwJyk7XG4gICAgICBleHBlY3QoaW5zdGFuY2VUeXBlUGFyYW0uQWxsb3dlZFZhbHVlcykudG9FcXVhbChbJ3QzLm1pY3JvJywgJ3QzLnNtYWxsJywgJ3QzLm1lZGl1bSddKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ0tleVBhaXJOYW1lIHBhcmFtZXRlciBzaG91bGQgaGF2ZSBjb3JyZWN0IHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBrZXlQYWlyUGFyYW0gPSB0ZW1wbGF0ZS5QYXJhbWV0ZXJzLktleVBhaXJOYW1lO1xuICAgICAgZXhwZWN0KGtleVBhaXJQYXJhbS5UeXBlKS50b0JlKCdTdHJpbmcnKTtcbiAgICAgIGV4cGVjdChrZXlQYWlyUGFyYW0uRGVmYXVsdCkudG9CZSgnJyk7XG4gICAgICBleHBlY3Qoa2V5UGFpclBhcmFtLkRlc2NyaXB0aW9uKS50b0JlKCdOYW1lIG9mIGFuIGV4aXN0aW5nIEVDMiBLZXlQYWlyIHRvIGVuYWJsZSBTU0ggYWNjZXNzIChsZWF2ZSBlbXB0eSB0byBza2lwKScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29uZGl0aW9ucycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBIYXNLZXlQYWlyIGNvbmRpdGlvbicsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5Db25kaXRpb25zLkhhc0tleVBhaXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuQ29uZGl0aW9ucy5IYXNLZXlQYWlyKS50b0VxdWFsKHtcbiAgICAgICAgJ0ZuOjpOb3QnOiBbeyAnRm46OkVxdWFscyc6IFt7ICdSZWYnOiAnS2V5UGFpck5hbWUnIH0sICcnXSB9XVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdWUEMgUmVzb3VyY2VzJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIFZQQyByZXNvdXJjZScsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuVlBDKS50b0JlRGVmaW5lZCgpO1xuICAgICAgY29uc3QgdnBjID0gdGVtcGxhdGUuUmVzb3VyY2VzLlZQQztcbiAgICAgIGV4cGVjdCh2cGMuVHlwZSkudG9CZSgnQVdTOjpFQzI6OlZQQycpO1xuICAgICAgZXhwZWN0KHZwYy5Qcm9wZXJ0aWVzLkNpZHJCbG9jaykudG9CZSgnMTAuMC4wLjAvMTYnKTtcbiAgICAgIGV4cGVjdCh2cGMuUHJvcGVydGllcy5FbmFibGVEbnNIb3N0bmFtZXMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodnBjLlByb3BlcnRpZXMuRW5hYmxlRG5zU3VwcG9ydCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIEludGVybmV0IEdhdGV3YXknLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLkludGVybmV0R2F0ZXdheSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuSW50ZXJuZXRHYXRld2F5LlR5cGUpLnRvQmUoJ0FXUzo6RUMyOjpJbnRlcm5ldEdhdGV3YXknKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuSW50ZXJuZXRHYXRld2F5QXR0YWNobWVudCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIE5BVCBHYXRld2F5IGFuZCBFSVAnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLk5hdEdhdGV3YXkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLk5hdEdhdGV3YXkuVHlwZSkudG9CZSgnQVdTOjpFQzI6Ok5hdEdhdGV3YXknKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuTmF0R2F0ZXdheUVJUCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuTmF0R2F0ZXdheUVJUC5UeXBlKS50b0JlKCdBV1M6OkVDMjo6RUlQJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTdWJuZXQgUmVzb3VyY2VzJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGV4YWN0bHkgMiBwdWJsaWMgc3VibmV0cycsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHVibGljU3VibmV0MSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHVibGljU3VibmV0MikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHVibGljU3VibmV0MS5Qcm9wZXJ0aWVzLkNpZHJCbG9jaykudG9CZSgnMTAuMC4xLjAvMjQnKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHVibGljU3VibmV0Mi5Qcm9wZXJ0aWVzLkNpZHJCbG9jaykudG9CZSgnMTAuMC4yLjAvMjQnKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHVibGljU3VibmV0MS5Qcm9wZXJ0aWVzLk1hcFB1YmxpY0lwT25MYXVuY2gpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlB1YmxpY1N1Ym5ldDIuUHJvcGVydGllcy5NYXBQdWJsaWNJcE9uTGF1bmNoKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgZXhhY3RseSAyIHByaXZhdGUgc3VibmV0cycsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHJpdmF0ZVN1Ym5ldDEpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlByaXZhdGVTdWJuZXQyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5Qcml2YXRlU3VibmV0MS5Qcm9wZXJ0aWVzLkNpZHJCbG9jaykudG9CZSgnMTAuMC4xMS4wLzI0Jyk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlByaXZhdGVTdWJuZXQyLlByb3BlcnRpZXMuQ2lkckJsb2NrKS50b0JlKCcxMC4wLjEyLjAvMjQnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3N1Ym5ldHMgc2hvdWxkIGJlIGluIGRpZmZlcmVudCBhdmFpbGFiaWxpdHkgem9uZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwdWJsaWNTdWJuZXQxQVogPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuUHVibGljU3VibmV0MS5Qcm9wZXJ0aWVzLkF2YWlsYWJpbGl0eVpvbmU7XG4gICAgICBjb25zdCBwdWJsaWNTdWJuZXQyQVogPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuUHVibGljU3VibmV0Mi5Qcm9wZXJ0aWVzLkF2YWlsYWJpbGl0eVpvbmU7XG4gICAgICBleHBlY3QocHVibGljU3VibmV0MUFaKS50b0VxdWFsKHsgJ0ZuOjpTZWxlY3QnOiBbMCwgeyAnRm46OkdldEFacyc6ICcnIH1dIH0pO1xuICAgICAgZXhwZWN0KHB1YmxpY1N1Ym5ldDJBWikudG9FcXVhbCh7ICdGbjo6U2VsZWN0JzogWzEsIHsgJ0ZuOjpHZXRBWnMnOiAnJyB9XSB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1JvdXRlIFRhYmxlcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBwdWJsaWMgYW5kIHByaXZhdGUgcm91dGUgdGFibGVzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5QdWJsaWNSb3V0ZVRhYmxlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5Qcml2YXRlUm91dGVUYWJsZSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3B1YmxpYyByb3V0ZSB0YWJsZSBzaG91bGQgcm91dGUgdG8gSW50ZXJuZXQgR2F0ZXdheScsICgpID0+IHtcbiAgICAgIGNvbnN0IHB1YmxpY1JvdXRlID0gdGVtcGxhdGUuUmVzb3VyY2VzLkRlZmF1bHRQdWJsaWNSb3V0ZTtcbiAgICAgIGV4cGVjdChwdWJsaWNSb3V0ZS5Qcm9wZXJ0aWVzLkRlc3RpbmF0aW9uQ2lkckJsb2NrKS50b0JlKCcwLjAuMC4wLzAnKTtcbiAgICAgIGV4cGVjdChwdWJsaWNSb3V0ZS5Qcm9wZXJ0aWVzLkdhdGV3YXlJZCkudG9FcXVhbCh7ICdSZWYnOiAnSW50ZXJuZXRHYXRld2F5JyB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3ByaXZhdGUgcm91dGUgdGFibGUgc2hvdWxkIHJvdXRlIHRvIE5BVCBHYXRld2F5JywgKCkgPT4ge1xuICAgICAgY29uc3QgcHJpdmF0ZVJvdXRlID0gdGVtcGxhdGUuUmVzb3VyY2VzLkRlZmF1bHRQcml2YXRlUm91dGU7XG4gICAgICBleHBlY3QocHJpdmF0ZVJvdXRlLlByb3BlcnRpZXMuRGVzdGluYXRpb25DaWRyQmxvY2spLnRvQmUoJzAuMC4wLjAvMCcpO1xuICAgICAgZXhwZWN0KHByaXZhdGVSb3V0ZS5Qcm9wZXJ0aWVzLk5hdEdhdGV3YXlJZCkudG9FcXVhbCh7ICdSZWYnOiAnTmF0R2F0ZXdheScgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IHJvdXRlIHRhYmxlIGFzc29jaWF0aW9ucycsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHVibGljU3VibmV0MVJvdXRlVGFibGVBc3NvY2lhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHVibGljU3VibmV0MlJvdXRlVGFibGVBc3NvY2lhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHJpdmF0ZVN1Ym5ldDFSb3V0ZVRhYmxlQXNzb2NpYXRpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlByaXZhdGVTdWJuZXQyUm91dGVUYWJsZUFzc29jaWF0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2VjdXJpdHkgR3JvdXBzJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIEFMQiBzZWN1cml0eSBncm91cCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGFsYlNHID0gdGVtcGxhdGUuUmVzb3VyY2VzLkFMQlNlY3VyaXR5R3JvdXA7XG4gICAgICBleHBlY3QoYWxiU0cpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoYWxiU0cuVHlwZSkudG9CZSgnQVdTOjpFQzI6OlNlY3VyaXR5R3JvdXAnKTtcblxuICAgICAgY29uc3QgaW5ncmVzc1J1bGVzID0gYWxiU0cuUHJvcGVydGllcy5TZWN1cml0eUdyb3VwSW5ncmVzcztcbiAgICAgIGV4cGVjdChpbmdyZXNzUnVsZXMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChpbmdyZXNzUnVsZXNbMF0uRnJvbVBvcnQpLnRvQmUoODApO1xuICAgICAgZXhwZWN0KGluZ3Jlc3NSdWxlc1sxXS5Gcm9tUG9ydCkudG9CZSg0NDMpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgV2ViIFNlcnZlciBzZWN1cml0eSBncm91cCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHdlYlNHID0gdGVtcGxhdGUuUmVzb3VyY2VzLldlYlNlcnZlclNlY3VyaXR5R3JvdXA7XG4gICAgICBleHBlY3Qod2ViU0cpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3Qod2ViU0cuVHlwZSkudG9CZSgnQVdTOjpFQzI6OlNlY3VyaXR5R3JvdXAnKTtcblxuICAgICAgY29uc3QgaW5ncmVzc1J1bGVzID0gd2ViU0cuUHJvcGVydGllcy5TZWN1cml0eUdyb3VwSW5ncmVzcztcbiAgICAgIGV4cGVjdChpbmdyZXNzUnVsZXMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChpbmdyZXNzUnVsZXNbMF0uRnJvbVBvcnQpLnRvQmUoODApO1xuICAgICAgZXhwZWN0KGluZ3Jlc3NSdWxlc1swXS5Tb3VyY2VTZWN1cml0eUdyb3VwSWQpLnRvRXF1YWwoeyAnUmVmJzogJ0FMQlNlY3VyaXR5R3JvdXAnIH0pO1xuICAgICAgZXhwZWN0KGluZ3Jlc3NSdWxlc1sxXS5Gcm9tUG9ydCkudG9CZSgyMik7XG4gICAgICBleHBlY3QoaW5ncmVzc1J1bGVzWzFdLkNpZHJJcCkudG9CZSgnMTAuMC4wLjAvMTYnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FwcGxpY2F0aW9uIExvYWQgQmFsYW5jZXInLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgQUxCIHJlc291cmNlJywgKCkgPT4ge1xuICAgICAgY29uc3QgYWxiID0gdGVtcGxhdGUuUmVzb3VyY2VzLkFwcGxpY2F0aW9uTG9hZEJhbGFuY2VyO1xuICAgICAgZXhwZWN0KGFsYikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChhbGIuVHlwZSkudG9CZSgnQVdTOjpFbGFzdGljTG9hZEJhbGFuY2luZ1YyOjpMb2FkQmFsYW5jZXInKTtcbiAgICAgIGV4cGVjdChhbGIuUHJvcGVydGllcy5TY2hlbWUpLnRvQmUoJ2ludGVybmV0LWZhY2luZycpO1xuICAgICAgZXhwZWN0KGFsYi5Qcm9wZXJ0aWVzLlR5cGUpLnRvQmUoJ2FwcGxpY2F0aW9uJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSB0YXJnZXQgZ3JvdXAgd2l0aCBoZWFsdGggY2hlY2tzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGFyZ2V0R3JvdXAgPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuQUxCVGFyZ2V0R3JvdXA7XG4gICAgICBleHBlY3QodGFyZ2V0R3JvdXApLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGFyZ2V0R3JvdXAuVHlwZSkudG9CZSgnQVdTOjpFbGFzdGljTG9hZEJhbGFuY2luZ1YyOjpUYXJnZXRHcm91cCcpO1xuICAgICAgZXhwZWN0KHRhcmdldEdyb3VwLlByb3BlcnRpZXMuUG9ydCkudG9CZSg4MCk7XG4gICAgICBleHBlY3QodGFyZ2V0R3JvdXAuUHJvcGVydGllcy5Qcm90b2NvbCkudG9CZSgnSFRUUCcpO1xuICAgICAgZXhwZWN0KHRhcmdldEdyb3VwLlByb3BlcnRpZXMuSGVhbHRoQ2hlY2tQYXRoKS50b0JlKCcvJyk7XG4gICAgICBleHBlY3QodGFyZ2V0R3JvdXAuUHJvcGVydGllcy5IZWFsdGhDaGVja0ludGVydmFsU2Vjb25kcykudG9CZSgzMCk7XG4gICAgICBleHBlY3QodGFyZ2V0R3JvdXAuUHJvcGVydGllcy5IZWFsdGh5VGhyZXNob2xkQ291bnQpLnRvQmUoMik7XG4gICAgICBleHBlY3QodGFyZ2V0R3JvdXAuUHJvcGVydGllcy5VbmhlYWx0aHlUaHJlc2hvbGRDb3VudCkudG9CZSgzKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIEFMQiBsaXN0ZW5lcicsICgpID0+IHtcbiAgICAgIGNvbnN0IGxpc3RlbmVyID0gdGVtcGxhdGUuUmVzb3VyY2VzLkFMQkxpc3RlbmVyO1xuICAgICAgZXhwZWN0KGxpc3RlbmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGxpc3RlbmVyLlR5cGUpLnRvQmUoJ0FXUzo6RWxhc3RpY0xvYWRCYWxhbmNpbmdWMjo6TGlzdGVuZXInKTtcbiAgICAgIGV4cGVjdChsaXN0ZW5lci5Qcm9wZXJ0aWVzLlBvcnQpLnRvQmUoODApO1xuICAgICAgZXhwZWN0KGxpc3RlbmVyLlByb3BlcnRpZXMuUHJvdG9jb2wpLnRvQmUoJ0hUVFAnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0F1dG8gU2NhbGluZyBSZXNvdXJjZXMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgbGF1bmNoIHRlbXBsYXRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgbGF1bmNoVGVtcGxhdGUgPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuTGF1bmNoVGVtcGxhdGU7XG4gICAgICBleHBlY3QobGF1bmNoVGVtcGxhdGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobGF1bmNoVGVtcGxhdGUuVHlwZSkudG9CZSgnQVdTOjpFQzI6OkxhdW5jaFRlbXBsYXRlJyk7XG5cbiAgICAgIGNvbnN0IGRhdGEgPSBsYXVuY2hUZW1wbGF0ZS5Qcm9wZXJ0aWVzLkxhdW5jaFRlbXBsYXRlRGF0YTtcbiAgICAgIGV4cGVjdChkYXRhLkluc3RhbmNlVHlwZSkudG9FcXVhbCh7ICdSZWYnOiAnSW5zdGFuY2VUeXBlJyB9KTtcbiAgICAgIGV4cGVjdChkYXRhLlVzZXJEYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnbGF1bmNoIHRlbXBsYXRlIHNob3VsZCBjb25kaXRpb25hbGx5IHNldCBLZXlOYW1lJywgKCkgPT4ge1xuICAgICAgY29uc3QgbGF1bmNoVGVtcGxhdGUgPSB0ZW1wbGF0ZS5SZXNvdXJjZXMuTGF1bmNoVGVtcGxhdGU7XG4gICAgICBjb25zdCBrZXlOYW1lID0gbGF1bmNoVGVtcGxhdGUuUHJvcGVydGllcy5MYXVuY2hUZW1wbGF0ZURhdGEuS2V5TmFtZTtcbiAgICAgIGV4cGVjdChrZXlOYW1lKS50b0VxdWFsKHtcbiAgICAgICAgJ0ZuOjpJZic6IFsnSGFzS2V5UGFpcicsIHsgJ1JlZic6ICdLZXlQYWlyTmFtZScgfSwgeyAnUmVmJzogJ0FXUzo6Tm9WYWx1ZScgfV1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgYXV0byBzY2FsaW5nIGdyb3VwJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXNnID0gdGVtcGxhdGUuUmVzb3VyY2VzLkF1dG9TY2FsaW5nR3JvdXA7XG4gICAgICBleHBlY3QoYXNnKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGFzZy5UeXBlKS50b0JlKCdBV1M6OkF1dG9TY2FsaW5nOjpBdXRvU2NhbGluZ0dyb3VwJyk7XG4gICAgICBleHBlY3QoYXNnLlByb3BlcnRpZXMuTWluU2l6ZSkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChhc2cuUHJvcGVydGllcy5NYXhTaXplKS50b0JlKDQpO1xuICAgICAgZXhwZWN0KGFzZy5Qcm9wZXJ0aWVzLkRlc2lyZWRDYXBhY2l0eSkudG9CZSgyKTtcbiAgICAgIGV4cGVjdChhc2cuUHJvcGVydGllcy5IZWFsdGhDaGVja1R5cGUpLnRvQmUoJ0VMQicpO1xuICAgICAgZXhwZWN0KGFzZy5Qcm9wZXJ0aWVzLkhlYWx0aENoZWNrR3JhY2VQZXJpb2QpLnRvQmUoMzAwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ0FTRyBzaG91bGQgYmUgaW4gcHJpdmF0ZSBzdWJuZXRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXNnID0gdGVtcGxhdGUuUmVzb3VyY2VzLkF1dG9TY2FsaW5nR3JvdXA7XG4gICAgICBjb25zdCBzdWJuZXRzID0gYXNnLlByb3BlcnRpZXMuVlBDWm9uZUlkZW50aWZpZXI7XG4gICAgICBleHBlY3Qoc3VibmV0cykudG9FcXVhbChbXG4gICAgICAgIHsgJ1JlZic6ICdQcml2YXRlU3VibmV0MScgfSxcbiAgICAgICAgeyAnUmVmJzogJ1ByaXZhdGVTdWJuZXQyJyB9XG4gICAgICBdKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ091dHB1dHMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgYWxsIHJlcXVpcmVkIG91dHB1dHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBleHBlY3RlZE91dHB1dHMgPSBbXG4gICAgICAgICdWUENJZCcsXG4gICAgICAgICdQdWJsaWNTdWJuZXQxSWQnLFxuICAgICAgICAnUHVibGljU3VibmV0MklkJyxcbiAgICAgICAgJ1ByaXZhdGVTdWJuZXQxSWQnLFxuICAgICAgICAnUHJpdmF0ZVN1Ym5ldDJJZCcsXG4gICAgICAgICdBTEJTZWN1cml0eUdyb3VwSWQnLFxuICAgICAgICAnV2ViU2VydmVyU2VjdXJpdHlHcm91cElkJyxcbiAgICAgICAgJ0FwcGxpY2F0aW9uTG9hZEJhbGFuY2VyRE5TJyxcbiAgICAgICAgJ0FwcGxpY2F0aW9uTG9hZEJhbGFuY2VyVVJMJ1xuICAgICAgXTtcblxuICAgICAgZXhwZWN0ZWRPdXRwdXRzLmZvckVhY2gob3V0cHV0TmFtZSA9PiB7XG4gICAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5PdXRwdXRzW291dHB1dE5hbWVdKS50b0JlRGVmaW5lZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IEFMQiBETlMgb3V0cHV0JywgKCkgPT4ge1xuICAgICAgY29uc3QgYWxiRG5zT3V0cHV0ID0gdGVtcGxhdGUuT3V0cHV0cy5BcHBsaWNhdGlvbkxvYWRCYWxhbmNlckROUztcbiAgICAgIGV4cGVjdChhbGJEbnNPdXRwdXQuRGVzY3JpcHRpb24pLnRvQmUoJ0FwcGxpY2F0aW9uIExvYWQgQmFsYW5jZXIgRE5TIE5hbWUnKTtcbiAgICAgIGV4cGVjdChhbGJEbnNPdXRwdXQuVmFsdWUpLnRvRXF1YWwoe1xuICAgICAgICAnRm46OkdldEF0dCc6IFsnQXBwbGljYXRpb25Mb2FkQmFsYW5jZXInLCAnRE5TTmFtZSddXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGNvcnJlY3QgQUxCIFVSTCBvdXRwdXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhbGJVcmxPdXRwdXQgPSB0ZW1wbGF0ZS5PdXRwdXRzLkFwcGxpY2F0aW9uTG9hZEJhbGFuY2VyVVJMO1xuICAgICAgZXhwZWN0KGFsYlVybE91dHB1dC5EZXNjcmlwdGlvbikudG9CZSgnQXBwbGljYXRpb24gTG9hZCBCYWxhbmNlciBVUkwnKTtcbiAgICAgIGV4cGVjdChhbGJVcmxPdXRwdXQuVmFsdWUpLnRvRXF1YWwoe1xuICAgICAgICAnRm46OlN1Yic6ICdodHRwOi8vJHtBcHBsaWNhdGlvbkxvYWRCYWxhbmNlci5ETlNOYW1lfSdcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVzb3VyY2UgVGFncycsICgpID0+IHtcbiAgICB0ZXN0KCdhbGwgdGFnZ2FibGUgcmVzb3VyY2VzIHNob3VsZCBoYXZlIEVudmlyb25tZW50IHRhZycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRhZ2dhYmxlUmVzb3VyY2VzID0gW1xuICAgICAgICAnVlBDJyxcbiAgICAgICAgJ0ludGVybmV0R2F0ZXdheScsXG4gICAgICAgICdQdWJsaWNTdWJuZXQxJyxcbiAgICAgICAgJ1B1YmxpY1N1Ym5ldDInLFxuICAgICAgICAnUHJpdmF0ZVN1Ym5ldDEnLFxuICAgICAgICAnUHJpdmF0ZVN1Ym5ldDInLFxuICAgICAgICAnTmF0R2F0ZXdheScsXG4gICAgICAgICdOYXRHYXRld2F5RUlQJyxcbiAgICAgICAgJ1B1YmxpY1JvdXRlVGFibGUnLFxuICAgICAgICAnUHJpdmF0ZVJvdXRlVGFibGUnLFxuICAgICAgICAnQUxCU2VjdXJpdHlHcm91cCcsXG4gICAgICAgICdXZWJTZXJ2ZXJTZWN1cml0eUdyb3VwJyxcbiAgICAgICAgJ0FwcGxpY2F0aW9uTG9hZEJhbGFuY2VyJyxcbiAgICAgICAgJ0FMQlRhcmdldEdyb3VwJ1xuICAgICAgXTtcblxuICAgICAgdGFnZ2FibGVSZXNvdXJjZXMuZm9yRWFjaChyZXNvdXJjZU5hbWUgPT4ge1xuICAgICAgICBjb25zdCByZXNvdXJjZSA9IHRlbXBsYXRlLlJlc291cmNlc1tyZXNvdXJjZU5hbWVdO1xuICAgICAgICBjb25zdCB0YWdzID0gcmVzb3VyY2UuUHJvcGVydGllcy5UYWdzO1xuICAgICAgICBjb25zdCBlbnZUYWcgPSB0YWdzLmZpbmQoKHRhZzogYW55KSA9PiB0YWcuS2V5ID09PSAnRW52aXJvbm1lbnQnKTtcbiAgICAgICAgZXhwZWN0KGVudlRhZykudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KGVudlRhZy5WYWx1ZSkudG9CZSgnRGV2ZWxvcG1lbnQnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVGVtcGxhdGUgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSB2YWxpZCBKU09OIHN0cnVjdHVyZScsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgdGVtcGxhdGUpLnRvQmUoJ29iamVjdCcpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIG5vdCBoYXZlIGFueSB1bmRlZmluZWQgb3IgbnVsbCByZXF1aXJlZCBzZWN0aW9ucycsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5BV1NUZW1wbGF0ZUZvcm1hdFZlcnNpb24pLm5vdC50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLkRlc2NyaXB0aW9uKS5ub3QudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5QYXJhbWV0ZXJzKS5ub3QudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMpLm5vdC50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLk91dHB1dHMpLm5vdC50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBudW1iZXIgb2YgcmVzb3VyY2VzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXhwZWN0ZWRSZXNvdXJjZUNvdW50ID0gMjQ7IC8vIENvdW50IGFsbCByZXNvdXJjZXMgaW4gdGVtcGxhdGVcbiAgICAgIGNvbnN0IGFjdHVhbFJlc291cmNlQ291bnQgPSBPYmplY3Qua2V5cyh0ZW1wbGF0ZS5SZXNvdXJjZXMpLmxlbmd0aDtcbiAgICAgIGV4cGVjdChhY3R1YWxSZXNvdXJjZUNvdW50KS50b0JlKGV4cGVjdGVkUmVzb3VyY2VDb3VudCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IG51bWJlciBvZiBwYXJhbWV0ZXJzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGFyYW1ldGVyQ291bnQgPSBPYmplY3Qua2V5cyh0ZW1wbGF0ZS5QYXJhbWV0ZXJzKS5sZW5ndGg7XG4gICAgICBleHBlY3QocGFyYW1ldGVyQ291bnQpLnRvQmUoMik7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IG51bWJlciBvZiBvdXRwdXRzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb3V0cHV0Q291bnQgPSBPYmplY3Qua2V5cyh0ZW1wbGF0ZS5PdXRwdXRzKS5sZW5ndGg7XG4gICAgICBleHBlY3Qob3V0cHV0Q291bnQpLnRvQmUoOSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il19