{
  "task_id": "v1b0b1e4",
  "platform": "pulumi",
  "language": "ts",
  "complexity": "expert",
  "turn_type": "single",
  "po_id": "PO-SEC-001",
  "team": "synth",
  "startedAt": "2025-01-25T00:00:00Z",
  "subtask": "Security, Compliance, and Governance",
  "subject_labels": [
    "Security Configuration as Code",
    "Multi-Region Compliance",
    "Automated Scanning"
  ],
  "iteration_type": "enhancement",
  "previous_status": "error",
  "previous_training_quality": "5/10",
  "previous_issue": "Model Already Too Good - 95% correct with only 2 trivial fixes",
  "enhancement_goal": "Increase training quality from 5/10 to ≥8/10 by adding significant features",
  "problem": "Create a Pulumi TypeScript program to build an automated infrastructure compliance scanner. The configuration must: 1. Deploy a Lambda function that uses AWS Config and APIs to scan resources across three regions (us-east-1, eu-west-1, ap-southeast-1). 2. Create a DynamoDB table to track scan history with partition key 'scanId' and sort key 'timestamp'. 3. Set up an S3 bucket with versioning enabled to store detailed compliance reports in JSON format. 4. Configure EventBridge rules to trigger scans daily at 2 AM UTC and on-demand via custom events. 5. Implement a second Lambda function to analyze scan results and identify critical violations (unencrypted S3 buckets, public RDS instances, overly permissive security groups). 6. Create SNS topics for alerting on critical findings with email subscriptions for the security team. 7. Generate CloudWatch dashboards showing compliance trends, resource coverage, and violation counts by service. 8. Export scan results to CloudWatch Logs Insights-compatible format for advanced querying. 9. Implement automated remediation suggestions in scan reports based on AWS best practices. 10. Create Lambda layers for shared analysis logic and AWS SDK optimizations. 11. Set up CloudWatch alarms for scanner failures and performance degradation. 12. Tag all resources with mandatory compliance tags and cost allocation tags. Expected output: A Pulumi TypeScript program that deploys a complete infrastructure analysis system capable of scanning multi-region AWS resources, identifying compliance violations, storing historical data, and providing actionable insights through dashboards and reports. The system should run automated daily scans and support on-demand analysis requests.",
  "background": "A financial services company has discovered configuration drift and compliance violations across their multi-region AWS infrastructure. They need an automated analysis tool that can scan their existing resources, identify security misconfigurations, and generate actionable reports for their DevOps team to remediate issues before their upcoming SOC2 audit.",
  "environment": "Multi-region AWS infrastructure analysis environment spanning us-east-1, eu-west-1, and ap-southeast-1. Requires Pulumi 3.x with TypeScript, Node.js 18+, and AWS CLI configured with appropriate credentials. The infrastructure includes existing VPCs, EC2 instances, RDS databases, S3 buckets, and Lambda functions across all regions that need compliance scanning. Analysis results are centralized in us-east-1 with cross-region data aggregation. DynamoDB global tables for storing scan metadata and S3 bucket with lifecycle policies for report archival.",
  "constraints": [
    "Must use Pulumi's stack references to analyze resources across multiple existing stacks",
    "Analysis results must be stored in S3 with server-side encryption using KMS",
    "Lambda functions must have X-Ray tracing enabled for performance monitoring",
    "All IAM roles must follow least-privilege principles with no wildcard actions",
    "DynamoDB tables must use on-demand billing mode to control costs",
    "CloudWatch Logs retention must be set to exactly 30 days for compliance",
    "Must implement error handling with custom CloudWatch metrics for failed scans",
    "Resource tags must include 'Environment', 'Owner', and 'CostCenter' on all resources",
    "Analysis Lambda must complete execution within 5 minutes timeout limit"
  ],
  "enhancement_features": {
    "category_a_significant": [
      {
        "name": "AWS Systems Manager (SSM) Integration",
        "description": "Store scanner configuration in Parameter Store, use secrets for sensitive compliance thresholds, add SSM automation documents for remediation",
        "training_value": "High - teaches advanced configuration management and automated remediation patterns"
      },
      {
        "name": "Step Functions Orchestration",
        "description": "Replace simple EventBridge → Lambda with Step Functions workflow, add retry logic, parallel scanning, error handling, visual workflow for compliance scanning process",
        "training_value": "High - demonstrates complex workflow orchestration and error handling patterns"
      },
      {
        "name": "AWS Security Hub Integration",
        "description": "Send compliance findings to Security Hub, map violations to security standards (CIS, PCI-DSS), centralized security posture management",
        "training_value": "High - shows enterprise security integration and compliance mapping"
      },
      {
        "name": "S3 Lifecycle and Intelligent Tiering",
        "description": "Add sophisticated S3 lifecycle policies, implement Intelligent-Tiering for cost optimization, add S3 Access Logging",
        "training_value": "Medium - demonstrates cost optimization and data lifecycle management"
      }
    ]
  },
  "aws_services": [
    "Lambda",
    "DynamoDB",
    "S3",
    "EventBridge",
    "SNS",
    "CloudWatch",
    "IAM",
    "KMS",
    "Systems Manager",
    "Step Functions",
    "Security Hub",
    "X-Ray"
  ],
  "core_services": [
    "Lambda",
    "DynamoDB",
    "S3",
    "EventBridge",
    "SNS",
    "CloudWatch",
    "IAM",
    "KMS"
  ],
  "enhancement_services": [
    "AWS Systems Manager Parameter Store",
    "AWS Systems Manager Automation",
    "AWS Step Functions",
    "AWS Security Hub"
  ],
  "regions": [
    "us-east-1",
    "eu-west-1",
    "ap-southeast-1"
  ],
  "tags": {
    "mandatory": [
      "Environment",
      "Owner",
      "CostCenter",
      "Compliance"
    ]
  },
  "training_quality": 9
}
