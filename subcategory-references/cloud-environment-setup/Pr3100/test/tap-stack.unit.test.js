"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
const environmentSuffix = process.env.ENVIRONMENT_SUFFIX || 'dev';
describe('Startup Infrastructure CloudFormation Template', () => {
    let template;
    beforeAll(() => {
        // Run `pipenv run cfn-flip lib/TapStack.yml > lib/TapStack.json` to convert YAML to JSON
        const templatePath = path_1.default.join(__dirname, '../lib/TapStack.json');
        const templateContent = fs_1.default.readFileSync(templatePath, 'utf8');
        template = JSON.parse(templateContent);
    });
    describe('Template Structure', () => {
        test('should have valid CloudFormation format version', () => {
            expect(template.AWSTemplateFormatVersion).toBe('2010-09-09');
        });
        test('should have a description', () => {
            expect(template.Description).toBeDefined();
            expect(template.Description).toBe('Secure AWS environment with VPC, ALB, ASG, and EC2 instances running Nginx');
        });
    });
    describe('Parameters', () => {
        test('should have all required parameters', () => {
            expect(template.Parameters.InstanceType).toBeDefined();
            expect(template.Parameters.KeyPairName).toBeDefined();
        });
        test('InstanceType parameter should have correct properties', () => {
            const instanceTypeParam = template.Parameters.InstanceType;
            expect(instanceTypeParam.Type).toBe('String');
            expect(instanceTypeParam.Default).toBe('t3.micro');
            expect(instanceTypeParam.Description).toBe('EC2 instance type for the Auto Scaling Group');
            expect(instanceTypeParam.AllowedValues).toEqual(['t3.micro', 't3.small', 't3.medium']);
        });
        test('KeyPairName parameter should have correct properties', () => {
            const keyPairParam = template.Parameters.KeyPairName;
            expect(keyPairParam.Type).toBe('String');
            expect(keyPairParam.Default).toBe('');
            expect(keyPairParam.Description).toBe('Name of an existing EC2 KeyPair to enable SSH access (leave empty to skip)');
        });
    });
    describe('Conditions', () => {
        test('should have HasKeyPair condition', () => {
            expect(template.Conditions.HasKeyPair).toBeDefined();
            expect(template.Conditions.HasKeyPair).toEqual({
                'Fn::Not': [{ 'Fn::Equals': [{ 'Ref': 'KeyPairName' }, ''] }]
            });
        });
    });
    describe('VPC Resources', () => {
        test('should have VPC resource', () => {
            expect(template.Resources.VPC).toBeDefined();
            const vpc = template.Resources.VPC;
            expect(vpc.Type).toBe('AWS::EC2::VPC');
            expect(vpc.Properties.CidrBlock).toBe('10.0.0.0/16');
            expect(vpc.Properties.EnableDnsHostnames).toBe(true);
            expect(vpc.Properties.EnableDnsSupport).toBe(true);
        });
        test('should have Internet Gateway', () => {
            expect(template.Resources.InternetGateway).toBeDefined();
            expect(template.Resources.InternetGateway.Type).toBe('AWS::EC2::InternetGateway');
            expect(template.Resources.InternetGatewayAttachment).toBeDefined();
        });
        test('should have NAT Gateway and EIP', () => {
            expect(template.Resources.NatGateway).toBeDefined();
            expect(template.Resources.NatGateway.Type).toBe('AWS::EC2::NatGateway');
            expect(template.Resources.NatGatewayEIP).toBeDefined();
            expect(template.Resources.NatGatewayEIP.Type).toBe('AWS::EC2::EIP');
        });
    });
    describe('Subnet Resources', () => {
        test('should have exactly 2 public subnets', () => {
            expect(template.Resources.PublicSubnet1).toBeDefined();
            expect(template.Resources.PublicSubnet2).toBeDefined();
            expect(template.Resources.PublicSubnet1.Properties.CidrBlock).toBe('10.0.1.0/24');
            expect(template.Resources.PublicSubnet2.Properties.CidrBlock).toBe('10.0.2.0/24');
            expect(template.Resources.PublicSubnet1.Properties.MapPublicIpOnLaunch).toBe(true);
            expect(template.Resources.PublicSubnet2.Properties.MapPublicIpOnLaunch).toBe(true);
        });
        test('should have exactly 2 private subnets', () => {
            expect(template.Resources.PrivateSubnet1).toBeDefined();
            expect(template.Resources.PrivateSubnet2).toBeDefined();
            expect(template.Resources.PrivateSubnet1.Properties.CidrBlock).toBe('10.0.11.0/24');
            expect(template.Resources.PrivateSubnet2.Properties.CidrBlock).toBe('10.0.12.0/24');
        });
        test('subnets should be in different availability zones', () => {
            const publicSubnet1AZ = template.Resources.PublicSubnet1.Properties.AvailabilityZone;
            const publicSubnet2AZ = template.Resources.PublicSubnet2.Properties.AvailabilityZone;
            expect(publicSubnet1AZ).toEqual({ 'Fn::Select': [0, { 'Fn::GetAZs': '' }] });
            expect(publicSubnet2AZ).toEqual({ 'Fn::Select': [1, { 'Fn::GetAZs': '' }] });
        });
    });
    describe('Route Tables', () => {
        test('should have public and private route tables', () => {
            expect(template.Resources.PublicRouteTable).toBeDefined();
            expect(template.Resources.PrivateRouteTable).toBeDefined();
        });
        test('public route table should route to Internet Gateway', () => {
            const publicRoute = template.Resources.DefaultPublicRoute;
            expect(publicRoute.Properties.DestinationCidrBlock).toBe('0.0.0.0/0');
            expect(publicRoute.Properties.GatewayId).toEqual({ 'Ref': 'InternetGateway' });
        });
        test('private route table should route to NAT Gateway', () => {
            const privateRoute = template.Resources.DefaultPrivateRoute;
            expect(privateRoute.Properties.DestinationCidrBlock).toBe('0.0.0.0/0');
            expect(privateRoute.Properties.NatGatewayId).toEqual({ 'Ref': 'NatGateway' });
        });
        test('should have correct route table associations', () => {
            expect(template.Resources.PublicSubnet1RouteTableAssociation).toBeDefined();
            expect(template.Resources.PublicSubnet2RouteTableAssociation).toBeDefined();
            expect(template.Resources.PrivateSubnet1RouteTableAssociation).toBeDefined();
            expect(template.Resources.PrivateSubnet2RouteTableAssociation).toBeDefined();
        });
    });
    describe('Security Groups', () => {
        test('should have ALB security group', () => {
            const albSG = template.Resources.ALBSecurityGroup;
            expect(albSG).toBeDefined();
            expect(albSG.Type).toBe('AWS::EC2::SecurityGroup');
            const ingressRules = albSG.Properties.SecurityGroupIngress;
            expect(ingressRules).toHaveLength(2);
            expect(ingressRules[0].FromPort).toBe(80);
            expect(ingressRules[1].FromPort).toBe(443);
        });
        test('should have Web Server security group', () => {
            const webSG = template.Resources.WebServerSecurityGroup;
            expect(webSG).toBeDefined();
            expect(webSG.Type).toBe('AWS::EC2::SecurityGroup');
            const ingressRules = webSG.Properties.SecurityGroupIngress;
            expect(ingressRules).toHaveLength(2);
            expect(ingressRules[0].FromPort).toBe(80);
            expect(ingressRules[0].SourceSecurityGroupId).toEqual({ 'Ref': 'ALBSecurityGroup' });
            expect(ingressRules[1].FromPort).toBe(22);
            expect(ingressRules[1].CidrIp).toBe('10.0.0.0/16');
        });
    });
    describe('Application Load Balancer', () => {
        test('should have ALB resource', () => {
            const alb = template.Resources.ApplicationLoadBalancer;
            expect(alb).toBeDefined();
            expect(alb.Type).toBe('AWS::ElasticLoadBalancingV2::LoadBalancer');
            expect(alb.Properties.Scheme).toBe('internet-facing');
            expect(alb.Properties.Type).toBe('application');
        });
        test('should have target group with health checks', () => {
            const targetGroup = template.Resources.ALBTargetGroup;
            expect(targetGroup).toBeDefined();
            expect(targetGroup.Type).toBe('AWS::ElasticLoadBalancingV2::TargetGroup');
            expect(targetGroup.Properties.Port).toBe(80);
            expect(targetGroup.Properties.Protocol).toBe('HTTP');
            expect(targetGroup.Properties.HealthCheckPath).toBe('/');
            expect(targetGroup.Properties.HealthCheckIntervalSeconds).toBe(30);
            expect(targetGroup.Properties.HealthyThresholdCount).toBe(2);
            expect(targetGroup.Properties.UnhealthyThresholdCount).toBe(3);
        });
        test('should have ALB listener', () => {
            const listener = template.Resources.ALBListener;
            expect(listener).toBeDefined();
            expect(listener.Type).toBe('AWS::ElasticLoadBalancingV2::Listener');
            expect(listener.Properties.Port).toBe(80);
            expect(listener.Properties.Protocol).toBe('HTTP');
        });
    });
    describe('Auto Scaling Resources', () => {
        test('should have launch template', () => {
            const launchTemplate = template.Resources.LaunchTemplate;
            expect(launchTemplate).toBeDefined();
            expect(launchTemplate.Type).toBe('AWS::EC2::LaunchTemplate');
            const data = launchTemplate.Properties.LaunchTemplateData;
            expect(data.InstanceType).toEqual({ 'Ref': 'InstanceType' });
            expect(data.UserData).toBeDefined();
        });
        test('launch template should conditionally set KeyName', () => {
            const launchTemplate = template.Resources.LaunchTemplate;
            const keyName = launchTemplate.Properties.LaunchTemplateData.KeyName;
            expect(keyName).toEqual({
                'Fn::If': ['HasKeyPair', { 'Ref': 'KeyPairName' }, { 'Ref': 'AWS::NoValue' }]
            });
        });
        test('should have auto scaling group', () => {
            const asg = template.Resources.AutoScalingGroup;
            expect(asg).toBeDefined();
            expect(asg.Type).toBe('AWS::AutoScaling::AutoScalingGroup');
            expect(asg.Properties.MinSize).toBe(1);
            expect(asg.Properties.MaxSize).toBe(4);
            expect(asg.Properties.DesiredCapacity).toBe(2);
            expect(asg.Properties.HealthCheckType).toBe('ELB');
            expect(asg.Properties.HealthCheckGracePeriod).toBe(300);
        });
        test('ASG should be in private subnets', () => {
            const asg = template.Resources.AutoScalingGroup;
            const subnets = asg.Properties.VPCZoneIdentifier;
            expect(subnets).toEqual([
                { 'Ref': 'PrivateSubnet1' },
                { 'Ref': 'PrivateSubnet2' }
            ]);
        });
    });
    describe('Outputs', () => {
        test('should have all required outputs', () => {
            const expectedOutputs = [
                'VPCId',
                'PublicSubnet1Id',
                'PublicSubnet2Id',
                'PrivateSubnet1Id',
                'PrivateSubnet2Id',
                'ALBSecurityGroupId',
                'WebServerSecurityGroupId',
                'ApplicationLoadBalancerDNS',
                'ApplicationLoadBalancerURL'
            ];
            expectedOutputs.forEach(outputName => {
                expect(template.Outputs[outputName]).toBeDefined();
            });
        });
        test('should have correct ALB DNS output', () => {
            const albDnsOutput = template.Outputs.ApplicationLoadBalancerDNS;
            expect(albDnsOutput.Description).toBe('Application Load Balancer DNS Name');
            expect(albDnsOutput.Value).toEqual({
                'Fn::GetAtt': ['ApplicationLoadBalancer', 'DNSName']
            });
        });
        test('should have correct ALB URL output', () => {
            const albUrlOutput = template.Outputs.ApplicationLoadBalancerURL;
            expect(albUrlOutput.Description).toBe('Application Load Balancer URL');
            expect(albUrlOutput.Value).toEqual({
                'Fn::Sub': 'http://${ApplicationLoadBalancer.DNSName}'
            });
        });
    });
    describe('Resource Tags', () => {
        test('all taggable resources should have Environment tag', () => {
            const taggableResources = [
                'VPC',
                'InternetGateway',
                'PublicSubnet1',
                'PublicSubnet2',
                'PrivateSubnet1',
                'PrivateSubnet2',
                'NatGateway',
                'NatGatewayEIP',
                'PublicRouteTable',
                'PrivateRouteTable',
                'ALBSecurityGroup',
                'WebServerSecurityGroup',
                'ApplicationLoadBalancer',
                'ALBTargetGroup'
            ];
            taggableResources.forEach(resourceName => {
                const resource = template.Resources[resourceName];
                const tags = resource.Properties.Tags;
                const envTag = tags.find((tag) => tag.Key === 'Environment');
                expect(envTag).toBeDefined();
                expect(envTag.Value).toBe('Development');
            });
        });
    });
    describe('Template Validation', () => {
        test('should have valid JSON structure', () => {
            expect(template).toBeDefined();
            expect(typeof template).toBe('object');
        });
        test('should not have any undefined or null required sections', () => {
            expect(template.AWSTemplateFormatVersion).not.toBeNull();
            expect(template.Description).not.toBeNull();
            expect(template.Parameters).not.toBeNull();
            expect(template.Resources).not.toBeNull();
            expect(template.Outputs).not.toBeNull();
        });
        test('should have correct number of resources', () => {
            const expectedResourceCount = 24; // Count all resources in template
            const actualResourceCount = Object.keys(template.Resources).length;
            expect(actualResourceCount).toBe(expectedResourceCount);
        });
        test('should have correct number of parameters', () => {
            const parameterCount = Object.keys(template.Parameters).length;
            expect(parameterCount).toBe(2);
        });
        test('should have correct number of outputs', () => {
            const outputCount = Object.keys(template.Outputs).length;
            expect(outputCount).toBe(9);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFwLXN0YWNrLnVuaXQudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRhcC1zdGFjay51bml0LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw0Q0FBb0I7QUFDcEIsZ0RBQXdCO0FBRXhCLE1BQU0saUJBQWlCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsSUFBSSxLQUFLLENBQUM7QUFFbEUsUUFBUSxDQUFDLGdEQUFnRCxFQUFFLEdBQUcsRUFBRTtJQUM5RCxJQUFJLFFBQWEsQ0FBQztJQUVsQixTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IseUZBQXlGO1FBQ3pGLE1BQU0sWUFBWSxHQUFHLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLHNCQUFzQixDQUFDLENBQUM7UUFDbEUsTUFBTSxlQUFlLEdBQUcsWUFBRSxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDOUQsUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDekMsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO1FBQ2xDLElBQUksQ0FBQyxpREFBaUQsRUFBRSxHQUFHLEVBQUU7WUFDM0QsTUFBTSxDQUFDLFFBQVEsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7WUFDckMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMzQyxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FDL0IsNEVBQTRFLENBQzdFLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFD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QUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1lBQ25ELE1BQU0scUJBQXFCLEdBQUcsRUFBRSxDQUFDLENBQUMsa0NBQWtDO1lBQ3BFLE1BQU0sbUJBQW1CLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQ25FLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQzFELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtZQUNwRCxNQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDL0QsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7WUFDakQsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQ3pELE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5jb25zdCBlbnZpcm9ubWVudFN1ZmZpeCA9IHByb2Nlc3MuZW52LkVOVklST05NRU5UX1NVRkZJWCB8fCAnZGV2JztcblxuZGVzY3JpYmUoJ1N0YXJ0dXAgSW5mcmFzdHJ1Y3R1cmUgQ2xvdWRGb3JtYXRpb24gVGVtcGxhdGUnLCAoKSA9PiB7XG4gIGxldCB0ZW1wbGF0ZTogYW55O1xuXG4gIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgLy8gUnVuIGBwaXBlbnYgcnVuIGNmbi1mbGlwIGxpYi9UYXBTdGFjay55bWwgPiBsaWIvVGFwU3RhY2suanNvbmAgdG8gY29udmVydCBZQU1MIHRvIEpTT05cbiAgICBjb25zdCB0ZW1wbGF0ZVBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vbGliL1RhcFN0YWNrLmpzb24nKTtcbiAgICBjb25zdCB0ZW1wbGF0ZUNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmModGVtcGxhdGVQYXRoLCAndXRmOCcpO1xuICAgIHRlbXBsYXRlID0gSlNPTi5wYXJzZSh0ZW1wbGF0ZUNvbnRlbnQpO1xuICB9KTtcblxuICBkZXNjcmliZSgnVGVtcGxhdGUgU3RydWN0dXJlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIHZhbGlkIENsb3VkRm9ybWF0aW9uIGZvcm1hdCB2ZXJzaW9uJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLkFXU1RlbXBsYXRlRm9ybWF0VmVyc2lvbikudG9CZSgnMjAxMC0wOS0wOScpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgYSBkZXNjcmlwdGlvbicsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5EZXNjcmlwdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5EZXNjcmlwdGlvbikudG9CZShcbiAgICAgICAgJ1NlY3VyZSBBV1MgZW52aXJvbm1lbnQgd2l0aCBWUEMsIEFMQiwgQVNHLCBhbmQgRUMyIGluc3RhbmNlcyBydW5uaW5nIE5naW54J1xuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BhcmFtZXRlcnMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgYWxsIHJlcXVpcmVkIHBhcmFtZXRlcnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUGFyYW1ldGVycy5JbnN0YW5jZVR5cGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUGFyYW1ldGVycy5LZXlQYWlyTmFtZSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ0luc3RhbmNlVHlwZSBwYXJhbWV0ZXIgc2hvdWxkIGhhdmUgY29ycmVjdCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5zdGFuY2VUeXBlUGFyYW0gPSB0ZW1wbGF0ZS5QYXJhbWV0ZXJzLkluc3RhbmNlVHlwZTtcbiAgICAgIGV4cGVjdChpbnN0YW5jZVR5cGVQYXJhbS5UeXBlKS50b0JlKCdTdHJpbmcnKTtcbiAgICAgIGV4cGVjdChpbnN0YW5jZVR5cGVQYXJhbS5EZWZhdWx0KS50b0JlKCd0My5taWNybycpO1xuICAgICAgZXhwZWN0KGluc3RhbmNlVHlwZVBhcmFtLkRlc2NyaXB0aW9uKS50b0JlKCdFQzIgaW5zdGFuY2UgdHlwZSBmb3IgdGhlIEF1dG8gU2NhbGluZyBHcm91cCcpO1xuICAgICAgZXhwZWN0KGluc3RhbmNlVHlwZVBhcmFtLkFsbG93ZWRWYWx1ZXMpLnRvRXF1YWwoWyd0My5taWNybycsICd0My5zbWFsbCcsICd0My5tZWRpdW0nXSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdLZXlQYWlyTmFtZSBwYXJhbWV0ZXIgc2hvdWxkIGhhdmUgY29ycmVjdCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgY29uc3Qga2V5UGFpclBhcmFtID0gdGVtcGxhdGUuUGFyYW1ldGVycy5LZXlQYWlyTmFtZTtcbiAgICAgIGV4cGVjdChrZXlQYWlyUGFyYW0uVHlwZSkudG9CZSgnU3RyaW5nJyk7XG4gICAgICBleHBlY3Qoa2V5UGFpclBhcmFtLkRlZmF1bHQpLnRvQmUoJycpO1xuICAgICAgZXhwZWN0KGtleVBhaXJQYXJhbS5EZXNjcmlwdGlvbikudG9CZSgnTmFtZSBvZiBhbiBleGlzdGluZyBFQzIgS2V5UGFpciB0byBlbmFibGUgU1NIIGFjY2VzcyAobGVhdmUgZW1wdHkgdG8gc2tpcCknKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NvbmRpdGlvbnMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgSGFzS2V5UGFpciBjb25kaXRpb24nLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUuQ29uZGl0aW9ucy5IYXNLZXlQYWlyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLkNvbmRpdGlvbnMuSGFzS2V5UGFpcikudG9FcXVhbCh7XG4gICAgICAgICdGbjo6Tm90JzogW3sgJ0ZuOjpFcXVhbHMnOiBbeyAnUmVmJzogJ0tleVBhaXJOYW1lJyB9LCAnJ10gfV1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVlBDIFJlc291cmNlcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBWUEMgcmVzb3VyY2UnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlZQQykudG9CZURlZmluZWQoKTtcbiAgICAgIGNvbnN0IHZwYyA9IHRlbXBsYXRlLlJlc291cmNlcy5WUEM7XG4gICAgICBleHBlY3QodnBjLlR5cGUpLnRvQmUoJ0FXUzo6RUMyOjpWUEMnKTtcbiAgICAgIGV4cGVjdCh2cGMuUHJvcGVydGllcy5DaWRyQmxvY2spLnRvQmUoJzEwLjAuMC4wLzE2Jyk7XG4gICAgICBleHBlY3QodnBjLlByb3BlcnRpZXMuRW5hYmxlRG5zSG9zdG5hbWVzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHZwYy5Qcm9wZXJ0aWVzLkVuYWJsZURuc1N1cHBvcnQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBJbnRlcm5ldCBHYXRld2F5JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5JbnRlcm5ldEdhdGV3YXkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLkludGVybmV0R2F0ZXdheS5UeXBlKS50b0JlKCdBV1M6OkVDMjo6SW50ZXJuZXRHYXRld2F5Jyk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLkludGVybmV0R2F0ZXdheUF0dGFjaG1lbnQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBOQVQgR2F0ZXdheSBhbmQgRUlQJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5OYXRHYXRld2F5KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5OYXRHYXRld2F5LlR5cGUpLnRvQmUoJ0FXUzo6RUMyOjpOYXRHYXRld2F5Jyk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLk5hdEdhdGV3YXlFSVApLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLk5hdEdhdGV3YXlFSVAuVHlwZSkudG9CZSgnQVdTOjpFQzI6OkVJUCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU3VibmV0IFJlc291cmNlcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBleGFjdGx5IDIgcHVibGljIHN1Ym5ldHMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlB1YmxpY1N1Ym5ldDEpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlB1YmxpY1N1Ym5ldDIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlB1YmxpY1N1Ym5ldDEuUHJvcGVydGllcy5DaWRyQmxvY2spLnRvQmUoJzEwLjAuMS4wLzI0Jyk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlB1YmxpY1N1Ym5ldDIuUHJvcGVydGllcy5DaWRyQmxvY2spLnRvQmUoJzEwLjAuMi4wLzI0Jyk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlB1YmxpY1N1Ym5ldDEuUHJvcGVydGllcy5NYXBQdWJsaWNJcE9uTGF1bmNoKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5QdWJsaWNTdWJuZXQyLlByb3BlcnRpZXMuTWFwUHVibGljSXBPbkxhdW5jaCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGV4YWN0bHkgMiBwcml2YXRlIHN1Ym5ldHMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlByaXZhdGVTdWJuZXQxKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5Qcml2YXRlU3VibmV0MikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHJpdmF0ZVN1Ym5ldDEuUHJvcGVydGllcy5DaWRyQmxvY2spLnRvQmUoJzEwLjAuMTEuMC8yNCcpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5Qcml2YXRlU3VibmV0Mi5Qcm9wZXJ0aWVzLkNpZHJCbG9jaykudG9CZSgnMTAuMC4xMi4wLzI0Jyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzdWJuZXRzIHNob3VsZCBiZSBpbiBkaWZmZXJlbnQgYXZhaWxhYmlsaXR5IHpvbmVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcHVibGljU3VibmV0MUFaID0gdGVtcGxhdGUuUmVzb3VyY2VzLlB1YmxpY1N1Ym5ldDEuUHJvcGVydGllcy5BdmFpbGFiaWxpdHlab25lO1xuICAgICAgY29uc3QgcHVibGljU3VibmV0MkFaID0gdGVtcGxhdGUuUmVzb3VyY2VzLlB1YmxpY1N1Ym5ldDIuUHJvcGVydGllcy5BdmFpbGFiaWxpdHlab25lO1xuICAgICAgZXhwZWN0KHB1YmxpY1N1Ym5ldDFBWikudG9FcXVhbCh7ICdGbjo6U2VsZWN0JzogWzAsIHsgJ0ZuOjpHZXRBWnMnOiAnJyB9XSB9KTtcbiAgICAgIGV4cGVjdChwdWJsaWNTdWJuZXQyQVopLnRvRXF1YWwoeyAnRm46OlNlbGVjdCc6IFsxLCB7ICdGbjo6R2V0QVpzJzogJycgfV0gfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSb3V0ZSBUYWJsZXMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgcHVibGljIGFuZCBwcml2YXRlIHJvdXRlIHRhYmxlcycsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHVibGljUm91dGVUYWJsZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5SZXNvdXJjZXMuUHJpdmF0ZVJvdXRlVGFibGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdwdWJsaWMgcm91dGUgdGFibGUgc2hvdWxkIHJvdXRlIHRvIEludGVybmV0IEdhdGV3YXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBwdWJsaWNSb3V0ZSA9IHRlbXBsYXRlLlJlc291cmNlcy5EZWZhdWx0UHVibGljUm91dGU7XG4gICAgICBleHBlY3QocHVibGljUm91dGUuUHJvcGVydGllcy5EZXN0aW5hdGlvbkNpZHJCbG9jaykudG9CZSgnMC4wLjAuMC8wJyk7XG4gICAgICBleHBlY3QocHVibGljUm91dGUuUHJvcGVydGllcy5HYXRld2F5SWQpLnRvRXF1YWwoeyAnUmVmJzogJ0ludGVybmV0R2F0ZXdheScgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdwcml2YXRlIHJvdXRlIHRhYmxlIHNob3VsZCByb3V0ZSB0byBOQVQgR2F0ZXdheScsICgpID0+IHtcbiAgICAgIGNvbnN0IHByaXZhdGVSb3V0ZSA9IHRlbXBsYXRlLlJlc291cmNlcy5EZWZhdWx0UHJpdmF0ZVJvdXRlO1xuICAgICAgZXhwZWN0KHByaXZhdGVSb3V0ZS5Qcm9wZXJ0aWVzLkRlc3RpbmF0aW9uQ2lkckJsb2NrKS50b0JlKCcwLjAuMC4wLzAnKTtcbiAgICAgIGV4cGVjdChwcml2YXRlUm91dGUuUHJvcGVydGllcy5OYXRHYXRld2F5SWQpLnRvRXF1YWwoeyAnUmVmJzogJ05hdEdhdGV3YXknIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgY29ycmVjdCByb3V0ZSB0YWJsZSBhc3NvY2lhdGlvbnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlB1YmxpY1N1Ym5ldDFSb3V0ZVRhYmxlQXNzb2NpYXRpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlB1YmxpY1N1Ym5ldDJSb3V0ZVRhYmxlQXNzb2NpYXRpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzLlByaXZhdGVTdWJuZXQxUm91dGVUYWJsZUFzc29jaWF0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRlbXBsYXRlLlJlc291cmNlcy5Qcml2YXRlU3VibmV0MlJvdXRlVGFibGVBc3NvY2lhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlY3VyaXR5IEdyb3VwcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBBTEIgc2VjdXJpdHkgZ3JvdXAnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhbGJTRyA9IHRlbXBsYXRlLlJlc291cmNlcy5BTEJTZWN1cml0eUdyb3VwO1xuICAgICAgZXhwZWN0KGFsYlNHKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGFsYlNHLlR5cGUpLnRvQmUoJ0FXUzo6RUMyOjpTZWN1cml0eUdyb3VwJyk7XG5cbiAgICAgIGNvbnN0IGluZ3Jlc3NSdWxlcyA9IGFsYlNHLlByb3BlcnRpZXMuU2VjdXJpdHlHcm91cEluZ3Jlc3M7XG4gICAgICBleHBlY3QoaW5ncmVzc1J1bGVzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QoaW5ncmVzc1J1bGVzWzBdLkZyb21Qb3J0KS50b0JlKDgwKTtcbiAgICAgIGV4cGVjdChpbmdyZXNzUnVsZXNbMV0uRnJvbVBvcnQpLnRvQmUoNDQzKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIFdlYiBTZXJ2ZXIgc2VjdXJpdHkgZ3JvdXAnLCAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWJTRyA9IHRlbXBsYXRlLlJlc291cmNlcy5XZWJTZXJ2ZXJTZWN1cml0eUdyb3VwO1xuICAgICAgZXhwZWN0KHdlYlNHKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHdlYlNHLlR5cGUpLnRvQmUoJ0FXUzo6RUMyOjpTZWN1cml0eUdyb3VwJyk7XG5cbiAgICAgIGNvbnN0IGluZ3Jlc3NSdWxlcyA9IHdlYlNHLlByb3BlcnRpZXMuU2VjdXJpdHlHcm91cEluZ3Jlc3M7XG4gICAgICBleHBlY3QoaW5ncmVzc1J1bGVzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QoaW5ncmVzc1J1bGVzWzBdLkZyb21Qb3J0KS50b0JlKDgwKTtcbiAgICAgIGV4cGVjdChpbmdyZXNzUnVsZXNbMF0uU291cmNlU2VjdXJpdHlHcm91cElkKS50b0VxdWFsKHsgJ1JlZic6ICdBTEJTZWN1cml0eUdyb3VwJyB9KTtcbiAgICAgIGV4cGVjdChpbmdyZXNzUnVsZXNbMV0uRnJvbVBvcnQpLnRvQmUoMjIpO1xuICAgICAgZXhwZWN0KGluZ3Jlc3NSdWxlc1sxXS5DaWRySXApLnRvQmUoJzEwLjAuMC4wLzE2Jyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBcHBsaWNhdGlvbiBMb2FkIEJhbGFuY2VyJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIEFMQiByZXNvdXJjZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGFsYiA9IHRlbXBsYXRlLlJlc291cmNlcy5BcHBsaWNhdGlvbkxvYWRCYWxhbmNlcjtcbiAgICAgIGV4cGVjdChhbGIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoYWxiLlR5cGUpLnRvQmUoJ0FXUzo6RWxhc3RpY0xvYWRCYWxhbmNpbmdWMjo6TG9hZEJhbGFuY2VyJyk7XG4gICAgICBleHBlY3QoYWxiLlByb3BlcnRpZXMuU2NoZW1lKS50b0JlKCdpbnRlcm5ldC1mYWNpbmcnKTtcbiAgICAgIGV4cGVjdChhbGIuUHJvcGVydGllcy5UeXBlKS50b0JlKCdhcHBsaWNhdGlvbicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgdGFyZ2V0IGdyb3VwIHdpdGggaGVhbHRoIGNoZWNrcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRhcmdldEdyb3VwID0gdGVtcGxhdGUuUmVzb3VyY2VzLkFMQlRhcmdldEdyb3VwO1xuICAgICAgZXhwZWN0KHRhcmdldEdyb3VwKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRhcmdldEdyb3VwLlR5cGUpLnRvQmUoJ0FXUzo6RWxhc3RpY0xvYWRCYWxhbmNpbmdWMjo6VGFyZ2V0R3JvdXAnKTtcbiAgICAgIGV4cGVjdCh0YXJnZXRHcm91cC5Qcm9wZXJ0aWVzLlBvcnQpLnRvQmUoODApO1xuICAgICAgZXhwZWN0KHRhcmdldEdyb3VwLlByb3BlcnRpZXMuUHJvdG9jb2wpLnRvQmUoJ0hUVFAnKTtcbiAgICAgIGV4cGVjdCh0YXJnZXRHcm91cC5Qcm9wZXJ0aWVzLkhlYWx0aENoZWNrUGF0aCkudG9CZSgnLycpO1xuICAgICAgZXhwZWN0KHRhcmdldEdyb3VwLlByb3BlcnRpZXMuSGVhbHRoQ2hlY2tJbnRlcnZhbFNlY29uZHMpLnRvQmUoMzApO1xuICAgICAgZXhwZWN0KHRhcmdldEdyb3VwLlByb3BlcnRpZXMuSGVhbHRoeVRocmVzaG9sZENvdW50KS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHRhcmdldEdyb3VwLlByb3BlcnRpZXMuVW5oZWFsdGh5VGhyZXNob2xkQ291bnQpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBBTEIgbGlzdGVuZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCBsaXN0ZW5lciA9IHRlbXBsYXRlLlJlc291cmNlcy5BTEJMaXN0ZW5lcjtcbiAgICAgIGV4cGVjdChsaXN0ZW5lcikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChsaXN0ZW5lci5UeXBlKS50b0JlKCdBV1M6OkVsYXN0aWNMb2FkQmFsYW5jaW5nVjI6Okxpc3RlbmVyJyk7XG4gICAgICBleHBlY3QobGlzdGVuZXIuUHJvcGVydGllcy5Qb3J0KS50b0JlKDgwKTtcbiAgICAgIGV4cGVjdChsaXN0ZW5lci5Qcm9wZXJ0aWVzLlByb3RvY29sKS50b0JlKCdIVFRQJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBdXRvIFNjYWxpbmcgUmVzb3VyY2VzJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGxhdW5jaCB0ZW1wbGF0ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGxhdW5jaFRlbXBsYXRlID0gdGVtcGxhdGUuUmVzb3VyY2VzLkxhdW5jaFRlbXBsYXRlO1xuICAgICAgZXhwZWN0KGxhdW5jaFRlbXBsYXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGxhdW5jaFRlbXBsYXRlLlR5cGUpLnRvQmUoJ0FXUzo6RUMyOjpMYXVuY2hUZW1wbGF0ZScpO1xuXG4gICAgICBjb25zdCBkYXRhID0gbGF1bmNoVGVtcGxhdGUuUHJvcGVydGllcy5MYXVuY2hUZW1wbGF0ZURhdGE7XG4gICAgICBleHBlY3QoZGF0YS5JbnN0YW5jZVR5cGUpLnRvRXF1YWwoeyAnUmVmJzogJ0luc3RhbmNlVHlwZScgfSk7XG4gICAgICBleHBlY3QoZGF0YS5Vc2VyRGF0YSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2xhdW5jaCB0ZW1wbGF0ZSBzaG91bGQgY29uZGl0aW9uYWxseSBzZXQgS2V5TmFtZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGxhdW5jaFRlbXBsYXRlID0gdGVtcGxhdGUuUmVzb3VyY2VzLkxhdW5jaFRlbXBsYXRlO1xuICAgICAgY29uc3Qga2V5TmFtZSA9IGxhdW5jaFRlbXBsYXRlLlByb3BlcnRpZXMuTGF1bmNoVGVtcGxhdGVEYXRhLktleU5hbWU7XG4gICAgICBleHBlY3Qoa2V5TmFtZSkudG9FcXVhbCh7XG4gICAgICAgICdGbjo6SWYnOiBbJ0hhc0tleVBhaXInLCB7ICdSZWYnOiAnS2V5UGFpck5hbWUnIH0sIHsgJ1JlZic6ICdBV1M6Ok5vVmFsdWUnIH1dXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGF1dG8gc2NhbGluZyBncm91cCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGFzZyA9IHRlbXBsYXRlLlJlc291cmNlcy5BdXRvU2NhbGluZ0dyb3VwO1xuICAgICAgZXhwZWN0KGFzZykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChhc2cuVHlwZSkudG9CZSgnQVdTOjpBdXRvU2NhbGluZzo6QXV0b1NjYWxpbmdHcm91cCcpO1xuICAgICAgZXhwZWN0KGFzZy5Qcm9wZXJ0aWVzLk1pblNpemUpLnRvQmUoMSk7XG4gICAgICBleHBlY3QoYXNnLlByb3BlcnRpZXMuTWF4U2l6ZSkudG9CZSg0KTtcbiAgICAgIGV4cGVjdChhc2cuUHJvcGVydGllcy5EZXNpcmVkQ2FwYWNpdHkpLnRvQmUoMik7XG4gICAgICBleHBlY3QoYXNnLlByb3BlcnRpZXMuSGVhbHRoQ2hlY2tUeXBlKS50b0JlKCdFTEInKTtcbiAgICAgIGV4cGVjdChhc2cuUHJvcGVydGllcy5IZWFsdGhDaGVja0dyYWNlUGVyaW9kKS50b0JlKDMwMCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdBU0cgc2hvdWxkIGJlIGluIHByaXZhdGUgc3VibmV0cycsICgpID0+IHtcbiAgICAgIGNvbnN0IGFzZyA9IHRlbXBsYXRlLlJlc291cmNlcy5BdXRvU2NhbGluZ0dyb3VwO1xuICAgICAgY29uc3Qgc3VibmV0cyA9IGFzZy5Qcm9wZXJ0aWVzLlZQQ1pvbmVJZGVudGlmaWVyO1xuICAgICAgZXhwZWN0KHN1Ym5ldHMpLnRvRXF1YWwoW1xuICAgICAgICB7ICdSZWYnOiAnUHJpdmF0ZVN1Ym5ldDEnIH0sXG4gICAgICAgIHsgJ1JlZic6ICdQcml2YXRlU3VibmV0MicgfVxuICAgICAgXSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdPdXRwdXRzJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGFsbCByZXF1aXJlZCBvdXRwdXRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXhwZWN0ZWRPdXRwdXRzID0gW1xuICAgICAgICAnVlBDSWQnLFxuICAgICAgICAnUHVibGljU3VibmV0MUlkJyxcbiAgICAgICAgJ1B1YmxpY1N1Ym5ldDJJZCcsXG4gICAgICAgICdQcml2YXRlU3VibmV0MUlkJyxcbiAgICAgICAgJ1ByaXZhdGVTdWJuZXQySWQnLFxuICAgICAgICAnQUxCU2VjdXJpdHlHcm91cElkJyxcbiAgICAgICAgJ1dlYlNlcnZlclNlY3VyaXR5R3JvdXBJZCcsXG4gICAgICAgICdBcHBsaWNhdGlvbkxvYWRCYWxhbmNlckROUycsXG4gICAgICAgICdBcHBsaWNhdGlvbkxvYWRCYWxhbmNlclVSTCdcbiAgICAgIF07XG5cbiAgICAgIGV4cGVjdGVkT3V0cHV0cy5mb3JFYWNoKG91dHB1dE5hbWUgPT4ge1xuICAgICAgICBleHBlY3QodGVtcGxhdGUuT3V0cHV0c1tvdXRwdXROYW1lXSkudG9CZURlZmluZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBBTEIgRE5TIG91dHB1dCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGFsYkRuc091dHB1dCA9IHRlbXBsYXRlLk91dHB1dHMuQXBwbGljYXRpb25Mb2FkQmFsYW5jZXJETlM7XG4gICAgICBleHBlY3QoYWxiRG5zT3V0cHV0LkRlc2NyaXB0aW9uKS50b0JlKCdBcHBsaWNhdGlvbiBMb2FkIEJhbGFuY2VyIEROUyBOYW1lJyk7XG4gICAgICBleHBlY3QoYWxiRG5zT3V0cHV0LlZhbHVlKS50b0VxdWFsKHtcbiAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbJ0FwcGxpY2F0aW9uTG9hZEJhbGFuY2VyJywgJ0ROU05hbWUnXVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IEFMQiBVUkwgb3V0cHV0JywgKCkgPT4ge1xuICAgICAgY29uc3QgYWxiVXJsT3V0cHV0ID0gdGVtcGxhdGUuT3V0cHV0cy5BcHBsaWNhdGlvbkxvYWRCYWxhbmNlclVSTDtcbiAgICAgIGV4cGVjdChhbGJVcmxPdXRwdXQuRGVzY3JpcHRpb24pLnRvQmUoJ0FwcGxpY2F0aW9uIExvYWQgQmFsYW5jZXIgVVJMJyk7XG4gICAgICBleHBlY3QoYWxiVXJsT3V0cHV0LlZhbHVlKS50b0VxdWFsKHtcbiAgICAgICAgJ0ZuOjpTdWInOiAnaHR0cDovLyR7QXBwbGljYXRpb25Mb2FkQmFsYW5jZXIuRE5TTmFtZX0nXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Jlc291cmNlIFRhZ3MnLCAoKSA9PiB7XG4gICAgdGVzdCgnYWxsIHRhZ2dhYmxlIHJlc291cmNlcyBzaG91bGQgaGF2ZSBFbnZpcm9ubWVudCB0YWcnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0YWdnYWJsZVJlc291cmNlcyA9IFtcbiAgICAgICAgJ1ZQQycsXG4gICAgICAgICdJbnRlcm5ldEdhdGV3YXknLFxuICAgICAgICAnUHVibGljU3VibmV0MScsXG4gICAgICAgICdQdWJsaWNTdWJuZXQyJyxcbiAgICAgICAgJ1ByaXZhdGVTdWJuZXQxJyxcbiAgICAgICAgJ1ByaXZhdGVTdWJuZXQyJyxcbiAgICAgICAgJ05hdEdhdGV3YXknLFxuICAgICAgICAnTmF0R2F0ZXdheUVJUCcsXG4gICAgICAgICdQdWJsaWNSb3V0ZVRhYmxlJyxcbiAgICAgICAgJ1ByaXZhdGVSb3V0ZVRhYmxlJyxcbiAgICAgICAgJ0FMQlNlY3VyaXR5R3JvdXAnLFxuICAgICAgICAnV2ViU2VydmVyU2VjdXJpdHlHcm91cCcsXG4gICAgICAgICdBcHBsaWNhdGlvbkxvYWRCYWxhbmNlcicsXG4gICAgICAgICdBTEJUYXJnZXRHcm91cCdcbiAgICAgIF07XG5cbiAgICAgIHRhZ2dhYmxlUmVzb3VyY2VzLmZvckVhY2gocmVzb3VyY2VOYW1lID0+IHtcbiAgICAgICAgY29uc3QgcmVzb3VyY2UgPSB0ZW1wbGF0ZS5SZXNvdXJjZXNbcmVzb3VyY2VOYW1lXTtcbiAgICAgICAgY29uc3QgdGFncyA9IHJlc291cmNlLlByb3BlcnRpZXMuVGFncztcbiAgICAgICAgY29uc3QgZW52VGFnID0gdGFncy5maW5kKCh0YWc6IGFueSkgPT4gdGFnLktleSA9PT0gJ0Vudmlyb25tZW50Jyk7XG4gICAgICAgIGV4cGVjdChlbnZUYWcpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChlbnZUYWcuVmFsdWUpLnRvQmUoJ0RldmVsb3BtZW50Jyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1RlbXBsYXRlIFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgdmFsaWQgSlNPTiBzdHJ1Y3R1cmUnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodHlwZW9mIHRlbXBsYXRlKS50b0JlKCdvYmplY3QnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBub3QgaGF2ZSBhbnkgdW5kZWZpbmVkIG9yIG51bGwgcmVxdWlyZWQgc2VjdGlvbnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodGVtcGxhdGUuQVdTVGVtcGxhdGVGb3JtYXRWZXJzaW9uKS5ub3QudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5EZXNjcmlwdGlvbikubm90LnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUGFyYW1ldGVycykubm90LnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QodGVtcGxhdGUuUmVzb3VyY2VzKS5ub3QudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdCh0ZW1wbGF0ZS5PdXRwdXRzKS5ub3QudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGNvcnJlY3QgbnVtYmVyIG9mIHJlc291cmNlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGV4cGVjdGVkUmVzb3VyY2VDb3VudCA9IDI0OyAvLyBDb3VudCBhbGwgcmVzb3VyY2VzIGluIHRlbXBsYXRlXG4gICAgICBjb25zdCBhY3R1YWxSZXNvdXJjZUNvdW50ID0gT2JqZWN0LmtleXModGVtcGxhdGUuUmVzb3VyY2VzKS5sZW5ndGg7XG4gICAgICBleHBlY3QoYWN0dWFsUmVzb3VyY2VDb3VudCkudG9CZShleHBlY3RlZFJlc291cmNlQ291bnQpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBudW1iZXIgb2YgcGFyYW1ldGVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcmFtZXRlckNvdW50ID0gT2JqZWN0LmtleXModGVtcGxhdGUuUGFyYW1ldGVycykubGVuZ3RoO1xuICAgICAgZXhwZWN0KHBhcmFtZXRlckNvdW50KS50b0JlKDIpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBudW1iZXIgb2Ygb3V0cHV0cycsICgpID0+IHtcbiAgICAgIGNvbnN0IG91dHB1dENvdW50ID0gT2JqZWN0LmtleXModGVtcGxhdGUuT3V0cHV0cykubGVuZ3RoO1xuICAgICAgZXhwZWN0KG91dHB1dENvdW50KS50b0JlKDkpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdfQ==