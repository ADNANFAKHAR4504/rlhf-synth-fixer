{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Production-ready CloudFormation template for secure and scalable web access layer with S3, CloudFront, Route 53, and CloudWatch monitoring",
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "Environment Configuration"
                    },
                    "Parameters": [
                        "EnvironmentSuffix"
                    ]
                },
                {
                    "Label": {
                        "default": "Domain and SSL Configuration (Optional)"
                    },
                    "Parameters": [
                        "DomainName",
                        "HostedZoneId",
                        "CertificateArn"
                    ]
                }
            ],
            "ParameterLabels": {
                "DomainName": {
                    "default": "Custom Domain Name"
                },
                "HostedZoneId": {
                    "default": "Route 53 Hosted Zone ID"
                },
                "EnvironmentSuffix": {
                    "default": "Environment Suffix"
                },
                "CertificateArn": {
                    "default": "ACM Certificate ARN"
                }
            }
        }
    },
    "Parameters": {
        "DomainName": {
            "Type": "String",
            "Description": "Custom domain name (e.g., example.com). Leave empty to use CloudFront default domain",
            "Default": "",
            "AllowedPattern": "^$|^([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}$",
            "ConstraintDescription": "Must be a valid domain name or empty"
        },
        "HostedZoneId": {
            "Type": "String",
            "Description": "Route 53 Hosted Zone ID. Required if DomainName is provided",
            "Default": "",
            "AllowedPattern": "^$|^Z[A-Z0-9]+$",
            "ConstraintDescription": "Must be a valid Route 53 Hosted Zone ID or empty"
        },
        "EnvironmentSuffix": {
            "Type": "String",
            "Description": "Environment suffix (e.g., dev, staging, prod)",
            "Default": "prod",
            "MinLength": 1,
            "MaxLength": 20,
            "ConstraintDescription": "Must contain only lowercase letters, numbers, and hyphens"
        },
        "CertificateArn": {
            "Type": "String",
            "Description": "ARN of ACM certificate in us-east-1 (for CloudFront). Leave empty to create new (requires DomainName and HostedZoneId)",
            "Default": "",
            "AllowedPattern": "^$|^arn:aws:acm:us-east-1:[0-9]{12}:certificate/[a-f0-9-]+$",
            "ConstraintDescription": "Must be a valid ACM certificate ARN in us-east-1 region or empty"
        }
    },
    "Conditions": {
        "HasDomainName": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "DomainName"
                        },
                        ""
                    ]
                }
            ]
        },
        "HasHostedZoneId": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "HostedZoneId"
                        },
                        ""
                    ]
                }
            ]
        },
        "HasCertificateArn": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "CertificateArn"
                        },
                        ""
                    ]
                }
            ]
        },
        "CreateCertificate": {
            "Fn::And": [
                {
                    "Condition": "HasDomainName"
                },
                {
                    "Condition": "HasHostedZoneId"
                },
                {
                    "Fn::Not": [
                        {
                            "Condition": "HasCertificateArn"
                        }
                    ]
                }
            ]
        },
        "CreateDNSRecords": {
            "Fn::And": [
                {
                    "Condition": "HasDomainName"
                },
                {
                    "Condition": "HasHostedZoneId"
                }
            ]
        },
        "UseCertificate": {
            "Fn::Or": [
                {
                    "Condition": "HasCertificateArn"
                },
                {
                    "Condition": "CreateCertificate"
                }
            ]
        }
    },
    "Resources": {
        "WebsiteBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Fn::Sub": "website-content-${AWS::Region}-${EnvironmentSuffix}-${AWS::AccountId}"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "VersioningConfiguration": {
                    "Status": "Enabled"
                },
                "LifecycleConfiguration": {
                    "Rules": [
                        {
                            "Id": "DeleteOldVersions",
                            "Status": "Enabled",
                            "NoncurrentVersionExpirationInDays": 30
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Purpose",
                        "Value": "StaticWebsiteHosting"
                    },
                    {
                        "Key": "ManagedBy",
                        "Value": "CloudFormation"
                    }
                ]
            }
        },
        "LogsBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Fn::Sub": "cloudfront-logs-${AWS::Region}-${EnvironmentSuffix}-${AWS::AccountId}"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "LifecycleConfiguration": {
                    "Rules": [
                        {
                            "Id": "DeleteOldLogs",
                            "Status": "Enabled",
                            "ExpirationInDays": 90
                        },
                        {
                            "Id": "TransitionToIA",
                            "Status": "Enabled",
                            "Transitions": [
                                {
                                    "TransitionInDays": 30,
                                    "StorageClass": "STANDARD_IA"
                                }
                            ]
                        }
                    ]
                },
                "OwnershipControls": {
                    "Rules": [
                        {
                            "ObjectOwnership": "BucketOwnerPreferred"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Purpose",
                        "Value": "CloudFrontLogs"
                    },
                    {
                        "Key": "ManagedBy",
                        "Value": "CloudFormation"
                    }
                ]
            }
        },
        "CloudFrontOAC": {
            "Type": "AWS::CloudFront::OriginAccessControl",
            "Properties": {
                "OriginAccessControlConfig": {
                    "Name": {
                        "Fn::Sub": "oac-${AWS::Region}-${EnvironmentSuffix}"
                    },
                    "OriginAccessControlOriginType": "s3",
                    "SigningBehavior": "always",
                    "SigningProtocol": "sigv4"
                }
            }
        },
        "WebsiteBucketPolicy": {
            "Type": "AWS::S3::BucketPolicy",
            "Properties": {
                "Bucket": {
                    "Ref": "WebsiteBucket"
                },
                "PolicyDocument": {
                    "Statement": [
                        {
                            "Sid": "AllowCloudFrontServicePrincipal",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "cloudfront.amazonaws.com"
                            },
                            "Action": "s3:GetObject",
                            "Resource": {
                                "Fn::Sub": "${WebsiteBucket.Arn}/*"
                            },
                            "Condition": {
                                "StringEquals": {
                                    "AWS:SourceArn": {
                                        "Fn::Sub": "arn:aws:cloudfront::${AWS::AccountId}:distribution/${CloudFrontDistribution}"
                                    }
                                }
                            }
                        }
                    ]
                }
            }
        },
        "SSLCertificate": {
            "Type": "AWS::CertificateManager::Certificate",
            "Condition": "CreateCertificate",
            "Properties": {
                "DomainName": {
                    "Ref": "DomainName"
                },
                "SubjectAlternativeNames": [
                    {
                        "Fn::Sub": "www.${DomainName}"
                    }
                ],
                "ValidationMethod": "DNS",
                "DomainValidationOptions": [
                    {
                        "DomainName": {
                            "Ref": "DomainName"
                        },
                        "HostedZoneId": {
                            "Ref": "HostedZoneId"
                        }
                    }
                ],
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Sub": "ssl-cert-${EnvironmentSuffix}"
                        }
                    },
                    {
                        "Key": "ManagedBy",
                        "Value": "CloudFormation"
                    }
                ]
            }
        },
        "CloudFrontDistribution": {
            "Type": "AWS::CloudFront::Distribution",
            "Properties": {
                "DistributionConfig": {
                    "Enabled": true,
                    "Comment": {
                        "Fn::Sub": "CloudFront distribution for ${EnvironmentSuffix} environment in ${AWS::Region}"
                    },
                    "DefaultRootObject": "index.html",
                    "HttpVersion": "http2and3",
                    "IPV6Enabled": true,
                    "PriceClass": "PriceClass_100",
                    "Aliases": {
                        "Fn::If": [
                            "HasDomainName",
                            [
                                {
                                    "Ref": "DomainName"
                                },
                                {
                                    "Fn::Sub": "www.${DomainName}"
                                }
                            ],
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    "ViewerCertificate": {
                        "Fn::If": [
                            "UseCertificate",
                            {
                                "AcmCertificateArn": {
                                    "Fn::If": [
                                        "HasCertificateArn",
                                        {
                                            "Ref": "CertificateArn"
                                        },
                                        {
                                            "Ref": "SSLCertificate"
                                        }
                                    ]
                                },
                                "SslSupportMethod": "sni-only",
                                "MinimumProtocolVersion": "TLSv1.2_2021"
                            },
                            {
                                "CloudFrontDefaultCertificate": true
                            }
                        ]
                    },
                    "Origins": [
                        {
                            "Id": "S3Origin",
                            "DomainName": {
                                "Fn::GetAtt": [
                                    "WebsiteBucket",
                                    "RegionalDomainName"
                                ]
                            },
                            "OriginAccessControlId": {
                                "Ref": "CloudFrontOAC"
                            },
                            "S3OriginConfig": {}
                        }
                    ],
                    "DefaultCacheBehavior": {
                        "TargetOriginId": "S3Origin",
                        "ViewerProtocolPolicy": "redirect-to-https",
                        "AllowedMethods": [
                            "GET",
                            "HEAD",
                            "OPTIONS"
                        ],
                        "CachedMethods": [
                            "GET",
                            "HEAD"
                        ],
                        "Compress": true,
                        "CachePolicyId": "658327ea-f89d-4fab-a63d-7e88639e58f6",
                        "OriginRequestPolicyId": "88a5eaf4-2fd4-4709-b370-b4c650ea3fcf",
                        "ResponseHeadersPolicyId": "67f7725c-6f97-4210-82d7-5512b31e9d03"
                    },
                    "CustomErrorResponses": [
                        {
                            "ErrorCode": 403,
                            "ResponseCode": 404,
                            "ResponsePagePath": "/404.html",
                            "ErrorCachingMinTTL": 300
                        },
                        {
                            "ErrorCode": 404,
                            "ResponseCode": 404,
                            "ResponsePagePath": "/404.html",
                            "ErrorCachingMinTTL": 300
                        }
                    ],
                    "Logging": {
                        "Bucket": {
                            "Fn::GetAtt": [
                                "LogsBucket",
                                "DomainName"
                            ]
                        },
                        "Prefix": "cloudfront/",
                        "IncludeCookies": false
                    }
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Sub": "cloudfront-dist-${AWS::Region}-${EnvironmentSuffix}"
                        }
                    },
                    {
                        "Key": "ManagedBy",
                        "Value": "CloudFormation"
                    }
                ]
            }
        },
        "DNSRecordIPv4": {
            "Type": "AWS::Route53::RecordSet",
            "Condition": "CreateDNSRecords",
            "Properties": {
                "HostedZoneId": {
                    "Ref": "HostedZoneId"
                },
                "Name": {
                    "Ref": "DomainName"
                },
                "Type": "A",
                "AliasTarget": {
                    "DNSName": {
                        "Fn::GetAtt": [
                            "CloudFrontDistribution",
                            "DomainName"
                        ]
                    },
                    "HostedZoneId": "Z2FDTNDATAQYW2",
                    "EvaluateTargetHealth": false
                }
            }
        },
        "DNSRecordIPv6": {
            "Type": "AWS::Route53::RecordSet",
            "Condition": "CreateDNSRecords",
            "Properties": {
                "HostedZoneId": {
                    "Ref": "HostedZoneId"
                },
                "Name": {
                    "Ref": "DomainName"
                },
                "Type": "AAAA",
                "AliasTarget": {
                    "DNSName": {
                        "Fn::GetAtt": [
                            "CloudFrontDistribution",
                            "DomainName"
                        ]
                    },
                    "HostedZoneId": "Z2FDTNDATAQYW2",
                    "EvaluateTargetHealth": false
                }
            }
        },
        "WWWDNSRecordIPv4": {
            "Type": "AWS::Route53::RecordSet",
            "Condition": "CreateDNSRecords",
            "Properties": {
                "HostedZoneId": {
                    "Ref": "HostedZoneId"
                },
                "Name": {
                    "Fn::Sub": "www.${DomainName}"
                },
                "Type": "A",
                "AliasTarget": {
                    "DNSName": {
                        "Fn::GetAtt": [
                            "CloudFrontDistribution",
                            "DomainName"
                        ]
                    },
                    "HostedZoneId": "Z2FDTNDATAQYW2",
                    "EvaluateTargetHealth": false
                }
            }
        },
        "WWWDNSRecordIPv6": {
            "Type": "AWS::Route53::RecordSet",
            "Condition": "CreateDNSRecords",
            "Properties": {
                "HostedZoneId": {
                    "Ref": "HostedZoneId"
                },
                "Name": {
                    "Fn::Sub": "www.${DomainName}"
                },
                "Type": "AAAA",
                "AliasTarget": {
                    "DNSName": {
                        "Fn::GetAtt": [
                            "CloudFrontDistribution",
                            "DomainName"
                        ]
                    },
                    "HostedZoneId": "Z2FDTNDATAQYW2",
                    "EvaluateTargetHealth": false
                }
            }
        },
        "CloudWatchMonitoringRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "cloudwatch.amazonaws.com",
                                    "lambda.amazonaws.com"
                                ]
                            },
                            "Action": "sts:AssumeRole"
                        }
                    ]
                },
                "Policies": [
                    {
                        "PolicyName": {
                            "Fn::Sub": "monitoring-policy-${AWS::Region}-${EnvironmentSuffix}"
                        },
                        "PolicyDocument": {
                            "Version": "2012-10-17",
                            "Statement": [
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "cloudfront:GetDistribution",
                                        "cloudfront:GetDistributionConfig",
                                        "cloudfront:ListDistributions",
                                        "cloudfront:GetMonitoringSubscription"
                                    ],
                                    "Resource": "*"
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "s3:GetBucketLocation",
                                        "s3:ListBucket",
                                        "s3:GetBucketLogging"
                                    ],
                                    "Resource": [
                                        {
                                            "Fn::GetAtt": [
                                                "WebsiteBucket",
                                                "Arn"
                                            ]
                                        },
                                        {
                                            "Fn::GetAtt": [
                                                "LogsBucket",
                                                "Arn"
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "cloudwatch:PutMetricData",
                                        "cloudwatch:GetMetricData",
                                        "cloudwatch:GetMetricStatistics",
                                        "cloudwatch:ListMetrics"
                                    ],
                                    "Resource": "*"
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "logs:CreateLogGroup",
                                        "logs:CreateLogStream",
                                        "logs:PutLogEvents"
                                    ],
                                    "Resource": {
                                        "Fn::Sub": "arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/lambda/*"
                                    }
                                }
                            ]
                        }
                    }
                ],
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "EnvironmentSuffix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Sub": "monitoring-role-${AWS::Region}-${EnvironmentSuffix}"
                        }
                    },
                    {
                        "Key": "ManagedBy",
                        "Value": "CloudFormation"
                    }
                ]
            }
        },
        "CloudFront4xxErrorAlarm": {
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": {
                "AlarmName": {
                    "Fn::Sub": "cloudfront-4xx-errors-${AWS::Region}-${EnvironmentSuffix}"
                },
                "AlarmDescription": "Triggers when CloudFront 4xx error rate exceeds 5% over 10 minutes",
                "MetricName": "4xxErrorRate",
                "Namespace": "AWS/CloudFront",
                "Statistic": "Average",
                "Period": 300,
                "EvaluationPeriods": 2,
                "Threshold": 5,
                "ComparisonOperator": "GreaterThanThreshold",
                "Dimensions": [
                    {
                        "Name": "DistributionId",
                        "Value": {
                            "Ref": "CloudFrontDistribution"
                        }
                    },
                    {
                        "Name": "Region",
                        "Value": "Global"
                    }
                ],
                "TreatMissingData": "notBreaching"
            }
        },
        "CloudFront5xxErrorAlarm": {
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": {
                "AlarmName": {
                    "Fn::Sub": "cloudfront-5xx-errors-${AWS::Region}-${EnvironmentSuffix}"
                },
                "AlarmDescription": "Triggers when CloudFront 5xx error rate exceeds 1% over 10 minutes",
                "MetricName": "5xxErrorRate",
                "Namespace": "AWS/CloudFront",
                "Statistic": "Average",
                "Period": 300,
                "EvaluationPeriods": 2,
                "Threshold": 1,
                "ComparisonOperator": "GreaterThanThreshold",
                "Dimensions": [
                    {
                        "Name": "DistributionId",
                        "Value": {
                            "Ref": "CloudFrontDistribution"
                        }
                    },
                    {
                        "Name": "Region",
                        "Value": "Global"
                    }
                ],
                "TreatMissingData": "notBreaching"
            }
        },
        "CloudFrontCacheHitRateAlarm": {
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": {
                "AlarmName": {
                    "Fn::Sub": "cloudfront-cache-hit-rate-${AWS::Region}-${EnvironmentSuffix}"
                },
                "AlarmDescription": "Triggers when CloudFront cache hit rate falls below 70% over 10 minutes",
                "MetricName": "CacheHitRate",
                "Namespace": "AWS/CloudFront",
                "Statistic": "Average",
                "Period": 300,
                "EvaluationPeriods": 2,
                "Threshold": 70,
                "ComparisonOperator": "LessThanThreshold",
                "Dimensions": [
                    {
                        "Name": "DistributionId",
                        "Value": {
                            "Ref": "CloudFrontDistribution"
                        }
                    },
                    {
                        "Name": "Region",
                        "Value": "Global"
                    }
                ],
                "TreatMissingData": "notBreaching"
            }
        },
        "CloudFrontRequestCountAlarm": {
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": {
                "AlarmName": {
                    "Fn::Sub": "cloudfront-high-requests-${AWS::Region}-${EnvironmentSuffix}"
                },
                "AlarmDescription": "Triggers when CloudFront receives more than 10,000 requests in 5 minutes",
                "MetricName": "Requests",
                "Namespace": "AWS/CloudFront",
                "Statistic": "Sum",
                "Period": 300,
                "EvaluationPeriods": 2,
                "Threshold": 10000,
                "ComparisonOperator": "GreaterThanThreshold",
                "Dimensions": [
                    {
                        "Name": "DistributionId",
                        "Value": {
                            "Ref": "CloudFrontDistribution"
                        }
                    },
                    {
                        "Name": "Region",
                        "Value": "Global"
                    }
                ],
                "TreatMissingData": "notBreaching"
            }
        },
        "CloudFrontOriginLatencyAlarm": {
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": {
                "AlarmName": {
                    "Fn::Sub": "cloudfront-origin-latency-${AWS::Region}-${EnvironmentSuffix}"
                },
                "AlarmDescription": "Triggers when origin latency exceeds 1000ms over 10 minutes",
                "MetricName": "OriginLatency",
                "Namespace": "AWS/CloudFront",
                "Statistic": "Average",
                "Period": 300,
                "EvaluationPeriods": 2,
                "Threshold": 1000,
                "ComparisonOperator": "GreaterThanThreshold",
                "Dimensions": [
                    {
                        "Name": "DistributionId",
                        "Value": {
                            "Ref": "CloudFrontDistribution"
                        }
                    },
                    {
                        "Name": "Region",
                        "Value": "Global"
                    }
                ],
                "TreatMissingData": "notBreaching"
            }
        },
        "MonitoringDashboard": {
            "Type": "AWS::CloudWatch::Dashboard",
            "Properties": {
                "DashboardName": {
                    "Fn::Sub": "website-monitoring-${AWS::Region}-${EnvironmentSuffix}"
                },
                "DashboardBody": {
                    "Fn::Sub": "{\n  \"widgets\": [\n    {\n      \"type\": \"metric\",\n      \"x\": 0,\n      \"y\": 0,\n      \"width\": 12,\n      \"height\": 6,\n      \"properties\": {\n        \"metrics\": [\n          [\"AWS/CloudFront\", \"Requests\", {\"stat\": \"Sum\", \"label\": \"Total Requests\", \"region\": \"us-east-1\"}]\n        ],\n        \"view\": \"timeSeries\",\n        \"stacked\": false,\n        \"region\": \"us-east-1\",\n        \"title\": \"CloudFront Total Requests\",\n        \"period\": 300,\n        \"yAxis\": {\n          \"left\": {\n            \"min\": 0\n          }\n        }\n      }\n    },\n    {\n      \"type\": \"metric\",\n      \"x\": 12,\n      \"y\": 0,\n      \"width\": 12,\n      \"height\": 6,\n      \"properties\": {\n        \"metrics\": [\n          [\"AWS/CloudFront\", \"BytesDownloaded\", {\"stat\": \"Sum\", \"label\": \"Bytes Downloaded\", \"region\": \"us-east-1\"}],\n          [\".\", \"BytesUploaded\", {\"stat\": \"Sum\", \"label\": \"Bytes Uploaded\", \"region\": \"us-east-1\"}]\n        ],\n        \"view\": \"timeSeries\",\n        \"stacked\": false,\n        \"region\": \"us-east-1\",\n        \"title\": \"Data Transfer\",\n        \"period\": 300,\n        \"yAxis\": {\n          \"left\": {\n            \"min\": 0\n          }\n        }\n      }\n    },\n    {\n      \"type\": \"metric\",\n      \"x\": 0,\n      \"y\": 6,\n      \"width\": 12,\n      \"height\": 6,\n      \"properties\": {\n        \"metrics\": [\n          [\"AWS/CloudFront\", \"4xxErrorRate\", {\"stat\": \"Average\", \"label\": \"4xx Error Rate\", \"region\": \"us-east-1\"}],\n          [\".\", \"5xxErrorRate\", {\"stat\": \"Average\", \"label\": \"5xx Error Rate\", \"region\": \"us-east-1\"}]\n        ],\n        \"view\": \"timeSeries\",\n        \"stacked\": false,\n        \"region\": \"us-east-1\",\n        \"title\": \"Error Rates (%)\",\n        \"period\": 300,\n        \"yAxis\": {\n          \"left\": {\n            \"min\": 0,\n            \"max\": 10\n          }\n        },\n        \"annotations\": {\n          \"horizontal\": [\n            {\n              \"label\": \"4xx Threshold\",\n              \"value\": 5,\n              \"fill\": \"above\",\n              \"color\": \"#ff7f0e\"\n            },\n            {\n              \"label\": \"5xx Threshold\",\n              \"value\": 1,\n              \"fill\": \"above\",\n              \"color\": \"#d62728\"\n            }\n          ]\n        }\n      }\n    },\n    {\n      \"type\": \"metric\",\n      \"x\": 12,\n      \"y\": 6,\n      \"width\": 12,\n      \"height\": 6,\n      \"properties\": {\n        \"metrics\": [\n          [\"AWS/CloudFront\", \"CacheHitRate\", {\"stat\": \"Average\", \"label\": \"Cache Hit Rate\", \"region\": \"us-east-1\"}]\n        ],\n        \"view\": \"timeSeries\",\n        \"stacked\": false,\n        \"region\": \"us-east-1\",\n        \"title\": \"Cache Performance (%)\",\n        \"period\": 300,\n        \"yAxis\": {\n          \"left\": {\n            \"min\": 0,\n            \"max\": 100\n          }\n        },\n        \"annotations\": {\n          \"horizontal\": [\n            {\n              \"label\": \"Target Threshold\",\n              \"value\": 70,\n              \"fill\": \"below\",\n              \"color\": \"#ff7f0e\"\n            }\n          ]\n        }\n      }\n    },\n    {\n      \"type\": \"metric\",\n      \"x\": 0,\n      \"y\": 12,\n      \"width\": 12,\n      \"height\": 6,\n      \"properties\": {\n        \"metrics\": [\n          [\"AWS/CloudFront\", \"OriginLatency\", {\"stat\": \"Average\", \"label\": \"Average Latency\", \"region\": \"us-east-1\"}],\n          [\"...\", {\"stat\": \"p99\", \"label\": \"P99 Latency\", \"region\": \"us-east-1\"}]\n        ],\n        \"view\": \"timeSeries\",\n        \"stacked\": false,\n        \"region\": \"us-east-1\",\n        \"title\": \"Origin Latency (ms)\",\n        \"period\": 300,\n        \"yAxis\": {\n          \"left\": {\n            \"min\": 0\n          }\n        }\n      }\n    },\n    {\n      \"type\": \"log\",\n      \"x\": 12,\n      \"y\": 12,\n      \"width\": 12,\n      \"height\": 6,\n      \"properties\": {\n        \"query\": \"SOURCE '/aws/cloudfront/distribution/${CloudFrontDistribution}'\\n| fields @timestamp, @message\\n| sort @timestamp desc\\n| limit 20\",\n        \"region\": \"us-east-1\",\n        \"stacked\": false,\n        \"title\": \"Recent CloudFront Logs\",\n        \"view\": \"table\"\n      }\n    }\n  ]\n}\n"
                }
            }
        }
    },
    "Outputs": {
        "CloudFrontDistributionURL": {
            "Description": "CloudFront distribution domain name (HTTPS URL)",
            "Value": {
                "Fn::Sub": "https://${CloudFrontDistribution.DomainName}"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-CloudFrontURL"
                }
            }
        },
        "CloudFrontDistributionId": {
            "Description": "CloudFront distribution ID for CLI operations",
            "Value": {
                "Ref": "CloudFrontDistribution"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-CloudFrontDistributionId"
                }
            }
        },
        "CloudFrontDistributionDomain": {
            "Description": "CloudFront distribution domain name (without protocol)",
            "Value": {
                "Fn::GetAtt": [
                    "CloudFrontDistribution",
                    "DomainName"
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-CloudFrontDomain"
                }
            }
        },
        "WebsiteBucketName": {
            "Description": "S3 bucket name for uploading website content",
            "Value": {
                "Ref": "WebsiteBucket"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-WebsiteBucket"
                }
            }
        },
        "WebsiteBucketArn": {
            "Description": "S3 bucket ARN for IAM policies",
            "Value": {
                "Fn::GetAtt": [
                    "WebsiteBucket",
                    "Arn"
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-WebsiteBucketArn"
                }
            }
        },
        "LogsBucketName": {
            "Description": "S3 bucket name for CloudFront access logs",
            "Value": {
                "Ref": "LogsBucket"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-LogsBucket"
                }
            }
        },
        "CloudWatchDashboardURL": {
            "Description": "CloudWatch Dashboard URL for monitoring",
            "Value": {
                "Fn::Sub": "https://console.aws.amazon.com/cloudwatch/home?region=${AWS::Region}#dashboards:name=${MonitoringDashboard}"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-DashboardURL"
                }
            }
        },
        "WebsiteURL": {
            "Description": "Primary website URL (custom domain or CloudFront URL)",
            "Value": {
                "Fn::If": [
                    "HasDomainName",
                    {
                        "Fn::Sub": "https://${DomainName}"
                    },
                    {
                        "Fn::Sub": "https://${CloudFrontDistribution.DomainName}"
                    }
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-WebsiteURL"
                }
            }
        },
        "WWWWebsiteURL": {
            "Condition": "HasDomainName",
            "Description": "WWW subdomain website URL",
            "Value": {
                "Fn::Sub": "https://www.${DomainName}"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-WWWWebsiteURL"
                }
            }
        },
        "SSLCertificateArn": {
            "Condition": "CreateCertificate",
            "Description": "ARN of the created ACM SSL certificate",
            "Value": {
                "Ref": "SSLCertificate"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-CertificateArn"
                }
            }
        },
        "MonitoringRoleArn": {
            "Description": "ARN of the CloudWatch monitoring IAM role",
            "Value": {
                "Fn::GetAtt": [
                    "CloudWatchMonitoringRole",
                    "Arn"
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-MonitoringRoleArn"
                }
            }
        },
        "DeploymentCommand": {
            "Description": "AWS CLI command to sync content to S3",
            "Value": {
                "Fn::Sub": "aws s3 sync ./your-website-folder s3://${WebsiteBucket}/ --delete"
            }
        },
        "InvalidateCacheCommand": {
            "Description": "AWS CLI command to invalidate CloudFront cache",
            "Value": {
                "Fn::Sub": "aws cloudfront create-invalidation --distribution-id ${CloudFrontDistribution} --paths \"/*\""
            }
        },
        "StackRegion": {
            "Description": "AWS Region where this stack was deployed",
            "Value": {
                "Ref": "AWS::Region"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-Region"
                }
            }
        },
        "EnvironmentName": {
            "Description": "Environment suffix used for this deployment",
            "Value": {
                "Ref": "EnvironmentSuffix"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-Environment"
                }
            }
        }
    }
}