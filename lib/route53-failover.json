{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Route 53 Failover Configuration for Aurora Global Database",
  "Parameters": {
    "EnvironmentSuffix": {
      "Type": "String",
      "Description": "Environment suffix for resource naming uniqueness",
      "Default": "dev"
    },
    "HostedZoneId": {
      "Type": "AWS::Route53::HostedZone::Id",
      "Description": "Route 53 Hosted Zone ID for DNS records"
    },
    "DomainName": {
      "Type": "String",
      "Description": "Domain name for database endpoint (e.g., db.example.com)",
      "Default": "tradingdb.example.com"
    },
    "PrimaryEndpoint": {
      "Type": "String",
      "Description": "Primary cluster endpoint from us-east-1"
    },
    "SecondaryEndpoint": {
      "Type": "String",
      "Description": "Secondary cluster endpoint from eu-west-1"
    },
    "PrimaryHealthCheckId": {
      "Type": "String",
      "Description": "Health check ID for primary region"
    },
    "SecondaryHealthCheckId": {
      "Type": "String",
      "Description": "Health check ID for secondary region"
    }
  },
  "Resources": {
    "PrimaryHealthCheck": {
      "Type": "AWS::Route53::HealthCheck",
      "Properties": {
        "HealthCheckConfig": {
          "Type": "HTTPS",
          "ResourcePath": "/health",
          "FullyQualifiedDomainName": {
            "Ref": "PrimaryEndpoint"
          },
          "Port": 443,
          "RequestInterval": 30,
          "FailureThreshold": 3
        },
        "HealthCheckTags": [
          {
            "Key": "Name",
            "Value": {
              "Fn::Sub": "trading-db-primary-health-${EnvironmentSuffix}"
            }
          },
          {
            "Key": "Environment",
            "Value": "production"
          }
        ]
      }
    },
    "SecondaryHealthCheck": {
      "Type": "AWS::Route53::HealthCheck",
      "Properties": {
        "HealthCheckConfig": {
          "Type": "HTTPS",
          "ResourcePath": "/health",
          "FullyQualifiedDomainName": {
            "Ref": "SecondaryEndpoint"
          },
          "Port": 443,
          "RequestInterval": 30,
          "FailureThreshold": 3
        },
        "HealthCheckTags": [
          {
            "Key": "Name",
            "Value": {
              "Fn::Sub": "trading-db-secondary-health-${EnvironmentSuffix}"
            }
          },
          {
            "Key": "Environment",
            "Value": "production"
          }
        ]
      }
    },
    "PrimaryDNSRecord": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Ref": "HostedZoneId"
        },
        "Name": {
          "Ref": "DomainName"
        },
        "Type": "CNAME",
        "SetIdentifier": {
          "Fn::Sub": "Primary-${EnvironmentSuffix}"
        },
        "Failover": "PRIMARY",
        "TTL": "60",
        "ResourceRecords": [
          {
            "Ref": "PrimaryEndpoint"
          }
        ],
        "HealthCheckId": {
          "Ref": "PrimaryHealthCheck"
        }
      }
    },
    "SecondaryDNSRecord": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Ref": "HostedZoneId"
        },
        "Name": {
          "Ref": "DomainName"
        },
        "Type": "CNAME",
        "SetIdentifier": {
          "Fn::Sub": "Secondary-${EnvironmentSuffix}"
        },
        "Failover": "SECONDARY",
        "TTL": "60",
        "ResourceRecords": [
          {
            "Ref": "SecondaryEndpoint"
          }
        ],
        "HealthCheckId": {
          "Ref": "SecondaryHealthCheck"
        }
      }
    }
  },
  "Outputs": {
    "FailoverDNSName": {
      "Description": "DNS name for failover endpoint",
      "Value": {
        "Ref": "DomainName"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-FailoverDNS"
        }
      }
    }
  }
}
