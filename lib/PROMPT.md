# Infrastructure Requirements

## Overview
Create a single Terraform configuration file named `tap_stack.tf` containing all variables, locals, resources, and outputs (no provider block, no module references) that fulfills the following security and infrastructure requirements.

The infrastructure should be capable of handling a RESTful web service, integrating various AWS services into a cohesive and scalable system.

## Detailed Requirements

### 1. **AWS Lambda Function**
   - Ensure the Lambda function runtime is Python 3.8
   - Establish a role for the Lambda function with permissions limited to its required actions

### 2. **Database Layer - DynamoDB**
   - Include a DynamoDB table for data persistence
   - The DynamoDB table must have read and write capacity defined using Auto Scaling

### 3. **API Layer - API Gateway**
   - Implement an API Gateway to expose the Lambda function as a REST API endpoint
   - Enable CORS for the API Gateway endpoint to allow requests from specific origins
   - Use AWS IAM to restrict access to the API Gateway endpoint to known IP addresses
   - API Gateway must be set up to allow caching for improved performance
   - ICMP and TCP ports 80 and 443 must be allowed in the Security Group associated with API Gateway

### 4. **Storage - S3 Bucket**
   - Use an S3 bucket to store logs generated by the Lambda function
   - The S3 bucket must enforce encryption at rest
   - Ensure S3 bucket versioning is enabled to protect log data

### 5. **Security Management**
   - Use AWS Secrets Manager for managing API keys securely

### 6. **Monitoring & Alerting**
   - Implement CloudWatch Alarms to monitor API Gateway 4XX and 5XX errors

### 7. **Regional Deployment**
   - Ensure all resources are created in the 'us-west-2' region

### 8. **Resource Management**
   - Create tags for all resources created for easy identification and management

All the resources needs to be deployed in region us-west-2.
Declare all necessary input variables, locals, resources, and outputs within this single file, excluding sensitive outputs, and referencing the AWS region only via variable (assume AWS providers handled elsewhere).

Provide outputs for essential identifiers for all the resources which will be created as part of the above requirements providing full coverage

Ensure the entire Terraform code is well-commented, concise, fully deployable, and compliant with best security and infrastructure practices without using any external modules or pre-existing resources.