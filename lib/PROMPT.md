Create a single CloudFormation template using YAML that establishes a complete web application infrastructure with multi-tier architecture and high availability, focusing on how services connect and integrate with each other.

The infrastructure begins with a Virtual Private Cloud that connects to the internet through an Internet Gateway, providing network isolation and external connectivity. Within this VPC, architect a subnet strategy with at least two public subnets and two private subnets that connect through properly configured route tables - public subnets routing internet traffic through the Internet Gateway, while private subnets use NAT Gateways for outbound connectivity.

For the compute layer, provision EC2 instances t2.micro in the public subnets that connect to an S3 bucket for data storage and retrieval. Each instance must connect through an IAM instance profile that grants S3 read/write permissions, eliminating embedded credentials. These instances connect to the internet through dedicated Elastic IP addresses for consistent external access, while also connecting to an Application Load Balancer that distributes incoming HTTP traffic across all healthy instances.

The EC2 instances connect to security groups that allow HTTP traffic port 80 from the Application Load Balancer's security group, while the load balancer's security group accepts HTTP traffic from any internet source 0.0.0.0/0. This creates a secure connectivity chain: Internet → Load Balancer → EC2 Instances → S3 Bucket.

Storage requirements involve an S3 bucket that connects to EC2 instances through IAM roles and policies. The bucket has versioning enabled and connects to bucket policies that block all public access while allowing authenticated access from the EC2 instance role. The EC2 instances connect to this S3 bucket using AWS SDK/CLI, reading and writing data as part of the web application's functionality.

Traffic flow and connectivity: External users connect to the Application Load Balancer DNS endpoint, which connects to Target Groups containing the EC2 instances. The load balancer performs health checks by connecting to each instance on port 80, ensuring traffic only routes to instances that respond successfully. The Auto Scaling Group connects to the load balancer's target group, automatically registering new instances and maintaining at least one healthy instance in each availability zone.

The Auto Scaling Group manages instance lifecycle by connecting to EC2 launch configurations/templates, monitoring instance health by integrating with the load balancer's health check results, and automatically replacing failed instances. When scaling events occur, new instances automatically connect to the load balancer target group and assume the IAM role that grants S3 access.

All resources connect through CloudFormation's dependency management using DependsOn, Ref, and GetAtt functions to ensure proper creation order: VPC → Internet Gateway → Subnets → Route Tables → Security Groups → IAM Roles → EC2 Instances → Load Balancer → Auto Scaling Group.

The final YAML file should demonstrate clear service-to-service connectivity patterns, pass AWS CloudFormation validation, follow infrastructure as code best practices, and create a fully functional web application infrastructure where all components properly connect and integrate to serve HTTP traffic through the load balancer endpoint upon successful stack creation.