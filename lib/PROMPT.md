Create a single CloudFormation template that establishes a comprehensive and secure cloud infrastructure for a modern application deployment.
The foundation of this infrastructure should be a VPC configured with the 10.0.0.0/16 CIDR block, architected for high availability by distributing resources across multiple availability zones. Within this VPC, design a network topology that logically separates public-facing resources from private backend services through the implementation of two public subnets and two private subnets, each strategically placed in different availability zones to ensure resilience. The public subnets need to facilitate direct internet communication through an Internet Gateway, while the private subnets should maintain secure outbound connectivity via NAT Gateways, enabling resources to fetch updates and communicate with external services without exposing them directly to the internet.

For data persistence and storage, incorporate an S3 bucket that leverages AWS KMS for server side encryption, ensuring that stored objects meet compliance requirements for data at rest protection. This storage solution should work in conjunction with EC2 instances that will be deployed exclusively in the private subnets, where they can securely process data while maintaining internet access through the NAT Gateway architecture. These instances require an IAM role that follows the least privilege principle, granting only specific permissions needed for their operations: s3:GetObject, s3:PutObject, and s3:ListBucket actions on the specific S3 bucket resource, along with logs:CreateLogGroup, logs:CreateLogStream, and logs:PutLogEvents actions for CloudWatch Logs on specific log group resources.

The database layer should consist of an RDS PostgreSQL instance strategically positioned within one of the private subnets, configured with automated backup capabilities to ensure data durability and recovery options. Network security must be enforced through a carefully configured security group that follows least privilege principles, restricting SSH access (port 22) to only specific, pre-authorized IP ranges using CIDR notation, preventing unauthorized administrative access while maintaining necessary operational capabilities. Other inbound ports should be explicitly denied unless required for application functionality.

Operational excellence demands proactive monitoring, so implement CloudWatch alarms that automatically detect when EC2 instance CPU utilization exceeds 70%, enabling rapid response to performance issues before they impact users. Throughout the entire infrastructure, apply a consistent tagging strategy that identifies resources by project, environment, and owner, facilitating cost allocation, resource management and compliance tracking.

Finally, ensure the template provides essential reference information by exporting the VPC ID and subnet IDs through CloudFormation Outputs, allowing other stacks or applications to reference these core networking components. The resulting YAML template should represent infrastructure as code best practices, be fully validated against AWS CloudFormation standards and utilize the latest versions of specified AWS services to ensure optimal functionality and security posture.