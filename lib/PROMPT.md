Design a production-grade CloudFormation template to deploy a multi-tier web application for a financial services startup that requires high availability, blue-green deployments, and strict data compliance. The infrastructure should be designed with security, scalability, and zero downtime in mind, suitable for integration into a CI/CD pipeline.

The stack should include an ECS cluster using Fargate launch type deployed across three Availability Zones within a custom VPC containing both public and private subnets. Public subnets will host Application Load Balancers (ALBs) and NAT Gateways, while private subnets will contain the RDS Aurora MySQL cluster and ECS tasks. The RDS cluster must be private-only, have automated backups and point-in-time recovery enabled, and ensure that all database connections use SSL/TLS encryption. ECS tasks must securely retrieve database credentials from AWS Secrets Manager rather than hardcoding them.

The ALB should handle path-based routing to multiple microservices, perform health checks every 15 seconds, and mark targets unhealthy after 2 consecutive failures. In front of the ALB, configure a CloudFront distribution to serve the web application globally, enforcing HTTPS-only access with a minimum of TLS 1.2 and using a custom SSL certificate from ACM. Static assets will be stored in S3 buckets with versioning, lifecycle policies, and KMS-based server-side encryption enabled.

To achieve blue-green deployment capabilities, configure Route53 with weighted routing policies that allow seamless traffic shifting between the blue and green environments. ECS services should have auto-scaling policies that respond to CPU and memory utilization metrics. Enable CloudWatch Container Insights for comprehensive monitoring, logging, and performance visibility across ECS and RDS. All IAM roles must follow the principle of least privilege, granting only the required permissions to each service.

The final CloudFormation template should output key details such as the ECS cluster name, ALB DNS name, CloudFront distribution domain, Route53 record set, and RDS endpoint. It must also support parameterized environment names to allow deployment across different stages (e.g., dev, staging, prod) with consistent resource naming conventions.

Ensure all configurations adhere to AWS best practices for security, compliance, and reliability, producing a complete, production-ready CloudFormation YAML template that captures dependencies, integrates seamlessly with CI/CD pipelines, and can be used to deploy the entire stack with minimal manual intervention.
