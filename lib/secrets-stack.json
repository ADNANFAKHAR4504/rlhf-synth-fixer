{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Secrets Manager stack for database credentials and application secrets",
  "Parameters": {
    "EnvironmentSuffix": {
      "Type": "String",
      "Description": "Unique suffix for resource naming"
    },
    "EnvironmentName": {
      "Type": "String",
      "Description": "Environment name (dev, staging, prod)"
    },
    "ProjectName": {
      "Type": "String",
      "Description": "Project name for tagging"
    }
  },
  "Resources": {
    "DBMasterPasswordSecret": {
      "Type": "AWS::SecretsManager::Secret",
      "Properties": {
        "Name": {
          "Fn::Sub": "db-master-password-${EnvironmentSuffix}"
        },
        "Description": "RDS PostgreSQL master password",
        "GenerateSecretString": {
          "SecretStringTemplate": "{\"username\":\"dbadmin\"}",
          "GenerateStringKey": "password",
          "PasswordLength": 32,
          "ExcludeCharacters": "\"@/\\",
          "RequireEachIncludedType": true
        },
        "Tags": [
          {"Key": "Environment", "Value": {"Ref": "EnvironmentName"}},
          {"Key": "Project", "Value": {"Ref": "ProjectName"}},
          {"Key": "ManagedBy", "Value": "CloudFormation"}
        ]
      }
    },
    "AppSecrets": {
      "Type": "AWS::SecretsManager::Secret",
      "Properties": {
        "Name": {
          "Fn::Sub": "app-secrets-${EnvironmentSuffix}"
        },
        "Description": "Application secrets and API keys",
        "SecretString": "{\"api_key\":\"changeme\",\"jwt_secret\":\"changeme\"}",
        "Tags": [
          {"Key": "Environment", "Value": {"Ref": "EnvironmentName"}},
          {"Key": "Project", "Value": {"Ref": "ProjectName"}},
          {"Key": "ManagedBy", "Value": "CloudFormation"}
        ]
      }
    }
  },
  "Outputs": {
    "DBMasterPasswordSecretArn": {
      "Description": "ARN of database master password secret",
      "Value": {"Ref": "DBMasterPasswordSecret"}
    },
    "AppSecretsArn": {
      "Description": "ARN of application secrets",
      "Value": {"Ref": "AppSecrets"}
    }
  }
}
