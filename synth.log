
> infrastructure-analysis-tool@0.1.0 synth
> cdk synth

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                                                                      !!
!!  This software has not been tested with node v22.17.0.                                                               !!
!!  Should you encounter odd runtime issues, please try using one of the supported release before filing a bug report.  !!
!!                                                                                                                      !!
!!  This software is currently running on node v22.17.0.                                                                !!
!!  As of the current release of this software, supported node releases are:                                            !!
!!  - ^20.0.0 (Planned end-of-life: 2026-04-30)                                                                         !!
!!                                                                                                                      !!
!!  This warning can be silenced by setting the JSII_SILENCE_WARNING_UNTESTED_NODE_VERSION environment variable.        !!
!!                                                                                                                      !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[WARNING] aws-cdk-lib.aws_s3.BucketEncryption#UNENCRYPTED is deprecated.
  S3 applies server-side encryption with SSE-S3 for every bucket
that default encryption is not configured.
  This API will be removed in the next major release.

================================================================================
INFRASTRUCTURE VALIDATION REPORT
================================================================================
Environment: test-qa
Timestamp: 2025-12-05T11:19:56.258Z

Summary:
  Total Findings: 6
  Critical: 1
  Warning: 3
  Info: 2

Categories:
  S3: 2
  Lambda: 4

Execution Metrics:
  Total Time: 0.00ms
  Average Time: 0.00ms

Detailed report written to: ./validation-report.json
================================================================================


Validation failed with 1 critical finding(s)

Description: Infrastructure Analysis and Validation Stack - test-qa
Resources:
  CompliantBucketF3ABE15C:
    Type: AWS::S3::Bucket
    Properties:
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
      BucketName: compliant-bucket-test-qa
      Tags:
        - Key: aws-cdk:auto-delete-objects
          Value: "true"
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: TapStack/CompliantBucket/Resource
  CompliantBucketPolicyB1E9A435:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket:
        Ref: CompliantBucketF3ABE15C
      PolicyDocument:
        Statement:
          - Action:
              - s3:DeleteObject*
              - s3:GetBucket*
              - s3:List*
              - s3:PutBucketPolicy
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092
                  - Arn
            Resource:
              - Fn::GetAtt:
                  - CompliantBucketF3ABE15C
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - CompliantBucketF3ABE15C
                        - Arn
                    - /*
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: TapStack/CompliantBucket/Policy/Resource
  CompliantBucketAutoDeleteObjectsCustomResourceE75E874F:
    Type: Custom::S3AutoDeleteObjects
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F
          - Arn
      BucketName:
        Ref: CompliantBucketF3ABE15C
    DependsOn:
      - CompliantBucketPolicyB1E9A435
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: TapStack/CompliantBucket/AutoDeleteObjectsCustomResource/Default
  CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
      ManagedPolicyArns:
        - Fn::Sub: arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: TapStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role
  CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket: cdk-hnb659fds-assets-342597974367-us-east-2
        S3Key: b7f33614a69548d6bafe224d751a7ef238cde19097415e553fe8b63a4c8fd8a6.zip
      Timeout: 900
      MemorySize: 128
      Handler: index.handler
      Role:
        Fn::GetAtt:
          - CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092
          - Arn
      Runtime: nodejs18.x
      Description:
        Fn::Join:
          - ""
          - - "Lambda function for auto-deleting objects in "
            - Ref: CompliantBucketF3ABE15C
            - " S3 bucket."
    DependsOn:
      - CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092
    Metadata:
      aws:cdk:path: TapStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler
      aws:asset:path: asset.b7f33614a69548d6bafe224d751a7ef238cde19097415e553fe8b63a4c8fd8a6
      aws:asset:property: Code
  NonCompliantBucketD2660FEF:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: non-compliant-bucket-test-qa
      Tags:
        - Key: aws-cdk:auto-delete-objects
          Value: "true"
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: TapStack/NonCompliantBucket/Resource
  NonCompliantBucketPolicyC958405B:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket:
        Ref: NonCompliantBucketD2660FEF
      PolicyDocument:
        Statement:
          - Action:
              - s3:DeleteObject*
              - s3:GetBucket*
              - s3:List*
              - s3:PutBucketPolicy
            Effect: Allow
            Principal:
              AWS:
                Fn::GetAtt:
                  - CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092
                  - Arn
            Resource:
              - Fn::GetAtt:
                  - NonCompliantBucketD2660FEF
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - NonCompliantBucketD2660FEF
                        - Arn
                    - /*
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: TapStack/NonCompliantBucket/Policy/Resource
  NonCompliantBucketAutoDeleteObjectsCustomResource61254421:
    Type: Custom::S3AutoDeleteObjects
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F
          - Arn
      BucketName:
        Ref: NonCompliantBucketD2660FEF
    DependsOn:
      - NonCompliantBucketPolicyC958405B
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: TapStack/NonCompliantBucket/AutoDeleteObjectsCustomResource/Default
  ExampleFunctionServiceRoleA44A0F8B:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: TapStack/ExampleFunction/ServiceRole/Resource
  ExampleFunctionB28997EC:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: "

          \        exports.handler = async (event) => {

          \          return { statusCode: 200, body: 'OK' };

          \        };

          \      "
      Environment:
        Variables:
          ENV: test
          REGION: us-east-2
      FunctionName: example-function-test-qa
      Handler: index.handler
      MemorySize: 256
      Role:
        Fn::GetAtt:
          - ExampleFunctionServiceRoleA44A0F8B
          - Arn
      Runtime: nodejs18.x
      Timeout: 30
    DependsOn:
      - ExampleFunctionServiceRoleA44A0F8B
    Metadata:
      aws:cdk:path: TapStack/ExampleFunction/Resource
  ProblematicFunctionServiceRole7130244D:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: TapStack/ProblematicFunction/ServiceRole/Resource
  ProblematicFunctionCDE5883D:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: "

          \        exports.handler = async (event) => {

          \          return { statusCode: 200, body: 'OK' };

          \        };

          \      "
      FunctionName: problematic-function-test-qa
      Handler: index.handler
      MemorySize: 128
      Role:
        Fn::GetAtt:
          - ProblematicFunctionServiceRole7130244D
          - Arn
      Runtime: nodejs18.x
      Timeout: 900
    DependsOn:
      - ProblematicFunctionServiceRole7130244D
    Metadata:
      aws:cdk:path: TapStack/ProblematicFunction/Resource
  ProblematicRoleEFB976AA:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      RoleName: problematic-role-test-qa
    Metadata:
      aws:cdk:path: TapStack/ProblematicRole/Resource
  ProblematicRoleDefaultPolicyF1EC68F9:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: "*"
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: ProblematicRoleDefaultPolicyF1EC68F9
      Roles:
        - Ref: ProblematicRoleEFB976AA
    Metadata:
      aws:cdk:path: TapStack/ProblematicRole/DefaultPolicy/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Analytics: v2:deflate64:H4sIAAAAAAAA/1WMzQ6CMBCEn8V7WQEPnpXEqwQewJRSyfLTGnYLMQ3vbhAUPc23M7MTQxSGEO7kSIEqm6DFAnzOUjVCjnTzdAB/dqrRLJK7WWmR1Laonpu93JNoZVeUEvzFGcVozdz48CRQduAz2+rZfuu2sy5MInHEtss0Wderpfnlvyjt7YCl7sWJSHPOskJTid/Hq+OH40kYW2qoaT/EMURHCHc1IQa9M4ydhmzRF9koD4wOAQAA
    Metadata:
      aws:cdk:path: TapStack/CDKMetadata/Default
Outputs:
  CompliantBucketName:
    Description: Name of the compliant S3 bucket
    Value:
      Ref: CompliantBucketF3ABE15C
  NonCompliantBucketName:
    Description: Name of the non-compliant S3 bucket
    Value:
      Ref: NonCompliantBucketD2660FEF
Parameters:
  BootstrapVersion:
    Type: AWS::SSM::Parameter::Value<String>
    Default: /cdk-bootstrap/hnb659fds/version
    Description: Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]
Rules:
  CheckBootstrapVersion:
    Assertions:
      - Assert:
          Fn::Not:
            - Fn::Contains:
                - - "1"
                  - "2"
                  - "3"
                  - "4"
                  - "5"
                - Ref: BootstrapVersion
        AssertDescription: CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.


NOTICES         (What's this? https://github.com/aws/aws-cdk/wiki/CLI-Notices)

34892	CDK CLI will collect telemetry data on command usage starting at version 2.1100.0 (unless opted out)

	Overview: We do not collect customer content and we anonymize the
	          telemetry we do collect. See the attached issue for more
	          information on what data is collected, why, and how to
	          opt-out. Telemetry will NOT be collected for any CDK CLI
	          version prior to version 2.1100.0 - regardless of
	          opt-in/out. You can also preview the telemetry we will start
	          collecting by logging it to a local file, by adding
	          `--unstable=telemetry --telemetry-file=my/local/file` to any
	          `cdk` command.

	Affected versions: cli: ^2.0.0

	More information at: https://github.com/aws/aws-cdk/issues/34892


32775	(cli): CLI versions and CDK library versions have diverged

	Overview: Starting in CDK 2.179.0, CLI versions will no longer be in
	          lockstep with CDK library versions. CLI versions will now be
	          released as 2.1000.0 and continue with 2.1001.0, etc.

	Affected versions: cli: >=2.0.0 <=2.1005.0

	More information at: https://github.com/aws/aws-cdk/issues/32775


If you donâ€™t want to see a notice anymore, use "cdk acknowledge <id>". For example, "cdk acknowledge 34892".
